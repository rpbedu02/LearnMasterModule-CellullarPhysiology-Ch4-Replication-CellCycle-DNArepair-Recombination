<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnMaster Course Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Theme Variables --- */
        :root {
            --bg-dark: #121212;
            --bg-medium: #1e1e1e;
            --bg-light: #2d3748; /* Section background */
            --text-light: #e0e0e0; /* Primary text */
            --text-medium: #a0aec0; /* Secondary text */
            --text-dark: #718096; /* Tertiary text */
            --border-color: #4b5563; /* Borders */
            --accent-blue: #60a5fa; /* Buttons, links */
            --accent-green: #34d399; /* Success, completion */
            --accent-red: #f87171;   /* Errors, logout */
            --accent-yellow: #f6e05e;/* Warnings, timer */
            --accent-purple: #a78bfa;/* Quiz submit */
            --accent-indigo: #818cf8;/* Export button */
            /* Light theme overrides */
            --bg-dark-light: #ffffff;
            --bg-medium-light: #f3f4f6; /* Sidebar light */
            --bg-light-light: #e5e7eb; /* Section light */
            --text-light-light: #1f2937; /* Primary text light */
            --text-medium-light: #4b5563; /* Secondary text light */
            --text-dark-light: #6b7280; /* Tertiary text light */
            --border-color-light: #d1d5db; /* Borders light */
        }

        /* --- Base Body Styles --- */
        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            min-height: 100vh;
            font-family: 'Inter', sans-serif; /* Added a default sans-serif font */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Light Theme --- */
        body.light-theme {
            --bg-dark: var(--bg-dark-light);
            --bg-medium: var(--bg-medium-light);
            --bg-light: var(--bg-light-light);
            --text-light: var(--text-light-light);
            --text-medium: var(--text-medium-light);
            --text-dark: var(--text-dark-light);
            --border-color: var(--border-color-light);
        }

        /* --- Layout: Sidebar --- */
        #sidebar-nav {
            width: 250px;
            background-color: var(--bg-medium);
            padding: 20px;
            height: 100vh; /* Full height */
            overflow-y: auto; /* Scroll long nav */
            border-right: 1px solid var(--border-color);
            flex-shrink: 0; /* Prevent shrinking */
            display: flex; /* Use flex for internal layout */
            flex-direction: column;
            transition: background-color 0.3s ease;
        }
        #nav-content { /* Scrollable navigation area */
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px; /* Space before actions */
        }
        #sidebar-actions { /* Buttons at the bottom */
            margin-top: auto; /* Push to bottom */
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        /* --- Layout: Main Content --- */
        #main-content {
            flex-grow: 1; /* Take remaining space */
            padding: 20px;
            overflow-y: auto; /* Scroll content */
            height: 100vh; /* Full height */
        }
        .app-container { /* Center content within main area */
            max-width: 900px;
            margin: 0 auto;
        }

        /* --- Common Elements --- */
        .section-box { /* Style for login, upload, course display */
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Softer shadow */
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        input[type="text"], input[type="file"], button {
            padding: 10px 12px; /* Slightly more padding */
            margin: 8px 0; /* Consistent margin */
            border: 1px solid var(--border-color);
            border-radius: 6px; /* Slightly rounder */
            background: var(--bg-medium); /* Input background */
            color: var(--text-light);
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5); /* Focus ring */
        }
        input[type="file"] {
            background: #374151; /* Distinct file input background */
            cursor: pointer;
            color: var(--text-medium);
        }
        input::file-selector-button { /* Style the button part of file input */
             padding: 8px 12px;
             border: none;
             border-radius: 4px;
             background-color: var(--accent-blue);
             color: white;
             cursor: pointer;
             margin-right: 10px;
             transition: background-color 0.2s ease;
        }
         input::file-selector-button:hover {
              background-color: #3b82f6;
         }

        button {
            background: var(--accent-blue);
            color: white;
            cursor: pointer;
            font-weight: 600; /* Bolder buttons */
            transition: background-color 0.2s ease, transform 0.1s ease;
            text-align: center;
        }
        button:hover {
            background: #3b82f6; /* Slightly darker blue on hover */
        }
        button:active {
             transform: scale(0.98); /* Press effect */
        }

        /* --- Specific Button Styles --- */
        #export-module-btn { background-color: var(--accent-indigo); }
        #export-module-btn:hover { background-color: #6d28d9; } /* Darker indigo */
        #sidebar-actions button { /* Theme, Report buttons */
            background-color: var(--accent-yellow);
            color: #333; /* Darker text for yellow */
            font-weight: bold;
            margin-top: 10px;
        }
        #sidebar-actions button:hover { background-color: #facc15; } /* Brighter yellow */
        #logout-button {
            background: var(--accent-red);
            padding: 6px 12px; /* Adjusted padding */
            font-size: 0.85em;
            width: auto; /* Fit content */
            margin-left: 10px;
        }
        #logout-button:hover { background: #ef4444; } /* Brighter red */

        /* --- Sidebar Navigation Styling --- */
        #sidebar-nav h2 { /* "Course Navigation" */
            font-size: 1.1em; /* Slightly smaller */
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-light);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            flex-shrink: 0;
        }
        #sidebar-nav ul { list-style: none; padding-left: 0; }
        #sidebar-nav .module-title { /* Module titles */
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
            cursor: pointer;
            color: var(--text-medium);
            padding: 5px;
            border-radius: 4px;
            transition: color 0.2s ease, background-color 0.2s ease;
        }
        #sidebar-nav .module-title:hover {
            color: var(--text-light);
            background-color: var(--bg-light);
        }
        #sidebar-nav .topic-list { padding-left: 15px; }
        #sidebar-nav .topic-item a, #sidebar-nav .supplementary-link a { /* Topic & Supp links */
            display: block;
            padding: 6px 8px; /* Adjusted padding */
            color: var(--text-medium);
            text-decoration: none;
            font-size: 0.9em; /* Slightly smaller */
            border-radius: 4px;
            transition: background-color 0.2s ease, color 0.2s ease;
            position: relative; /* For completion checkmark positioning */
        }
        #sidebar-nav .supplementary-link a {
            margin-top: 8px;
            font-style: italic;
            color: var(--accent-purple); /* Distinct color */
        }
        #sidebar-nav .topic-item a:hover, #sidebar-nav .supplementary-link a:hover {
            background-color: var(--bg-light);
            color: var(--text-light);
        }
        #sidebar-nav .topic-item a.active, #sidebar-nav .supplementary-link a.active { /* Active link */
            background-color: var(--accent-blue);
            color: white;
            font-weight: bold;
        }
        #sidebar-nav .topic-item a.completed::after { /* Completion checkmark */
            content: "✓";
            color: var(--accent-green);
            font-weight: bold;
            margin-left: 8px;
            position: absolute; /* Position relative to link */
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
        #sidebar-nav a:focus { /* Keyboard focus */
            outline: 2px solid var(--accent-blue);
            outline-offset: 1px;
        }

        /* --- Login/Upload Screen Specifics --- */
        #login-section, #upload-section { max-width: 500px; margin: 40px auto; }
        #student-info { /* "Logged in as..." */
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 15px;
             font-size: 0.9em;
             color: var(--text-medium);
             padding-bottom: 10px;
             border-bottom: 1px solid var(--border-color);
        }

        /* --- Course Content Styling --- */
        #course-content h1, #course-content h2, #course-content h3, #course-content h4 { margin-top: 1.5em; margin-bottom: 0.8em; font-weight: 600; color: var(--text-light); line-height: 1.3; }
        #course-content h1 { font-size: 1.8em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.3em; }
        #course-content h2 { font-size: 1.5em; }
        #course-content h3 { font-size: 1.25em; }
        #course-content h4 { font-size: 1.1em; }
        #course-content p { margin-bottom: 1em; line-height: 1.7; } /* Increased line height */
        #course-content ul, #course-content ol { margin-left: 1.5em; margin-bottom: 1em; padding-left: 1em; } /* Adjusted indentation */
        #course-content li { margin-bottom: 0.6em; }
        #course-content a { color: var(--accent-blue); text-decoration: underline; }
        #course-content a:hover { color: #93c5fd; }
        #course-content strong, #course-content b { font-weight: bold; color: var(--text-light); } /* Ensure bold stands out */
        #course-content em, #course-content i { font-style: italic; color: var(--text-medium); } /* Subtler italic */
        #course-content code { /* Style code blocks */
            background-color: var(--bg-medium);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            border: 1px solid var(--border-color);
        }
        #course-content pre { /* Style preformatted text (often contains code) */
             background-color: var(--bg-medium);
             padding: 15px;
             border-radius: 6px;
             overflow-x: auto; /* Scroll long code lines */
             border: 1px solid var(--border-color);
             margin-bottom: 1em;
        }
         #course-content pre code { /* Reset background/padding for code inside pre */
              background: none;
              padding: 0;
              border: none;
         }
        #course-content hr { border-color: var(--border-color); margin-top: 2em; margin-bottom: 2em; }

        /* --- Supplementary Resources Box --- */
        .supplementary-resources {
            margin-top: 1.5em;
            padding: 1.2em;
            background-color: rgba(0, 0, 0, 0.1); /* Slightly different background */
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .supplementary-resources h4 {
            font-size: 1.1em; /* Slightly smaller */
            color: var(--text-light);
            margin-bottom: 0.8em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.4em;
        }
         .supplementary-resources ol li {
              margin-bottom: 0.8em; /* More space between video links */
         }

        /* --- Quiz Styling --- */
        .quiz-question {
             background-color: rgba(0, 0, 0, 0.1);
             padding: 15px;
             margin-bottom: 15px;
             border-radius: 8px;
             border: 1px solid var(--border-color);
        }
        .quiz-question label { /* Radio/Checkbox labels */
            display: block;
            margin: 8px 0; /* More spacing */
            cursor: pointer;
            padding: 8px 10px; /* Padding for easier clicking */
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }
         .quiz-question label:hover {
              background-color: rgba(255, 255, 255, 0.05); /* Subtle hover */
         }
        .quiz-question input[type="radio"], .quiz-question input[type="checkbox"] {
             margin-right: 10px;
             accent-color: var(--accent-blue);
             vertical-align: middle; /* Align with text */
        }
        .quiz-question input[type="text"] { /* Short answer input */
            margin-top: 5px;
            padding: 8px;
            width: 100%;
            background-color: var(--bg-medium); /* Match other inputs */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-light);
        }
        #feedback-container > div { /* Quiz results box */
            margin-top: 20px;
            padding: 20px; /* More padding */
            background-color: var(--bg-light); /* Match section box */
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .score-pass { color: var(--accent-green); }
        .score-fail { color: var(--accent-red); }

        /* --- Messages (Error, Info, Success) --- */
        .error-message, .info-message, .success-message {
            border: 1px solid;
            padding: 12px 15px; /* More padding */
            border-radius: 6px;
            margin-top: 15px;
            text-align: center; /* Center align messages */
            font-size: 0.95em;
        }
        .error-message {
            color: var(--accent-red);
            background-color: rgba(248, 113, 113, 0.1); /* Red tint */
            border-color: var(--accent-red);
        }
        .info-message {
            color: var(--accent-blue);
            background-color: rgba(96, 165, 250, 0.1); /* Blue tint */
            border-color: var(--accent-blue);
        }
         .success-message { /* Added success style */
             color: var(--accent-green);
             background-color: rgba(52, 211, 153, 0.1); /* Green tint */
             border-color: var(--accent-green);
         }

        /* --- Initial Hiding & Main Content Padding --- */
        #login-section, #upload-section, #course-display-section, #sidebar-nav { display: none; }
        /* Remove padding only when login/upload is the *only* thing showing */
        body:not(.course-view-active) #main-content { padding: 0; }
        body.course-view-active #main-content { padding: 20px; } /* Restore padding for course view */


        /* --- Progress Bar --- */
        #progress-bar-container { margin-top: 10px; margin-bottom: 15px; }
        #progress-bar { width: 100%; height: 10px; background-color: var(--bg-light); border-radius: 5px; overflow: hidden; border: 1px solid var(--border-color); }
        #progress-fill { height: 100%; background-color: var(--accent-green); width: 0; transition: width 0.4s ease-out; border-radius: 4px; }
        #progress-text { font-size: 0.85em; color: var(--text-medium); margin-top: 6px; text-align: center; }

        /* --- Quiz Timer & Report --- */
        #quiz-timer { font-size: 1em; color: var(--accent-yellow); margin-bottom: 15px; text-align: center; font-weight: 600; }
        #report-content { white-space: pre-wrap; font-family: monospace; background-color: var(--bg-medium); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 15px; font-size: 0.9em; line-height: 1.5; }
        #quiz-error { /* Displayed within quiz form */
            display: none;
            color: var(--accent-red);
            background-color: rgba(248, 113, 113, 0.1);
            border: 1px solid var(--accent-red);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
        }

        /* --- Branding & Collapsible Section --- */
        .branding { font-size: 1.5em; font-weight: bold; color: var(--text-light); margin-bottom: 15px; text-align: center; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .collapsible-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 12px 15px; background-color: var(--bg-medium); border-bottom: 1px solid var(--border-color); border-radius: 5px 5px 0 0; transition: background-color 0.2s ease; }
        .collapsible-header:hover { background-color: #374151; }
        .collapsible-content { display: block; padding: 15px; border-top: none; /* Remove top border if header has bottom */ transition: max-height 0.3s ease-out, padding 0.3s ease-out; overflow: hidden; max-height: 1000px; /* Allow space for content */ }
        .collapsible-content.collapsed { max-height: 0; padding-top: 0; padding-bottom: 0; border-top: none; }
        .toggle-icon::before { content: "▼"; font-size: 0.9em; color: var(--text-light); transition: transform 0.3s ease; display: inline-block; }
        .toggle-icon.collapsed::before { transform: rotate(-90deg); }

        /* --- Embedded Course Message Specific Style --- */
        #embedded-course-message {
            background-color: var(--accent-indigo);
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #5028a9; /* Darker border */
        }

        /* Add a font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    </style>
    <style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-5{margin-bottom:1.25rem}.mt-3{margin-top:0.75rem}.mt-1{margin-top:0.25rem}.mt-6{margin-top:1.5rem}.block{display:block}.w-full{width:100%}.space-y-0\.5 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.125rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.125rem * var(--tw-space-y-reverse))}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.rounded{border-radius:0.25rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.pb-2{padding-bottom:0.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}</style>	<script id="embedded-course-script">
	window.embeddedCourseData = "eyJjb3Vyc2VUaXRsZSI6IkNlbGx1bGFyIFBoeXNpb2xvZ3kgLSBDaGFwdGVyIDQiLCJtb2R1bGVzIjpbeyJpZCI6ImNoNF9udWNsZXVzIiwidGl0bGUiOiJDaGFwdGVyIDQ6IFRoZSBDZWxsIE51Y2xldXMiLCJ0b3BpY3MiOlt7ImlkIjoiQSIsInRpdGxlIjoiUmVwbGljYXRpb24iLCJjb250ZW50IjoiPGgyPkEuIFJlcGxpY2F0aW9uPC9oMj5cbjxoMz4xLiBDaGFyYWN0ZXJpc3RpY3Mgb2YgQ2hyb21vc29tZSBSZXBsaWNhdGlvbjwvaDM+XG48cD5ETkEgcmVwbGljYXRpb24gaXMgYSBmdW5kYW1lbnRhbCBwcm9jZXNzIHRoYXQgZW5zdXJlcyB0aGUgYWNjdXJhdGUgZHVwbGljYXRpb24gb2YgZ2VuZXRpYyBtYXRlcmlhbCwgYWxsb3dpbmcgY2VsbHMgdG8gcGFzcyBvbiB0aGVpciBnZW5ldGljIGluZm9ybWF0aW9uIGR1cmluZyBjZWxsIGRpdmlzaW9uLiBUaGlzIHByb2Nlc3MgaXMgY2hhcmFjdGVyaXplZCBieSBzZXZlcmFsIGtleSBmZWF0dXJlcywgZWFjaCBvZiB3aGljaCBjb250cmlidXRlcyB0byBpdHMgZWZmaWNpZW5jeSBhbmQgZmlkZWxpdHkuPC9wPlxuPGg0PlNlbWljb25zZXJ2YXRpdmUgUmVwbGljYXRpb248L2g0PlxuPHVsPlxuPGxpPjxzdHJvbmc+RGVmaW5pdGlvbjwvc3Ryb25nPjogVGhlIHNlbWljb25zZXJ2YXRpdmUgbmF0dXJlIG9mIEROQSByZXBsaWNhdGlvbiBtZWFucyB0aGF0IGVhY2ggbmV3bHkgc3ludGhlc2l6ZWQgRE5BIHN0cmFuZCBpcyBmb3JtZWQgYnkgcGFpcmluZyB3aXRoIGFuIG9yaWdpbmFsIHRlbXBsYXRlIHN0cmFuZC4gVGhpcyBlbnN1cmVzIHRoYXQgZWFjaCBkYXVnaHRlciBETkEgbW9sZWN1bGUgY29uc2lzdHMgb2Ygb25lIG9sZCAocGFyZW50YWwpIHN0cmFuZCBhbmQgb25lIG5ld2x5IHN5bnRoZXNpemVkIHN0cmFuZC48L2xpPlxuPGxpPjxzdHJvbmc+RGVtb25zdHJhdGlvbiBieSBNZXNzZWxzb24tU3RhaGwgRXhwZXJpbWVudDwvc3Ryb25nPjogVGhlIHNlbWljb25zZXJ2YXRpdmUgbW9kZWwgd2FzIGZhbW91c2x5IHZhbGlkYXRlZCBieSB0aGUgTWVzc2Vsc29uLVN0YWhsIGV4cGVyaW1lbnQgY29uZHVjdGVkIGluIDE5NTguIEluIHRoaXMgZXhwZXJpbWVudDpcbjx1bD5cbjxsaT48ZW0+RXNjaGVyaWNoaWEgY29saTwvZW0+IHdhcyBncm93biBpbiBhIG1lZGl1bSBjb250YWluaW5nIHRoZSBoZWF2eSBpc290b3BlIG9mIG5pdHJvZ2VuICgxNU4pIHRvIGxhYmVsIHRoZSBETkEuPC9saT5cbjxsaT5UaGUgYmFjdGVyaWEgd2VyZSB0aGVuIHRyYW5zZmVycmVkIHRvIGEgbWVkaXVtIGNvbnRhaW5pbmcgdGhlIGxpZ2h0ZXIgaXNvdG9wZSAoMTROKS48L2xpPlxuPGxpPkFmdGVyIG9uZSBnZW5lcmF0aW9uLCB0aGUgRE5BIHdhcyBleHRyYWN0ZWQgYW5kIHN1YmplY3RlZCB0byBkZW5zaXR5IGdyYWRpZW50IGNlbnRyaWZ1Z2F0aW9uLCByZXZlYWxpbmcgdGhhdCB0aGUgRE5BIGNvbnNpc3RlZCBvZiBoeWJyaWRzIG9mIGludGVybWVkaWF0ZSBkZW5zaXR5LCBjb25maXJtaW5nIHRoYXQgZWFjaCBETkEgbW9sZWN1bGUgY29udGFpbmVkIG9uZSBoZWF2eSBzdHJhbmQgYW5kIG9uZSBsaWdodCBzdHJhbmQgYWZ0ZXIgb25lIHJvdW5kIG9mIHJlcGxpY2F0aW9uLjwvbGk+XG48L3VsPlxuPC9saT5cbjwvdWw+XG48aDQ+QmlkaXJlY3Rpb25hbCBSZXBsaWNhdGlvbjwvaDQ+XG48dWw+XG48bGk+PHN0cm9uZz5SZXBsaWNhdGlvbiBCdWJibGVzPC9zdHJvbmc+OiBETkEgcmVwbGljYXRpb24gaXMgYmlkaXJlY3Rpb25hbCwgbWVhbmluZyB0aGF0IGl0IG9jY3VycyBpbiB0d28gZGlyZWN0aW9ucyBmcm9tIHRoZSBvcmlnaW4gb2YgcmVwbGljYXRpb24sIGNyZWF0aW5nIHJlcGxpY2F0aW9uIGJ1YmJsZXMuIEVhY2ggYnViYmxlIGhhcyB0d28gcmVwbGljYXRpb24gZm9ya3Mgd2hlcmUgdGhlIEROQSBzdHJhbmRzIGFyZSB1bndvdW5kIGFuZCBzeW50aGVzaXplZC48L2xpPlxuPGxpPjxzdHJvbmc+RXhwZXJpbWVudGFsIEV2aWRlbmNlPC9zdHJvbmc+OiBUaGlzIGJpZGlyZWN0aW9uYWwgbmF0dXJlIHdhcyBkZW1vbnN0cmF0ZWQgdGhyb3VnaCB2YXJpb3VzIGV4cGVyaW1lbnRzLCBpbmNsdWRpbmcgZWxlY3Ryb24gbWljcm9zY29weSBvYnNlcnZhdGlvbnMgb2YgdGhlIFNWNDAgdmlydXMgcmVwbGljYXRpb24uIFRoZXNlIHN0dWRpZXMgcmV2ZWFsZWQgdGhhdCBhcyB0aGUgcmVwbGljYXRpb24gZm9yayBwcm9ncmVzc2VzLCBuZXcgc3RyYW5kcyBhcmUgc3ludGhlc2l6ZWQgc2ltdWx0YW5lb3VzbHkgYXQgYm90aCBmb3JrcywgZWZmZWN0aXZlbHkgZG91YmxpbmcgdGhlIHJhdGUgb2YgcmVwbGljYXRpb24uPC9saT5cbjwvdWw+XG48aDQ+U3BlY2lmaWMgT3JpZ2lucyBvZiBSZXBsaWNhdGlvbjwvaDQ+XG48dWw+XG48bGk+PHN0cm9uZz5EZWZpbml0aW9uIG9mIE9yaWdpbnM8L3N0cm9uZz46IEROQSByZXBsaWNhdGlvbiBpbml0aWF0ZXMgYXQgc3BlY2lmaWMgc2VxdWVuY2VzIGtub3duIGFzIG9yaWdpbnMgb2YgcmVwbGljYXRpb24uIFRoZXNlIG9yaWdpbnMgYXJlIGNydWNpYWwgZm9yIGRlZmluaW5nIHdoZXJlIHJlcGxpY2F0aW9uIGJlZ2lucyBhbmQgZW5zdXJpbmcgdGhhdCB0aGUgZW50aXJlIGdlbm9tZSBpcyByZXBsaWNhdGVkLjwvbGk+XG48bGk+PHN0cm9uZz5BdXRvbm9tb3VzIFJlcGxpY2F0aW5nIFNlcXVlbmNlcyAoQVJTKTwvc3Ryb25nPjogSW4gZXVrYXJ5b3RpYyBjZWxscywgb3JpZ2lucyBhcmUgb2Z0ZW4gcmVmZXJyZWQgdG8gYXMgQXV0b25vbW91cyBSZXBsaWNhdGluZyBTZXF1ZW5jZXMgKEFSUyksIHdoaWNoIGFyZSByZWNvZ25pemVkIGJ5IGEgcHJvdGVpbiBjb21wbGV4IGNhbGxlZCB0aGUgT3JpZ2luIFJlY29nbml0aW9uIENvbXBsZXggKE9SQykuIFRoZSBPUkMgaXMgZXNzZW50aWFsIGZvciBsb2FkaW5nIGFkZGl0aW9uYWwgZmFjdG9ycyByZXF1aXJlZCBmb3IgdW53aW5kaW5nIHRoZSBETkEgYW5kIGluaXRpYXRpbmcgcmVwbGljYXRpb24uPC9saT5cbjxsaT48c3Ryb25nPlN0dWR5IGluIFllYXN0PC9zdHJvbmc+OiBUaGUgbWVjaGFuaXNtcyBvZiBvcmlnaW4gcmVjb2duaXRpb24gYW5kIGFjdGl2YXRpb24gaGF2ZSBiZWVuIGV4dGVuc2l2ZWx5IHN0dWRpZWQgaW4geWVhc3QsIHdoZXJlIHNldmVyYWwgQVJTIGVsZW1lbnRzIGhhdmUgYmVlbiBjaGFyYWN0ZXJpemVkLCBwcm92aWRpbmcgaW5zaWdodHMgYXBwbGljYWJsZSB0byBvdGhlciBldWthcnlvdGljIHN5c3RlbXMuPC9saT5cbjwvdWw+XG48aDQ+VmFyaWF0aW9uIGluIE9yaWdpbnMgb2YgUmVwbGljYXRpb248L2g0PlxuPHVsPlxuPGxpPjxzdHJvbmc+UHJva2FyeW90aWMgdnMuIEV1a2FyeW90aWMgQ2VsbHM8L3N0cm9uZz46XG48dWw+XG48bGk+TW9zdCBwcm9rYXJ5b3RpYyBjZWxscywgc3VjaCBhcyA8ZW0+RS4gY29saTwvZW0+LCBwb3NzZXNzIGEgc2luZ2xlIG9yaWdpbiBvZiByZXBsaWNhdGlvbiBkdWUgdG8gdGhlaXIgY2lyY3VsYXIgZ2Vub21lLCBhbGxvd2luZyBmb3IgcmFwaWQgYW5kIGVmZmljaWVudCByZXBsaWNhdGlvbi48L2xpPlxuPGxpPlByb2thcnlvdGljIHJlcGxpY2F0aW9uIGNhbiBvY2N1ciBhdCBhIHBhY2Ugb2YgYXBwcm94aW1hdGVseSAxMDAwIGJhc2UgcGFpcnMgcGVyIHNlY29uZCwgZW5hYmxpbmcgdGhlIGVudGlyZSBnZW5vbWUgKGEgZmV3IG1pbGxpb24gbnVjbGVvdGlkZXMpIHRvIGJlIHJlcGxpY2F0ZWQgaW4gdW5kZXIgMzAgbWludXRlcy48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5FdWthcnlvdGljIFJlcGxpY2F0aW9uIENvbXBsZXhpdHk8L3N0cm9uZz46XG48dWw+XG48bGk+SW4gY29udHJhc3QsIGV1a2FyeW90aWMgY2VsbHMgZXhoaWJpdCBhIG1vcmUgY29tcGxleCByZXBsaWNhdGlvbiBwcm9jZXNzLiBFYWNoIGV1a2FyeW90aWMgY2hyb21vc29tZSBoYXMgbXVsdGlwbGUgb3JpZ2lucyBvZiByZXBsaWNhdGlvbiwgYWxsb3dpbmcgZm9yIHRoZSBlZmZpY2llbnQgZHVwbGljYXRpb24gb2YgbGFyZ2VyIGxpbmVhciBnZW5vbWVzLCBzdWNoIGFzIHRoZSAzIGJpbGxpb24gYmFzZSBwYWlycyBmb3VuZCBpbiBodW1hbiBjZWxscy48L2xpPlxuPGxpPlRoZSByYXRlIG9mIEROQSBzeW50aGVzaXMgYXQgZWFjaCBmb3JrIGluIG1hbW1hbGlhbiBjZWxscyBpcyBhcHByb3hpbWF0ZWx5IDEwMCBiYXNlIHBhaXJzIHBlciBzZWNvbmQsIHJlc3VsdGluZyBpbiBhbiBlbnRpcmUgZ2Vub21lIHJlcGxpY2F0aW9uIHRpbWUgb2Ygcm91Z2hseSA4IGhvdXJzLiBUaGlzIHNsb3dlciByYXRlIGlzIGNvbXBlbnNhdGVkIGJ5IHRoZSBwcmVzZW5jZSBvZiBhcHByb3hpbWF0ZWx5IDEwLDAwMCB0byAxMDAsMDAwIG9yaWdpbnMgb2YgcmVwbGljYXRpb24sIHdoaWNoIGFyZSBub3QgZXZlbmx5IHNwYWNlZCBhbmQgZG8gbm90IGFsbCBpbml0aWF0ZSBzaW11bHRhbmVvdXNseS48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5SZXBsaWNvbiBNb2RlbDwvc3Ryb25nPjogVGhlIHByZXNlbmNlIG9mIG11bHRpcGxlIG9yaWdpbnMgcmVzdWx0cyBpbiB0aGUgZm9ybWF0aW9uIG9mIG1hbnkgcmVwbGljb25z4oCUdW5pdHMgb2YgcmVwbGljYXRpb24gdGhhdCBhcmUgY29tcGxldGVkIGF0IGRpZmZlcmVudCB0aW1lcyBkdXJpbmcgdGhlIHJlcGxpY2F0aW9uIHByb2Nlc3MuIFRoaXMgc3lzdGVtIGFsbG93cyBmb3IgdGhlIGNvb3JkaW5hdGVkIGFuZCBlZmZpY2llbnQgc3ludGhlc2lzIG9mIHRoZSBlbnRpcmUgZ2Vub21lIHdoaWxlIG1pbmltaXppbmcgdGhlIHRpbWUgcmVxdWlyZWQgZm9yIGNlbGwgZGl2aXNpb24uPC9saT5cbjwvdWw+XG48aDQ+U3VtbWFyeTwvaDQ+XG48cD5JbiBzdW1tYXJ5LCB0aGUgY2hhcmFjdGVyaXN0aWNzIG9mIGNocm9tb3NvbWUgcmVwbGljYXRpb27igJRzZW1pY29uc2VydmF0aXZlIG5hdHVyZSwgYmlkaXJlY3Rpb25hbGl0eSwgc3BlY2lmaWMgb3JpZ2lucywgYW5kIHRoZSBjb21wbGV4aXR5IG9mIGV1a2FyeW90aWMgcmVwbGljYXRpb27igJRhcmUgZXNzZW50aWFsIGZvciBlbnN1cmluZyB0aGUgZmlkZWxpdHkgYW5kIGVmZmljaWVuY3kgb2YgZ2VuZXRpYyBpbmZvcm1hdGlvbiB0cmFuc21pc3Npb24uIFVuZGVyc3RhbmRpbmcgdGhlc2UgZmVhdHVyZXMgaXMgY3J1Y2lhbCBmb3IgaW5zaWdodHMgaW50byBjZWxsIGJpb2xvZ3ksIGdlbmV0aWNzLCBhbmQgdGhlIG1lY2hhbmlzbXMgdW5kZXJseWluZyB2YXJpb3VzIGRpc2Vhc2VzLCBpbmNsdWRpbmcgY2FuY2VyLCB3aGljaCBjYW4gYXJpc2UgZnJvbSBlcnJvcnMgaW4gRE5BIHJlcGxpY2F0aW9uLjwvcD5cblxuPGgzPjIuIFJlcGxpY2F0aW9uIE1hY2hpbmVyeSBhbmQgTWVjaGFuaXNtczwvaDM+XG48cD5UaGUgcHJvY2VzcyBvZiBETkEgcmVwbGljYXRpb24gaXMgYSBoaWdobHkgc29waGlzdGljYXRlZCBhbmQgY29vcmRpbmF0ZWQgZXZlbnQgdGhhdCBpbnZvbHZlcyBhIHNlcmllcyBvZiBlbnp5bWVzIGFuZCBwcm90ZWlucyB3b3JraW5nIGluIGNvbmNlcnQgdG8gZW5zdXJlIHRoZSBwcmVjaXNlIGR1cGxpY2F0aW9uIG9mIGdlbmV0aWMgbWF0ZXJpYWwuIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgbWFjaGluZXJ5IGFuZCB0aGUgc3BlY2lmaWMgc3RlcHMgaW52b2x2ZWQgYXJlIHJlbWFya2FibHkgc2ltaWxhciBhY3Jvc3MgYm90aCBwcm9rYXJ5b3RpYyBhbmQgZXVrYXJ5b3RpYyBjZWxscywgcmVmbGVjdGluZyB0aGUgZnVuZGFtZW50YWwgbmF0dXJlIG9mIHRoaXMgYmlvbG9naWNhbCBwcm9jZXNzLjwvcD5cbjxoND5HZW5lcmFsIENvbXBvbmVudHMgYW5kIFN0ZXBzIEludm9sdmVkPC9oND5cbjx1bD5cbjxsaT48c3Ryb25nPk9yaWdpbiBSZWNvZ25pdGlvbiBDb21wbGV4IChPUkMpPC9zdHJvbmc+OiBUaGUgaW5pdGlhdGlvbiBvZiBETkEgcmVwbGljYXRpb24gYmVnaW5zIHdpdGggdGhlIGFzc2VtYmx5IG9mIHRoZSBPcmlnaW4gUmVjb2duaXRpb24gQ29tcGxleCBhdCB0aGUgb3JpZ2lucyBvZiByZXBsaWNhdGlvbi4gVGhpcyBtdWx0aS1wcm90ZWluIGNvbXBsZXggaXMgY3JpdGljYWwgZm9yIHJlY29nbml6aW5nIHNwZWNpZmljIEROQSBzZXF1ZW5jZXMga25vd24gYXMgdGhlIEF1dG9ub21vdXMgUmVwbGljYXRpbmcgU2VxdWVuY2VzIChBUlMpLiBPbmNlIGJvdW5kLCB0aGUgT1JDIGZhY2lsaXRhdGVzIHRoZSByZWNydWl0bWVudCBvZiBhZGRpdGlvbmFsIHByb3RlaW5zIG5lY2Vzc2FyeSBmb3IgdGhlIHVud2luZGluZyBvZiB0aGUgRE5BIGhlbGl4LjwvbGk+XG48bGk+PHN0cm9uZz5IZWxpY2FzZTwvc3Ryb25nPjogRm9sbG93aW5nIHRoZSBhc3NlbWJseSBvZiB0aGUgT1JDLCBhbiBlbnp5bWUgY2FsbGVkIGhlbGljYXNlIGlzIHJlY3J1aXRlZCB0byB0aGUgb3JpZ2luLiBIZWxpY2FzZSBpcyByZXNwb25zaWJsZSBmb3IgdW53aW5kaW5nIHRoZSBkb3VibGUtc3RyYW5kZWQgRE5BLCBjcmVhdGluZyB0d28gc2luZ2xlLXN0cmFuZGVkIHRlbXBsYXRlcyBmb3IgcmVwbGljYXRpb24uIFRoaXMgdW53aW5kaW5nIHByb2Nlc3MgaXMgcG93ZXJlZCBieSB0aGUgaHlkcm9seXNpcyBvZiBBVFAsIHdoaWNoIHByb3ZpZGVzIHRoZSBuZWNlc3NhcnkgZW5lcmd5IHRvIHNlcGFyYXRlIHRoZSBzdHJhbmRzIGFuZCBvdmVyY29tZSB0aGUgaW5oZXJlbnQgc3RhYmlsaXR5IG9mIHRoZSBETkEgZG91YmxlIGhlbGl4LjwvbGk+XG48bGk+PHN0cm9uZz5TaW5nbGUtU3RyYW5kZWQgRE5BIEJpbmRpbmcgUHJvdGVpbnM8L3N0cm9uZz46IEFzIHRoZSBETkEgc3RyYW5kcyBhcmUgdW53b3VuZCwgdGhleSBiZWNvbWUgc3VzY2VwdGlibGUgdG8gcmUtYW5uZWFsaW5nIG9yIGRlZ3JhZGF0aW9uLiBUbyBwcmV2ZW50IHRoZXNlIGlzc3Vlcywgc2luZ2xlLXN0cmFuZGVkIEROQSBiaW5kaW5nIHByb3RlaW5zIChzdWNoIGFzIFJlcGxpY2F0aW9uIFByb3RlaW4gQSwgb3IgUlBBLCBpbiBldWthcnlvdGVzLCBhbmQgU2luZ2xlLVN0cmFuZGVkIEJpbmRpbmcgUHJvdGVpbnMsIG9yIFNTQiwgaW4gcHJva2FyeW90ZXMpIGJpbmQgdG8gdGhlIGV4cG9zZWQgc2luZ2xlLXN0cmFuZGVkIEROQSAoc3NETkEpIHJlZ2lvbnMuIFRoZXNlIHByb3RlaW5zIHN0YWJpbGl6ZSB0aGUgc3NETkEgYW5kIHByZXZlbnQgc2Vjb25kYXJ5IHN0cnVjdHVyZXMgZnJvbSBmb3JtaW5nLCB0aHVzIGVuc3VyaW5nIHRoYXQgdGhlIHRlbXBsYXRlIHJlbWFpbnMgYWNjZXNzaWJsZSBmb3IgcmVwbGljYXRpb24uPC9saT5cbjxsaT48c3Ryb25nPlByaW1hc2U8L3N0cm9uZz46IFRoZSBuZXh0IGNyaXRpY2FsIHBsYXllciBpbiB0aGUgcmVwbGljYXRpb24gbWFjaGluZXJ5IGlzIHByaW1hc2UsIGFuIFJOQSBwb2x5bWVyYXNlIHRoYXQgc3ludGhlc2l6ZXMgc2hvcnQgUk5BIHByaW1lcnMgY29tcGxlbWVudGFyeSB0byB0aGUgc3NETkEgdGVtcGxhdGVzLiBUaGVzZSBwcmltZXJzIGFyZSBlc3NlbnRpYWwgYmVjYXVzZSBETkEgcG9seW1lcmFzZXMgY2Fubm90IGluaXRpYXRlIHN5bnRoZXNpcyBkZSBub3ZvOyB0aGV5IGNhbiBvbmx5IGFkZCBudWNsZW90aWRlcyB0byBhbiBleGlzdGluZyBzdHJhbmQuIFRoZSBSTkEgcHJpbWVyIHByb3ZpZGVzIHRoZSBuZWNlc3NhcnkgMycgaHlkcm94eWwgKE9IKSBncm91cCBmb3IgdGhlIEROQSBwb2x5bWVyYXNlIHRvIGJlZ2luIGVsb25nYXRpb24uPC9saT5cbjxsaT48c3Ryb25nPkROQSBQb2x5bWVyYXNlczwvc3Ryb25nPjogVGhlIHByaW1hcnkgZW56eW1lcyByZXNwb25zaWJsZSBmb3Igc3ludGhlc2l6aW5nIG5ldyBETkEgc3RyYW5kcyBhcmUgRE5BIHBvbHltZXJhc2VzLiBJbiBldWthcnlvdGljIGNlbGxzLCBmaXZlIGRpZmZlcmVudCBETkEgcG9seW1lcmFzZXMgKGFscGhhLCBiZXRhLCBnYW1tYSwgZGVsdGEsIGFuZCBlcHNpbG9uKSBoYXZlIGJlZW4gaWRlbnRpZmllZCwgZWFjaCB3aXRoIGRpc3RpbmN0IHJvbGVzOlxuPHVsPlxuPGxpPjxzdHJvbmc+RE5BIFBvbHltZXJhc2UgQWxwaGE8L3N0cm9uZz46IFRoaXMgcG9seW1lcmFzZSBpcyBpbnZvbHZlZCBpbiBpbml0aWF0aW5nIEROQSBzeW50aGVzaXMuIEl0IHdvcmtzIGluIGNvbmp1bmN0aW9uIHdpdGggcHJpbWFzZSB0byBleHRlbmQgdGhlIFJOQSBwcmltZXIgZm9yIGEgc2hvcnQgZGlzdGFuY2UuPC9saT5cbjxsaT48c3Ryb25nPkROQSBQb2x5bWVyYXNlIERlbHRhPC9zdHJvbmc+OiBUaGlzIHBvbHltZXJhc2UgaXMgcHJpbWFyaWx5IHJlc3BvbnNpYmxlIGZvciBzeW50aGVzaXppbmcgdGhlIGxhZ2dpbmcgc3RyYW5kLiBJdCBpcyBoaWdobHkgcHJvY2Vzc2l2ZSBhbmQgY2FuIGV4dGVuZCB0aGUgT2themFraSBmcmFnbWVudHMgaW5pdGlhdGVkIGJ5IFJOQSBwcmltZXJzLjwvbGk+XG48bGk+PHN0cm9uZz5ETkEgUG9seW1lcmFzZSBFcHNpbG9uPC9zdHJvbmc+OiBUaGlzIGVuenltZSBpcyBtYWlubHkgaW52b2x2ZWQgaW4gc3ludGhlc2l6aW5nIHRoZSBsZWFkaW5nIHN0cmFuZCwgcHJvdmlkaW5nIHJhcGlkIGFuZCBjb250aW51b3VzIEROQSBzeW50aGVzaXMuPC9saT5cbjxsaT48c3Ryb25nPkROQSBQb2x5bWVyYXNlIEJldGE8L3N0cm9uZz46IFRoaXMgcG9seW1lcmFzZSBwbGF5cyBhIHJvbGUgaW4gRE5BIHJlcGFpciByYXRoZXIgdGhhbiBpbiByZXBsaWNhdGlvbi48L2xpPlxuPGxpPjxzdHJvbmc+RE5BIFBvbHltZXJhc2UgR2FtbWE8L3N0cm9uZz46IFRoaXMgZW56eW1lIGlzIGludm9sdmVkIGluIG1pdG9jaG9uZHJpYWwgRE5BIHJlcGxpY2F0aW9uLjwvbGk+XG48L3VsPlxuSW1wb3J0YW50bHksIEROQSBwb2x5bWVyYXNlcyBzeW50aGVzaXplIEROQSBpbiBhIDUnIHRvIDMnIGRpcmVjdGlvbiwgbWVhbmluZyB0aGV5IGNhbiBvbmx5IGFkZCBudWNsZW90aWRlcyB0byB0aGUgZnJlZSAzJyBlbmQgb2YgYSBncm93aW5nIHN0cmFuZC4gVGh1cywgYXMgdGhlIHJlcGxpY2F0aW9uIGZvcmsgb3BlbnMsIHRoZSBsZWFkaW5nIHN0cmFuZCBpcyBzeW50aGVzaXplZCBjb250aW51b3VzbHksIHdoaWxlIHRoZSBsYWdnaW5nIHN0cmFuZCBpcyBzeW50aGVzaXplZCBpbiBzaG9ydCwgZGlzY29udGludW91cyBzZWdtZW50cyBrbm93biBhcyBPa2F6YWtpIGZyYWdtZW50cy48L2xpPlxuPC91bD5cbjxoND5TeW50aGVzaXMgYXQgdGhlIFJlcGxpY2F0aW9uIEZvcmtzPC9oND5cbjxwPkluIGVhY2ggcmVwbGljYXRpb24gZm9yaywgdGhlIHN5bnRoZXNpcyBvZiBib3RoIHN0cmFuZHMgb2NjdXJzIHNpbXVsdGFuZW91c2x5IGJ1dCB2aWEgZGlzdGluY3QgbWVjaGFuaXNtczo8L3A+XG48dWw+XG48bGk+PHN0cm9uZz5MZWFkaW5nIFN0cmFuZCBTeW50aGVzaXM8L3N0cm9uZz46IFRoZSBsZWFkaW5nIHN0cmFuZCBpcyBzeW50aGVzaXplZCBjb250aW51b3VzbHkgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgcmVwbGljYXRpb24gZm9yay4gVGhpcyBwcm9jZXNzIGJlZ2lucyB3aXRoIGEgc2luZ2xlIFJOQSBwcmltZXIgc3ludGhlc2l6ZWQgYnkgcHJpbWFzZS4gRE5BIHBvbHltZXJhc2UgYWxwaGEgZXh0ZW5kcyB0aGlzIHByaW1lciBmb3IgYSBzaG9ydCBzdHJldGNoIGJlZm9yZSBiZWluZyByZXBsYWNlZCBieSB0aGUgbW9yZSBwcm9jZXNzaXZlIFBDTkEtUG9sLWVwc2lsb24gY29tcGxleC4gUENOQSAoUHJvbGlmZXJhdGluZyBDZWxsIE51Y2xlYXIgQW50aWdlbikgYWN0cyBhcyBhIHNsaWRpbmcgY2xhbXAgdGhhdCBlbmNpcmNsZXMgdGhlIEROQSBhbmQgaG9sZHMgdGhlIHBvbHltZXJhc2UgaW4gcGxhY2UsIGFsbG93aW5nIGZvciByYXBpZCBhbmQgZWZmaWNpZW50IGVsb25nYXRpb24gb2YgdGhlIGxlYWRpbmcgc3RyYW5kLjwvbGk+XG48bGk+PHN0cm9uZz5MYWdnaW5nIFN0cmFuZCBTeW50aGVzaXM8L3N0cm9uZz46IFRoZSBsYWdnaW5nIHN0cmFuZCwgc3ludGhlc2l6ZWQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiBvZiB0aGUgcmVwbGljYXRpb24gZm9yaywgaXMgbW9yZSBjb21wbGV4LiBNdWx0aXBsZSBSTkEgcHJpbWVycyBhcmUgcmVxdWlyZWQsIGFzIGVhY2ggT2themFraSBmcmFnbWVudCBtdXN0IGJlZ2luIHdpdGggYSBuZXcgcHJpbWVyLiBUaGUgcHJvY2VzcyBpbnZvbHZlczpcbjx1bD5cbjxsaT5QcmltYXNlIHN5bnRoZXNpemluZyBhbiBSTkEgcHJpbWVyIGF0IHZhcmlvdXMgcG9pbnRzIGFsb25nIHRoZSBsYWdnaW5nIHN0cmFuZCB0ZW1wbGF0ZS48L2xpPlxuPGxpPkROQSBwb2x5bWVyYXNlIGFscGhhIGV4dGVuZGluZyB0aGUgcHJpbWVyIGZvciBhIGJyaWVmIGxlbmd0aCBiZWZvcmUgaGFuZGluZyBvZmYgdG8gUENOQS1Qb2wtZGVsdGEuPC9saT5cbjxsaT5QQ05BLVBvbC1kZWx0YSBleHRlbmRzIHRoZSBmcmFnbWVudCB1bnRpbCBpdCByZWFjaGVzIHRoZSBwcmV2aW91cyBPa2F6YWtpIGZyYWdtZW50LCB3aGljaCBuZWNlc3NpdGF0ZXMgc3RvcHBpbmcgdGhlIHN5bnRoZXNpcy48L2xpPlxuPGxpPk9uY2UgdGhlIFJOQSBwcmltZXJzIGhhdmUgc2VydmVkIHRoZWlyIHB1cnBvc2UsIHRoZXkgYXJlIHJlbW92ZWQgYW5kIHJlcGxhY2VkIHdpdGggRE5BLiBETkEgcG9seW1lcmFzZSBJIGluIHByb2thcnlvdGljIGNlbGxzIChvciBGRU4xIGluIGV1a2FyeW90ZXMpIHBlcmZvcm1zIHRoaXMgdGFzaywgd2hpbGUgRE5BIGxpZ2FzZSBzZWFscyB0aGUgbmlja3MgYmV0d2VlbiBhZGphY2VudCBPa2F6YWtpIGZyYWdtZW50cywgZm9ybWluZyBhIGNvbnRpbnVvdXMgRE5BIHN0cmFuZC48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuPGg0PkFkZGl0aW9uYWwgRW56eW1hdGljIEludm9sdmVtZW50PC9oND5cbjx1bD5cbjxsaT48c3Ryb25nPlRvcG9pc29tZXJhc2VzPC9zdHJvbmc+OiBBcyBoZWxpY2FzZSB1bndpbmRzIHRoZSBETkEsIGl0IGNyZWF0ZXMgdG9yc2lvbmFsIHN0cmVzcyBhaGVhZCBvZiB0aGUgcmVwbGljYXRpb24gZm9yaywgbGVhZGluZyB0byBwb3NpdGl2ZSBzdXBlcmNvaWxpbmcuIFRvcG9pc29tZXJhc2VzIGFsbGV2aWF0ZSB0aGlzIHRlbnNpb24gYnkgaW5kdWNpbmcgdHJhbnNpZW50IGJyZWFrcyBpbiB0aGUgRE5BIHN0cmFuZHMuIFRoZXJlIGFyZSB0d28gbWFpbiB0eXBlczpcbjx1bD5cbjxsaT48c3Ryb25nPlR5cGUgSSBUb3BvaXNvbWVyYXNlczwvc3Ryb25nPjogVGhlc2UgZW56eW1lcyBjdXQgb25lIHN0cmFuZCBvZiB0aGUgRE5BIGhlbGl4LCBhbGxvd2luZyB0aGUgb3RoZXIgc3RyYW5kIHRvIHVud2luZCBhbmQgcmVsaWV2ZSB0aGUgc3VwZXJjb2lsaW5nLjwvbGk+XG48bGk+PHN0cm9uZz5UeXBlIElJIFRvcG9pc29tZXJhc2VzPC9zdHJvbmc+OiBUaGVzZSBlbnp5bWVzIGNhbiBjdXQgYm90aCBzdHJhbmRzIHNpbXVsdGFuZW91c2x5LCBhbGxvd2luZyBmb3IgbW9yZSBzaWduaWZpY2FudCByZWxpZWYgb2YgdGVuc2lvbiBhbmQgZmFjaWxpdGF0aW5nIHRoZSBwYXNzYWdlIG9mIG9uZSBETkEgaGVsaXggdGhyb3VnaCBhbm90aGVyLiBBbnRpYmlvdGljcyB0YXJnZXRpbmcgYmFjdGVyaWFsIHRvcG9pc29tZXJhc2VzLCBzdWNoIGFzIEd5cmFzZSwgc2VydmUgYXMgZWZmZWN0aXZlIGFudGliYWN0ZXJpYWwgYWdlbnRzIGJ5IGhhbHRpbmcgYmFjdGVyaWFsIHJlcGxpY2F0aW9uLjwvbGk+XG48L3VsPlxuPC9saT5cbjxsaT48c3Ryb25nPlRlbG9tZXJhc2U8L3N0cm9uZz46IEV1a2FyeW90aWMgY2VsbHMgZmFjZSBhIHVuaXF1ZSBjaGFsbGVuZ2UgaW4gcmVwbGljYXRpbmcgdGhlaXIgbGluZWFyIGNocm9tb3NvbWVzOiB0aGUgaW5hYmlsaXR5IHRvIGZ1bGx5IHJlcGxpY2F0ZSB0aGUgZW5kcyBvZiB0aGVzZSBjaHJvbW9zb21lcywga25vd24gYXMgdGVsb21lcmVzLiBUZWxvbWVyYXNlIGlzIGFuIGVuenltZSB0aGF0IGFkZHMgcmVwZXRpdGl2ZSBudWNsZW90aWRlIHNlcXVlbmNlcyB0byB0aGUgdGVsb21lcmVzLCBjb21wZW5zYXRpbmcgZm9yIHRoZSBETkEgbG9zdCBkdXJpbmcgcmVwbGljYXRpb24uIENvbXBvc2VkIG9mIGFuIFJOQSB0ZW1wbGF0ZSBhbmQgYSBzcGVjaWFsaXplZCByZXZlcnNlIHRyYW5zY3JpcHRhc2UgYWN0aXZpdHksIHRlbG9tZXJhc2UgaXMgY3J1Y2lhbCBkdXJpbmcgZWFybHkgZGV2ZWxvcG1lbnQgYW5kIGluIGdlcm0gY2VsbHMsIGVuc3VyaW5nIHRoYXQgdGhlIGNocm9tb3NvbWVzIGRvIG5vdCBzaG9ydGVuIHdpdGggZWFjaCBkaXZpc2lvbi48L2xpPlxuPC91bD5cblxuPGgzPjMuIFJlcGxpY2F0aW9uIGFuZCB0aGUgQ2VsbCBDeWNsZTwvaDM+XG48cD5ETkEgcmVwbGljYXRpb24gaXMgaW50cmljYXRlbHkgaW50ZWdyYXRlZCBpbnRvIHRoZSBldWthcnlvdGljIGNlbGwgY3ljbGUsIGEgaGlnaGx5IHJlZ3VsYXRlZCBzZXJpZXMgb2YgZXZlbnRzIHRoYXQgbGVhZHMgdG8gY2VsbCBncm93dGgsIEROQSBzeW50aGVzaXMsIGFuZCB1bHRpbWF0ZWx5LCBjZWxsIGRpdmlzaW9uLiBUaGUgY2VsbCBjeWNsZSBpcyBkaXZpZGVkIGludG8gZGlzdGluY3QgcGhhc2VzLCBlYWNoIGNoYXJhY3Rlcml6ZWQgYnkgc3BlY2lmaWMgYWN0aXZpdGllcyBhbmQgY2hlY2twb2ludHMgdGhhdCBlbnN1cmUgdGhlIGZpZGVsaXR5IG9mIEROQSByZXBsaWNhdGlvbiBhbmQgdGhlIHByb3BlciBmdW5jdGlvbmluZyBvZiB0aGUgY2VsbC48L3A+XG48aDQ+UGhhc2VzIG9mIHRoZSBDZWxsIEN5Y2xlPC9oND5cbjxwPlRoZSBldWthcnlvdGljIGNlbGwgY3ljbGUgaXMgdHlwaWNhbGx5IGRpdmlkZWQgaW50byBmb3VyIG1haW4gcGhhc2VzOjwvcD5cbjx1bD5cbjxsaT48c3Ryb25nPkcxIFBoYXNlIChHYXAgMSk8L3N0cm9uZz46IFRoaXMgaXMgdGhlIGZpcnN0IHBoYXNlIGFmdGVyIGNlbGwgZGl2aXNpb24sIGR1cmluZyB3aGljaCB0aGUgY2VsbCB1bmRlcmdvZXMgZ3Jvd3RoIGFuZCBwcmVwYXJlcyBmb3IgRE5BIHN5bnRoZXNpcy4gSW4gdGhpcyBwaGFzZSwgdGhlIGNlbGwgc3ludGhlc2l6ZXMgdmFyaW91cyBwcm90ZWlucyBhbmQgb3JnYW5lbGxlcywgYWNjdW11bGF0ZXMgbnV0cmllbnRzLCBhbmQgZW5nYWdlcyBpbiBtZXRhYm9saWMgYWN0aXZpdGllcy4gVGhlIEcxIHBoYXNlIGlzIGNydWNpYWwgZm9yIGVuc3VyaW5nIHRoYXQgdGhlIGNlbGwgaGFzIGFsbCB0aGUgbmVjZXNzYXJ5IGNvbXBvbmVudHMgYW5kIGVuZXJneSByZXNlcnZlcyB0byBzdXBwb3J0IHRoZSB1cGNvbWluZyByZXBsaWNhdGlvbiBwcm9jZXNzLjwvbGk+XG48bGk+PHN0cm9uZz5TIFBoYXNlIChTeW50aGVzaXMpPC9zdHJvbmc+OiBEdXJpbmcgdGhlIFMgcGhhc2UsIEROQSByZXBsaWNhdGlvbiBvY2N1cnMuIEVhY2ggY2hyb21vc29tZSBpcyBkdXBsaWNhdGVkLCByZXN1bHRpbmcgaW4gdHdvIHNpc3RlciBjaHJvbWF0aWRzIGZvciBlYWNoIGNocm9tb3NvbWUuIFRoZSBkdXJhdGlvbiBvZiB0aGUgUyBwaGFzZSBjYW4gdmFyeSwgYnV0IGluIG1hbW1hbGlhbiBjZWxscywgaXQgdHlwaWNhbGx5IHRha2VzIGFib3V0IDggaG91cnMuIFRoaXMgcGhhc2UgaXMgY2hhcmFjdGVyaXplZCBieSB0aGUgYWN0aXZhdGlvbiBvZiByZXBsaWNhdGlvbiBvcmlnaW5zIGFuZCB0aGUgY29vcmRpbmF0aW9uIG9mIHRoZSByZXBsaWNhdGlvbiBtYWNoaW5lcnkgdG8gZW5zdXJlIHRoYXQgdGhlIGVudGlyZSBnZW5vbWUgaXMgYWNjdXJhdGVseSBjb3BpZWQuPC9saT5cbjxsaT48c3Ryb25nPkcyIFBoYXNlIChHYXAgMik8L3N0cm9uZz46IEZvbGxvd2luZyBETkEgc3ludGhlc2lzLCB0aGUgY2VsbCBlbnRlcnMgdGhlIEcyIHBoYXNlLCB3aGVyZSBpdCBjb250aW51ZXMgdG8gZ3JvdyBhbmQgcHJlcGFyZXMgZm9yIG1pdG9zaXMuIER1cmluZyB0aGlzIHBoYXNlLCB0aGUgY2VsbCB1bmRlcmdvZXMgYWRkaXRpb25hbCBncm93dGgsIHN5bnRoZXNpemVzIHByb3RlaW5zIHJlcXVpcmVkIGZvciBtaXRvc2lzLCBhbmQgZW5zdXJlcyB0aGF0IEROQSByZXBsaWNhdGlvbiBoYXMgb2NjdXJyZWQgY29ycmVjdGx5LiBUaGUgRzIgcGhhc2Ugc2VydmVzIGFzIGEgY3JpdGljYWwgY2hlY2twb2ludCB0byB2ZXJpZnkgdGhhdCB0aGUgY2VsbCBpcyByZWFkeSB0byBkaXZpZGUuPC9saT5cbjxsaT48c3Ryb25nPk0gUGhhc2UgKE1pdG9zaXMpPC9zdHJvbmc+OiBUaGUgTSBwaGFzZSBlbmNvbXBhc3NlcyB0aGUgcHJvY2Vzc2VzIG9mIG1pdG9zaXMgYW5kIGN5dG9raW5lc2lzLCBkdXJpbmcgd2hpY2ggdGhlIHJlcGxpY2F0ZWQgY2hyb21vc29tZXMgYXJlIHNlZ3JlZ2F0ZWQgaW50byB0d28gZGF1Z2h0ZXIgY2VsbHMuIE1pdG9zaXMgaXMgZnVydGhlciBkaXZpZGVkIGludG8gc2V2ZXJhbCBzdGFnZXM6IHByb3BoYXNlLCBtZXRhcGhhc2UsIGFuYXBoYXNlLCBhbmQgdGVsb3BoYXNlLiBDeXRva2luZXNpcyBmb2xsb3dzLCBlbnN1cmluZyB0aGF0IHRoZSBjeXRvcGxhc20gZGl2aWRlcyBhbmQgdHdvIGRpc3RpbmN0IGNlbGxzIGFyZSBmb3JtZWQuPC9saT5cbjwvdWw+XG48aDQ+UmVndWxhdGlvbiBvZiB0aGUgQ2VsbCBDeWNsZTwvaDQ+XG48cD5UaGUgcHJvZ3Jlc3Npb24gdGhyb3VnaCB0aGUgY2VsbCBjeWNsZSBpcyB0aWdodGx5IHJlZ3VsYXRlZCBieSBhIG5ldHdvcmsgb2YgcHJvdGVpbnMga25vd24gYXMgY3ljbGlucyBhbmQgY3ljbGluLWRlcGVuZGVudCBraW5hc2VzIChDREtzKS4gVGhlc2UgcHJvdGVpbnMgd29yayBpbiB0YW5kZW0gdG8gY29udHJvbCB0aGUgdHJhbnNpdGlvbiBiZXR3ZWVuIGRpZmZlcmVudCBwaGFzZXMgb2YgdGhlIGNlbGwgY3ljbGU6PC9wPlxuPHVsPlxuPGxpPjxzdHJvbmc+Q3ljbGluczwvc3Ryb25nPjogQ3ljbGlucyBhcmUgcmVndWxhdG9yeSBwcm90ZWlucyB3aG9zZSBsZXZlbHMgZmx1Y3R1YXRlIHRocm91Z2hvdXQgdGhlIGNlbGwgY3ljbGUuIFRoZXkgYmluZCB0byBhbmQgYWN0aXZhdGUgQ0RLcywgZm9ybWluZyBjeWNsaW4tQ0RLIGNvbXBsZXhlcyB0aGF0IHRyaWdnZXIgc3BlY2lmaWMgZXZlbnRzIGluIHRoZSBjZWxsIGN5Y2xlLiBGb3IgZXhhbXBsZSwgQ3ljbGluIEQgaXMgY3JpdGljYWwgZm9yIHRoZSBwcm9ncmVzc2lvbiBmcm9tIEcxIHRvIFMgcGhhc2UsIHdoaWxlIEN5Y2xpbiBBIGlzIGludm9sdmVkIGluIFMgcGhhc2UgcHJvZ3Jlc3Npb24uPC9saT5cbjxsaT48c3Ryb25nPkN5Y2xpbi1EZXBlbmRlbnQgS2luYXNlcyAoQ0RLcyk8L3N0cm9uZz46IENES3MgYXJlIGVuenltZXMgdGhhdCwgd2hlbiBhY3RpdmF0ZWQgYnkgYmluZGluZyB0byBjeWNsaW5zLCBwaG9zcGhvcnlsYXRlIHRhcmdldCBwcm90ZWlucyB0byBkcml2ZSB0aGUgY2VsbCBjeWNsZSBmb3J3YXJkLiBUaGUgYWN0aXZpdHkgb2YgQ0RLcyBpcyB0aWdodGx5IGNvbnRyb2xsZWQgYnkgdGhlIGF2YWlsYWJpbGl0eSBvZiB0aGVpciBjeWNsaW4gcGFydG5lcnMgYW5kIGJ5IHZhcmlvdXMgaW5oaWJpdG9yeSBwcm90ZWlucy48L2xpPlxuPC91bD5cbjxoND5DZWxsIEN5Y2xlIENoZWNrcG9pbnRzPC9oND5cbjxwPkNlbGwgY3ljbGUgY2hlY2twb2ludHMgYXJlIGNydWNpYWwgY29udHJvbCBtZWNoYW5pc21zIHRoYXQgbW9uaXRvciBhbmQgcmVndWxhdGUgdGhlIHByb2dyZXNzaW9uIG9mIHRoZSBjZWxsIGN5Y2xlLiBUaGVzZSBjaGVja3BvaW50cyBlbnN1cmUgdGhhdCBhbnkgcG90ZW50aWFsIGVycm9ycyBpbiBETkEgcmVwbGljYXRpb24gb3IgZGFtYWdlIGFyZSBhZGRyZXNzZWQgYmVmb3JlIHRoZSBjZWxsIHByb2NlZWRzIHRvIHRoZSBuZXh0IHBoYXNlLiBUaGUgbWFpbiBjaGVja3BvaW50cyBpbmNsdWRlOjwvcD5cbjx1bD5cbjxsaT48c3Ryb25nPkcxIENoZWNrcG9pbnQ8L3N0cm9uZz46IFRoaXMgY2hlY2twb2ludCBhc3Nlc3NlcyB0aGUgY2VsbCdzIHNpemUsIG51dHJpZW50IHN0YXR1cywgYW5kIEROQSBpbnRlZ3JpdHkgYmVmb3JlIGFsbG93aW5nIHRoZSB0cmFuc2l0aW9uIHRvIHRoZSBTIHBoYXNlLiBJZiBjb25kaXRpb25zIGFyZSBub3QgZmF2b3JhYmxlIChlLmcuLCBpbnN1ZmZpY2llbnQgbnV0cmllbnRzIG9yIEROQSBkYW1hZ2UpLCB0aGUgY2VsbCBtYXkgZW50ZXIgYSByZXN0aW5nIHN0YXRlIChHMCkgb3IgdW5kZXJnbyByZXBhaXIgbWVjaGFuaXNtcy48L2xpPlxuPGxpPjxzdHJvbmc+RzIgQ2hlY2twb2ludDwvc3Ryb25nPjogQXQgdGhpcyBzdGFnZSwgdGhlIGNlbGwgdmVyaWZpZXMgdGhhdCBETkEgcmVwbGljYXRpb24gaGFzIGJlZW4gY29tcGxldGVkIHN1Y2Nlc3NmdWxseSBhbmQgY2hlY2tzIGZvciBhbnkgRE5BIGRhbWFnZS4gSWYgZXJyb3JzIGFyZSBkZXRlY3RlZCwgdGhlIGNlbGwgY3ljbGUgY2FuIGJlIGhhbHRlZCB0byBhbGxvdyBmb3IgcmVwYWlyIHByb2Nlc3Nlcy4gSWYgdGhlIGRhbWFnZSBpcyBpcnJlcGFyYWJsZSwgdGhlIGNlbGwgbWF5IHVuZGVyZ28gYXBvcHRvc2lzIHRvIHByZXZlbnQgdGhlIHByb3BhZ2F0aW9uIG9mIGRhbWFnZWQgRE5BLjwvbGk+XG48bGk+PHN0cm9uZz5NIENoZWNrcG9pbnQgKFNwaW5kbGUgQXNzZW1ibHkgQ2hlY2twb2ludCk8L3N0cm9uZz46IER1cmluZyBtaXRvc2lzLCB0aGUgTSBjaGVja3BvaW50IGVuc3VyZXMgdGhhdCBhbGwgY2hyb21vc29tZXMgYXJlIHByb3Blcmx5IGFsaWduZWQgYWxvbmcgdGhlIG1ldGFwaGFzZSBwbGF0ZSBhbmQgdGhhdCB0aGUgc3BpbmRsZSBhcHBhcmF0dXMgaXMgY29ycmVjdGx5IGF0dGFjaGVkIHRvIHRoZSBraW5ldG9jaG9yZXMuIFRoaXMgY2hlY2twb2ludCBwcmV2ZW50cyB0aGUgc2VwYXJhdGlvbiBvZiBjaHJvbW9zb21lcyB1bnRpbCBhbGwgYXJlIHByb3Blcmx5IHBvc2l0aW9uZWQsIHRoZXJlYnkgZW5zdXJpbmcgYWNjdXJhdGUgZGlzdHJpYnV0aW9uIG9mIGdlbmV0aWMgbWF0ZXJpYWwgdG8gdGhlIGRhdWdodGVyIGNlbGxzLjwvbGk+XG48L3VsPlxuPGg0PkltcG9ydGFuY2Ugb2YgUmVndWxhdGlvbiBhbmQgQ2hlY2twb2ludHM8L2g0PlxuPHA+VGhlIHJlZ3VsYXRpb24gb2YgdGhlIGNlbGwgY3ljbGUgaXMgdml0YWwgZm9yIG1haW50YWluaW5nIGdlbm9taWMgaW50ZWdyaXR5IGFuZCBwcmV2ZW50aW5nIHVuY29udHJvbGxlZCBjZWxsIGRpdmlzaW9uLCB3aGljaCBjYW4gbGVhZCB0byBjYW5jZXIuIE11dGF0aW9ucyBpbiBjeWNsaW5zLCBDREtzLCBvciBjaGVja3BvaW50IHByb3RlaW5zIGNhbiByZXN1bHQgaW4gZHlzcmVndWxhdGlvbiBvZiB0aGUgY2VsbCBjeWNsZSwgY29udHJpYnV0aW5nIHRvIHR1bW9yaWdlbmVzaXMuIEZvciBpbnN0YW5jZSwgb3ZlcmV4cHJlc3Npb24gb2YgQ3ljbGluIEQgaGFzIGJlZW4gbGlua2VkIHRvIHZhcmlvdXMgY2FuY2VycywgYXMgaXQgZHJpdmVzIGNlbGxzIHRvIHByb2dyZXNzIHRocm91Z2ggdGhlIGNlbGwgY3ljbGUgdW5jb250cm9sbGFibHkuPC9wPlxuPHA+SW4gc3VtbWFyeSwgdGhlIGludGVycGxheSBiZXR3ZWVuIEROQSByZXBsaWNhdGlvbiBhbmQgdGhlIGNlbGwgY3ljbGUgaXMgYSBjb3JuZXJzdG9uZSBvZiBjZWxsdWxhciBwaHlzaW9sb2d5LiBUaGUgc3VjY2Vzc2Z1bCBkdXBsaWNhdGlvbiBvZiBnZW5ldGljIG1hdGVyaWFsIGlzIG5vdCBvbmx5IGVzc2VudGlhbCBmb3IgY2VsbCBkaXZpc2lvbiBidXQgYWxzbyBmb3IgdGhlIHByZXNlcnZhdGlvbiBvZiBnZW5ldGljIGZpZGVsaXR5IGFjcm9zcyBnZW5lcmF0aW9ucy4gVW5kZXJzdGFuZGluZyB0aGVzZSBwcm9jZXNzZXMgaXMgZnVuZGFtZW50YWwgZm9yIGluc2lnaHRzIGludG8gZGV2ZWxvcG1lbnRhbCBiaW9sb2d5LCBjYW5jZXIgcmVzZWFyY2gsIGFuZCB0aGVyYXBldXRpYyBpbnRlcnZlbnRpb25zLjwvcD4iLCJxdWl6IjpbeyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGlzIHRoZSB0ZXJtIHVzZWQgdG8gZGVzY3JpYmUgdGhlIGNoYXJhY3RlcmlzdGljIG9mIEROQSByZXBsaWNhdGlvbiB3aGVyZSBlYWNoIG5ldyBETkEgbW9sZWN1bGUgY29uc2lzdHMgb2Ygb25lIG9yaWdpbmFsIHN0cmFuZCBhbmQgb25lIG5ld2x5IHN5bnRoZXNpemVkIHN0cmFuZD8iLCJvcHRpb25zIjpbIkNvbnNlcnZhdGl2ZSByZXBsaWNhdGlvbiIsIlNlbWljb25zZXJ2YXRpdmUgcmVwbGljYXRpb24iLCJEaXNwZXJzaXZlIHJlcGxpY2F0aW9uIiwiQmlkaXJlY3Rpb25hbCByZXBsaWNhdGlvbiJdLCJhbnN3ZXIiOiJTZW1pY29uc2VydmF0aXZlIHJlcGxpY2F0aW9uIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJUaGUgTWVzc2Vsc29uLVN0YWhsIGV4cGVyaW1lbnQgcHJvdmlkZWQgZXZpZGVuY2UgZm9yIHdoaWNoIG1vZGVsIG9mIEROQSByZXBsaWNhdGlvbj8iLCJvcHRpb25zIjpbIkNvbnNlcnZhdGl2ZSIsIlNlbWljb25zZXJ2YXRpdmUiLCJEaXNwZXJzaXZlIiwiUmVwbGljYXRpdmUiXSwiYW5zd2VyIjoiU2VtaWNvbnNlcnZhdGl2ZSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiRE5BIHJlcGxpY2F0aW9uIHByb2NlZWRzIGluIGhvdyBtYW55IGRpcmVjdGlvbnMgZnJvbSBhbiBvcmlnaW4gb2YgcmVwbGljYXRpb24/Iiwib3B0aW9ucyI6WyJPbmUiLCJUd28iLCJUaHJlZSIsIkZvdXIiXSwiYW5zd2VyIjoiVHdvIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGFyZSB0aGUgc3BlY2lmaWMgRE5BIHNlcXVlbmNlcyB3aGVyZSByZXBsaWNhdGlvbiBpbml0aWF0ZXMgY2FsbGVkPyIsIm9wdGlvbnMiOlsiUmVwbGljYXRpb24gZm9ya3MiLCJSZXBsaWNhdGlvbiBidWJibGVzIiwiT3JpZ2lucyBvZiByZXBsaWNhdGlvbiIsIkF1dG9ub21vdXMgUmVwbGljYXRpbmcgU2VxdWVuY2VzIl0sImFuc3dlciI6Ik9yaWdpbnMgb2YgcmVwbGljYXRpb24ifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IkluIGV1a2FyeW90aWMgY2VsbHMsIG9yaWdpbnMgb2YgcmVwbGljYXRpb24gYXJlIG9mdGVuIHJlZmVycmVkIHRvIGFzOiIsIm9wdGlvbnMiOlsiUmVwbGljYXRpb24gaW5pdGlhdG9ycyIsIkROQSBzdGFydCBzaXRlcyIsIkF1dG9ub21vdXMgUmVwbGljYXRpbmcgU2VxdWVuY2VzIChBUlMpIiwiT3JpZ2luIFJlY29nbml0aW9uIENvbXBsZXhlcyAoT1JDKSJdLCJhbnN3ZXIiOiJBdXRvbm9tb3VzIFJlcGxpY2F0aW5nIFNlcXVlbmNlcyAoQVJTKSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiSG93IG1hbnkgb3JpZ2lucyBvZiByZXBsaWNhdGlvbiBkbyBtb3N0IHByb2thcnlvdGljIGNlbGxzIHBvc3Nlc3M/Iiwib3B0aW9ucyI6WyJNdWx0aXBsZSIsIlR3byIsIk9uZSIsIlRob3VzYW5kcyJdLCJhbnN3ZXIiOiJPbmUifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IldoYXQgaXMgdGhlIGFwcHJveGltYXRlIHJhdGUgb2YgRE5BIHN5bnRoZXNpcyBhdCBlYWNoIHJlcGxpY2F0aW9uIGZvcmsgaW4gbWFtbWFsaWFuIGNlbGxzPyIsIm9wdGlvbnMiOlsiMTAwMCBiYXNlIHBhaXJzIHBlciBzZWNvbmQiLCI1MDAgYmFzZSBwYWlycyBwZXIgc2Vjb25kIiwiMTAwIGJhc2UgcGFpcnMgcGVyIHNlY29uZCIsIjUwIGJhc2UgcGFpcnMgcGVyIHNlY29uZCJdLCJhbnN3ZXIiOiIxMDAgYmFzZSBwYWlycyBwZXIgc2Vjb25kIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJVbml0cyBvZiByZXBsaWNhdGlvbiB0aGF0IGFyZSBjb21wbGV0ZWQgYXQgZGlmZmVyZW50IHRpbWVzIGR1cmluZyB0aGUgcmVwbGljYXRpb24gcHJvY2VzcyBpbiBldWthcnlvdGVzIGFyZSBjYWxsZWQ6Iiwib3B0aW9ucyI6WyJSZXBsaWNvbnMiLCJSZXBsaXNvbWVzIiwiT2themFraSBmcmFnbWVudHMiLCJSZXBsaWNhdGlvbiB1bml0cyJdLCJhbnN3ZXIiOiJSZXBsaWNvbnMifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IldoYXQgaXMgdGhlIHByaW1hcnkgcm9sZSBvZiB0aGUgT3JpZ2luIFJlY29nbml0aW9uIENvbXBsZXggKE9SQykgaW4gRE5BIHJlcGxpY2F0aW9uPyIsIm9wdGlvbnMiOlsiVW53aW5kaW5nIHRoZSBETkEgaGVsaXgiLCJTeW50aGVzaXppbmcgUk5BIHByaW1lcnMiLCJSZWNvZ25pemluZyBzcGVjaWZpYyBETkEgc2VxdWVuY2VzIGF0IG9yaWdpbnMiLCJBZGRpbmcgbnVjbGVvdGlkZXMgdG8gdGhlIGdyb3dpbmcgRE5BIHN0cmFuZCJdLCJhbnN3ZXIiOiJSZWNvZ25pemluZyBzcGVjaWZpYyBETkEgc2VxdWVuY2VzIGF0IG9yaWdpbnMifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IldoaWNoIGVuenltZSBpcyByZXNwb25zaWJsZSBmb3IgdW53aW5kaW5nIHRoZSBkb3VibGUtc3RyYW5kZWQgRE5BIGF0IHRoZSBvcmlnaW4gb2YgcmVwbGljYXRpb24/Iiwib3B0aW9ucyI6WyJETkEgcG9seW1lcmFzZSIsIkhlbGljYXNlIiwiUHJpbWFzZSIsIkxpZ2FzZSJdLCJhbnN3ZXIiOiJIZWxpY2FzZSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiV2hhdCBpcyB0aGUgZnVuY3Rpb24gb2Ygc2luZ2xlLXN0cmFuZGVkIEROQSBiaW5kaW5nIHByb3RlaW5zIGR1cmluZyBETkEgcmVwbGljYXRpb24/Iiwib3B0aW9ucyI6WyJTeW50aGVzaXplIG5ldyBETkEgc3RyYW5kcyIsIlVud2luZCB0aGUgRE5BIGRvdWJsZSBoZWxpeCIsIlByZXZlbnQgcmUtYW5uZWFsaW5nIG9mIHNpbmdsZS1zdHJhbmRlZCBETkEiLCJBZGQgUk5BIHByaW1lcnMgdG8gdGhlIHRlbXBsYXRlIHN0cmFuZCJdLCJhbnN3ZXIiOiJQcmV2ZW50IHJlLWFubmVhbGluZyBvZiBzaW5nbGUtc3RyYW5kZWQgRE5BIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGljaCBlbnp5bWUgc3ludGhlc2l6ZXMgc2hvcnQgUk5BIHByaW1lcnMgY29tcGxlbWVudGFyeSB0byB0aGUgc3NETkEgdGVtcGxhdGVzPyIsIm9wdGlvbnMiOlsiRE5BIHBvbHltZXJhc2UiLCJIZWxpY2FzZSIsIlByaW1hc2UiLCJMaWdhc2UiXSwiYW5zd2VyIjoiUHJpbWFzZSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiSW4gZXVrYXJ5b3RpYyBjZWxscywgd2hpY2ggRE5BIHBvbHltZXJhc2UgaXMgcHJpbWFyaWx5IHJlc3BvbnNpYmxlIGZvciBzeW50aGVzaXppbmcgdGhlIGxhZ2dpbmcgc3RyYW5kPyIsIm9wdGlvbnMiOlsiRE5BIFBvbHltZXJhc2UgQWxwaGEiLCJETkEgUG9seW1lcmFzZSBCZXRhIiwiRE5BIFBvbHltZXJhc2UgRGVsdGEiLCJETkEgUG9seW1lcmFzZSBFcHNpbG9uIl0sImFuc3dlciI6IkROQSBQb2x5bWVyYXNlIERlbHRhIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJETkEgcG9seW1lcmFzZXMgc3ludGhlc2l6ZSBETkEgaW4gd2hpY2ggZGlyZWN0aW9uPyIsIm9wdGlvbnMiOlsiMycgdG8gNSciLCI1JyB0byAzJyIsIkJvdGggZGlyZWN0aW9ucyBzaW11bHRhbmVvdXNseSIsIkl0IHZhcmllcyBkZXBlbmRpbmcgb24gdGhlIHN0cmFuZCJdLCJhbnN3ZXIiOiI1JyB0byAzJyJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiV2hpY2ggc3RyYW5kIG9mIEROQSBpcyBzeW50aGVzaXplZCBjb250aW51b3VzbHkgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgcmVwbGljYXRpb24gZm9yaz8iLCJvcHRpb25zIjpbIkxhZ2dpbmcgc3RyYW5kIiwiTGVhZGluZyBzdHJhbmQiLCJPa2F6YWtpIGZyYWdtZW50IiwiVGVtcGxhdGUgc3RyYW5kIl0sImFuc3dlciI6IkxlYWRpbmcgc3RyYW5kIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGFyZSB0aGUgc2hvcnQsIGRpc2NvbnRpbnVvdXMgc2VnbWVudHMgc3ludGhlc2l6ZWQgb24gdGhlIGxhZ2dpbmcgc3RyYW5kIGNhbGxlZD8iLCJvcHRpb25zIjpbIkxlYWRpbmcgZnJhZ21lbnRzIiwiUmVwbGljYXRpb24gYnViYmxlcyIsIk9rYXpha2kgZnJhZ21lbnRzIiwiUHJpbWVyIHNlZ21lbnRzIl0sImFuc3dlciI6Ik9rYXpha2kgZnJhZ21lbnRzIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGljaCBlbnp5bWUgcmVtb3ZlcyB0aGUgUk5BIHByaW1lcnMgYW5kIHJlcGxhY2VzIHRoZW0gd2l0aCBETkEgaW4gcHJva2FyeW90aWMgY2VsbHM/Iiwib3B0aW9ucyI6WyJETkEgUG9seW1lcmFzZSBJSUkiLCJETkEgUG9seW1lcmFzZSBJSSIsIkROQSBQb2x5bWVyYXNlIEkiLCJETkEgUG9seW1lcmFzZSBBbHBoYSJdLCJhbnN3ZXIiOiJETkEgUG9seW1lcmFzZSBJIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGlzIHRoZSByb2xlIG9mIEROQSBsaWdhc2UgaW4gRE5BIHJlcGxpY2F0aW9uPyIsIm9wdGlvbnMiOlsiVW53aW5kaW5nIEROQSIsIlN5bnRoZXNpemluZyBSTkEgcHJpbWVycyIsIlNlYWxpbmcgdGhlIG5pY2tzIGJldHdlZW4gRE5BIGZyYWdtZW50cyIsIlJlbW92aW5nIGluY29ycmVjdCBudWNsZW90aWRlcyJdLCJhbnN3ZXIiOiJTZWFsaW5nIHRoZSBuaWNrcyBiZXR3ZWVuIEROQSBmcmFnbWVudHMifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IldoaWNoIHR5cGUgb2YgdG9wb2lzb21lcmFzZSBjdXRzIG9uZSBzdHJhbmQgb2YgdGhlIEROQSBoZWxpeCB0byByZWxpZXZlIHN1cGVyY29pbGluZz8iLCJvcHRpb25zIjpbIlR5cGUgSUlJIiwiVHlwZSBJSSIsIlR5cGUgSSIsIlR5cGUgSVYiXSwiYW5zd2VyIjoiVHlwZSBJIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGlzIHRoZSBmdW5jdGlvbiBvZiB0ZWxvbWVyYXNlIGluIGV1a2FyeW90aWMgY2VsbHM/Iiwib3B0aW9ucyI6WyJVbndpbmRpbmcgRE5BIGF0IHRoZSB0ZWxvbWVyZXMiLCJBZGRpbmcgcmVwZXRpdGl2ZSBudWNsZW90aWRlIHNlcXVlbmNlcyB0byB0ZWxvbWVyZXMiLCJSZXBhaXJpbmcgRE5BIGRhbWFnZSBhdCB0aGUgdGVsb21lcmVzIiwiSW5pdGlhdGluZyBETkEgcmVwbGljYXRpb24gYXQgdGhlIHRlbG9tZXJlcyJdLCJhbnN3ZXIiOiJBZGRpbmcgcmVwZXRpdGl2ZSBudWNsZW90aWRlIHNlcXVlbmNlcyB0byB0ZWxvbWVyZXMifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IkluIHdoaWNoIHBoYXNlIG9mIHRoZSBldWthcnlvdGljIGNlbGwgY3ljbGUgZG9lcyBETkEgcmVwbGljYXRpb24gb2NjdXI/Iiwib3B0aW9ucyI6WyJHMSBwaGFzZSIsIlMgcGhhc2UiLCJHMiBwaGFzZSIsIk0gcGhhc2UiXSwiYW5zd2VyIjoiUyBwaGFzZSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiV2hhdCBpcyB0aGUgcHJpbWFyeSBmdW5jdGlvbiBvZiB0aGUgRzEgcGhhc2Ugb2YgdGhlIGNlbGwgY3ljbGU/Iiwib3B0aW9ucyI6WyJETkEgcmVwbGljYXRpb24iLCJDZWxsIGdyb3d0aCBhbmQgcHJlcGFyYXRpb24gZm9yIEROQSBzeW50aGVzaXMiLCJQcmVwYXJhdGlvbiBmb3IgbWl0b3NpcyIsIkNocm9tb3NvbWUgc2VncmVnYXRpb24iXSwiYW5zd2VyIjoiQ2VsbCBncm93dGggYW5kIHByZXBhcmF0aW9uIGZvciBETkEgc3ludGhlc2lzIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJEdXJpbmcgd2hpY2ggcGhhc2Ugb2YgdGhlIGNlbGwgY3ljbGUgZG8gY2VsbHMgdHlwaWNhbGx5IGhhdmUgdHdvIHNpc3RlciBjaHJvbWF0aWRzIGZvciBlYWNoIGNocm9tb3NvbWU/Iiwib3B0aW9ucyI6WyJHMSBwaGFzZSIsIlMgcGhhc2UiLCJHMiBwaGFzZSIsIkN5dG9raW5lc2lzIl0sImFuc3dlciI6IkcyIHBoYXNlIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGljaCB0eXBlIG9mIHByb3RlaW4gcGxheXMgYSBjcnVjaWFsIHJvbGUgaW4gcmVndWxhdGluZyB0aGUgcHJvZ3Jlc3Npb24gdGhyb3VnaCB0aGUgY2VsbCBjeWNsZSBieSBwaG9zcGhvcnlsYXRpbmcgdGFyZ2V0IHByb3RlaW5zPyIsIm9wdGlvbnMiOlsiQ3ljbGlucyIsIkN5Y2xpbi1kZXBlbmRlbnQga2luYXNlcyAoQ0RLcykiLCJUdW1vciBzdXBwcmVzc29yIHByb3RlaW5zIiwiRE5BIHJlcGFpciBlbnp5bWVzIl0sImFuc3dlciI6IkN5Y2xpbi1kZXBlbmRlbnQga2luYXNlcyAoQ0RLcykifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IkN5Y2xpbiBEIGlzIGNyaXRpY2FsIGZvciB0aGUgcHJvZ3Jlc3Npb24gZnJvbSB3aGljaCBwaGFzZSB0byB3aGljaCBwaGFzZSBvZiB0aGUgY2VsbCBjeWNsZT8iLCJvcHRpb25zIjpbIlMgdG8gRzIiLCJHMiB0byBNIiwiRzEgdG8gUyIsIk0gdG8gRzEiXSwiYW5zd2VyIjoiRzEgdG8gUyJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiV2hpY2ggY2VsbCBjeWNsZSBjaGVja3BvaW50IGFzc2Vzc2VzIHRoZSBjZWxsJ3Mgc2l6ZSwgbnV0cmllbnQgc3RhdHVzLCBhbmQgRE5BIGludGVncml0eSBiZWZvcmUgYWxsb3dpbmcgZW50cnkgaW50byB0aGUgUyBwaGFzZT8iLCJvcHRpb25zIjpbIkcyIGNoZWNrcG9pbnQiLCJNIGNoZWNrcG9pbnQiLCJHMSBjaGVja3BvaW50IiwiUyBjaGVja3BvaW50Il0sImFuc3dlciI6IkcxIGNoZWNrcG9pbnQifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IldoYXQgaGFwcGVucyBhdCB0aGUgRzIgY2hlY2twb2ludCBpZiBETkEgcmVwbGljYXRpb24gaGFzIG5vdCBiZWVuIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgb3IgaWYgdGhlcmUgaXMgRE5BIGRhbWFnZT8iLCJvcHRpb25zIjpbIlRoZSBjZWxsIGltbWVkaWF0ZWx5IHByb2NlZWRzIHRvIG1pdG9zaXMuIiwiVGhlIGNlbGwgZW50ZXJzIHRoZSBHMCBwaGFzZS4iLCJUaGUgY2VsbCBjeWNsZSBjYW4gYmUgaGFsdGVkIHRvIGFsbG93IGZvciByZXBhaXIuIiwiVGhlIGNlbGwgdW5kZXJnb2VzIGN5dG9raW5lc2lzLiJdLCJhbnN3ZXIiOiJUaGUgY2VsbCBjeWNsZSBjYW4gYmUgaGFsdGVkIHRvIGFsbG93IGZvciByZXBhaXIuIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJUaGUgTSBjaGVja3BvaW50LCBhbHNvIGtub3duIGFzIHRoZSBzcGluZGxlIGFzc2VtYmx5IGNoZWNrcG9pbnQsIGVuc3VyZXMgdGhhdDoiLCJvcHRpb25zIjpbIkROQSByZXBsaWNhdGlvbiBpcyBjb21wbGV0ZS4iLCJUaGUgY2VsbCBoYXMgcmVhY2hlZCBhbiBhZGVxdWF0ZSBzaXplLiIsIkFsbCBjaHJvbW9zb21lcyBhcmUgcHJvcGVybHkgYWxpZ25lZCBhdCB0aGUgbWV0YXBoYXNlIHBsYXRlLiIsIlRoZXJlIGlzIG5vIEROQSBkYW1hZ2UuIl0sImFuc3dlciI6IkFsbCBjaHJvbW9zb21lcyBhcmUgcHJvcGVybHkgYWxpZ25lZCBhdCB0aGUgbWV0YXBoYXNlIHBsYXRlLiJ9XX0seyJpZCI6IkIiLCJ0aXRsZSI6IkROQSBSZXBhaXIiLCJjb250ZW50IjoiPGgyPkIuIEROQSBSZXBhaXI8L2gyPlxuPGgzPjEuIFJlcGxpY2F0aW9uIEVycm9ycyBhbmQgRE5BIERhbWFnZTwvaDM+XG48cD5ETkEgcmVwbGljYXRpb24gaXMgYSBoaWdoLWZpZGVsaXR5IHByb2Nlc3MsIGJ1dCBlcnJvcnMgY2FuIHN0aWxsIG9jY3VyLiBVbmRlcnN0YW5kaW5nIHRoZSBuYXR1cmUgb2YgdGhlc2UgZXJyb3JzIGFuZCB0aGUgbWVjaGFuaXNtcyBvZiBETkEgZGFtYWdlIGlzIGNydWNpYWwgZm9yIG1haW50YWluaW5nIGdlbm9taWMgaW50ZWdyaXR5LjwvcD5cbjx1bD5cbjxsaT48c3Ryb25nPkROQSBSZXBsaWNhdGlvbiBGaWRlbGl0eSBhbmQgUmVwbGljYXRpb24gRXJyb3JzPC9zdHJvbmc+OlxuPHVsPlxuPGxpPkROQSBwb2x5bWVyYXNlcyBleGhpYml0IGEgdmVyeSBsb3cgbWlzdGFrZSByYXRlLCBhcHByb3hpbWF0ZWx5IDEgZXJyb3IgaW4gMTAsMDAwIG51Y2xlb3RpZGVzIGFkZGVkIHRvIHRoZSBjaGFpbi48L2xpPlxuPGxpPlRoaXMgaGlnaCBmaWRlbGl0eSBpcyBlbmhhbmNlZCBmdXJ0aGVyIGJ5IHRoZSBwcm9vZnJlYWRpbmcgYWN0aXZpdHkgb2YgRE5BIHBvbHltZXJhc2VzLCBzcGVjaWZpY2FsbHkgdGhlaXIgMycgdG8gNScgZXhvbnVjbGVhc2UgYWN0aXZpdHkuIFRoaXMgYWN0aXZpdHkgYWxsb3dzIHRoZW0gdG8gZGV0ZWN0IGFuZCByZW1vdmUgaW5jb3JyZWN0bHkgaW5jb3Jwb3JhdGVkIG51Y2xlb3RpZGVzIHByb21wdGx5LjwvbGk+XG48bGk+VGhlIHByb29mcmVhZGluZyBjYXBhYmlsaXR5IHNpZ25pZmljYW50bHkgZW5oYW5jZXMgdGhlIGZpZGVsaXR5IG9mIEROQSByZXBsaWNhdGlvbiwgcmVkdWNpbmcgdGhlIG1pc3Rha2UgcmF0ZSB0byBhYm91dCAxIGVycm9yIGluIDEgYmlsbGlvbiBudWNsZW90aWRlcy48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5DaGVtaXN0cnkgb2YgRE5BIGFuZCBSZXBsaWNhdGlvbiBFcnJvcnM8L3N0cm9uZz46XG48dWw+XG48bGk+RXZlbiB1bmRlciBpZGVhbCBjb25kaXRpb25zLCBpdCBpcyBjaGVtaWNhbGx5IGltcG9zc2libGUgdG8gYXZvaWQgc29tZSBudWNsZW90aWRlIGNoYW5nZXMgZHVyaW5nIHJlcGxpY2F0aW9uLiBTcG9udGFuZW91cyBjaGVtaWNhbCBjaGFuZ2VzLCBzdWNoIGFzIHRhdXRvbWVyaXNtIG9yIGRlYW1pbmF0aW9uLCBjYW4gbGVhZCB0byBtaXNtYXRjaGVzIGluIGJhc2UgcGFpcmluZyB0aGF0IHdpbGwgYmUgcHJvcGFnYXRlZCBpbiBzdWJzZXF1ZW50IHJvdW5kcyBvZiByZXBsaWNhdGlvbi48L2xpPlxuPGxpPkZvciBleGFtcGxlLCBjeXRvc2luZSBkZWFtaW5hdGlvbiBjYW4gY29udmVydCBjeXRvc2luZSBpbnRvIHVyYWNpbCwgbGVhZGluZyB0byBhIEcgdG8gQSB0cmFuc2l0aW9uIGlmIG5vdCByZXBhaXJlZC48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5ETkEgRGFtYWdlPC9zdHJvbmc+OlxuPHVsPlxuPGxpPkVudmlyb25tZW50YWwgZmFjdG9ycyBjYW4gYWxzbyBjYXVzZSBzaWduaWZpY2FudCBkYW1hZ2UgdG8gRE5BLiBQaHlzaWNhbCBmYWN0b3JzLCBzdWNoIGFzIHJhZGlhdGlvbiAoVVYgbGlnaHQsIFgtcmF5cywgZ2FtbWEgcmF5cyksIGNhbiBsZWFkIHRvIHZhcmlvdXMgZm9ybXMgb2YgRE5BIGRhbWFnZS48L2xpPlxuPGxpPkNoZW1pY2FsIGZhY3RvcnMgY2FuIGluY2x1ZGUgbXV0YWdlbnMgKHN1YnN0YW5jZXMgdGhhdCBpbmR1Y2UgbXV0YXRpb25zKSBhbmQgZnJlZSByYWRpY2Fscywgd2hpY2ggY2FuIHJlYWN0IHdpdGggRE5BIGFuZCBjYXVzZSBsZXNpb25zLiBXZWxsLWtub3duIG11dGFnZW5zIGluY2x1ZGUgYWZsYXRveGlucyBmcm9tIGZ1bmdpLCBiZW56ZW5lLCBhbmQgY2VydGFpbiBjb21wb3VuZHMgZm91bmQgaW4gdG9iYWNjbyBzbW9rZS48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuXG48aDM+Mi4gRE5BIFJlcGFpciBNZWNoYW5pc21zPC9oMz5cbjxwPkNlbGxzIGhhdmUgZXZvbHZlZCBzZXZlcmFsIG1lY2hhbmlzbXMgdG8gcmVwYWlyIEROQSByZXBsaWNhdGlvbiBlcnJvcnMgYW5kIGRhbWFnZSwgY2xhc3NpZmllZCBpbnRvIHRocmVlIG1haW4gc3lzdGVtcyBpbiBldWthcnlvdGljIGNlbGxzOjwvcD5cbjx1bD5cbjxsaT48c3Ryb25nPk1pc21hdGNoIFJlcGFpciBTeXN0ZW08L3N0cm9uZz46XG48dWw+XG48bGk+VGhpcyBzeXN0ZW0gaXMgcmVzcG9uc2libGUgZm9yIHJlcGFpcmluZyBzaW5nbGUgYmFzZSBwYWlyIG1pc21hdGNoZXMsIHN1Y2ggYXMgdGhvc2UgYXJpc2luZyBmcm9tIHJlcGxpY2F0aW9uIGVycm9ycyBvciBjeXRvc2luZSBkZWFtaW5hdGlvbi48L2xpPlxuPGxpPlRoZSBwcm9jZXNzIGludm9sdmVzIHNldmVyYWwgc3RlcHM6XG48dWw+XG48bGk+QSBwcm90ZWluIGNvbXBsZXggcmVjb2duaXplcyB0aGUgbWlzbWF0Y2guPC9saT5cbjxsaT5Gb3IgY3l0b3NpbmUgZGVhbWluYXRpb25zLCBhIGdseWNvc2lkYXNlIHJlbW92ZXMgdGhlIG1vZGlmaWVkIG5pdHJvZ2Vub3VzIGJhc2UuPC9saT5cbjxsaT5BZGRpdGlvbmFsIHByb3RlaW5zIHJlbW92ZSB0aGUgbWlzbWF0Y2hlZCBudWNsZW90aWRlIGFuZCBzZXZlcmFsIHN1cnJvdW5kaW5nIG51Y2xlb3RpZGVzLjwvbGk+XG48bGk+RE5BIHBvbHltZXJhc2UsIHNwZWNpZmljYWxseSBETkEtUG9sLUJldGEgZm9yIGN5dG9zaW5lIGRlYW1pbmF0aW9ucywgc3ludGhlc2l6ZXMgdGhlIGNvcnJlY3QgbnVjbGVvdGlkZS48L2xpPlxuPGxpPkZpbmFsbHksIEROQSBsaWdhc2Ugc2VhbHMgdGhlIHJlcGFpcmVkIHN0cmFuZCBieSBmb3JtaW5nIGEgbmV3IGNvdmFsZW50IHBob3NwaG9kaWVzdGVyIGJvbmQuPC9saT5cbjwvdWw+XG48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5FeGNpc2lvbiBSZXBhaXIgU3lzdGVtPC9zdHJvbmc+OlxuPHVsPlxuPGxpPlRoaXMgc3lzdGVtIGFkZHJlc3NlcyBETkEgZGFtYWdlIGFmZmVjdGluZyBtb3JlIHRoYW4gb25lIG51Y2xlb3RpZGUsIHBhcnRpY3VsYXJseSBkYW1hZ2UgdGhhdCBkb2VzIG5vdCBsZWFkIHRvIGRvdWJsZS1zdHJhbmQgYnJlYWtzLjwvbGk+XG48bGk+VGhlIGV4Y2lzaW9uIHJlcGFpciBtZWNoYW5pc20gaXMgZXhlbXBsaWZpZWQgYnkgdGhlIHJlcGFpciBvZiB0aHltaW5lIGRpbWVycyBjYXVzZWQgYnkgVVYgbGlnaHQ6XG48dWw+XG48bGk+QSBwcm90ZWluIGNvbXBsZXggcmVjb2duaXplcyB0aGUgZGFtYWdlZCBhcmVhLCBzdWNoIGFzIHRoZSBjcm9zc2xpbmtlZCB0aHltaW5lIGJhc2VzLjwvbGk+XG48bGk+RW56eW1lcyByZW1vdmUgdGhlIGRhbWFnZWQgcmVnaW9uIGJ5IHNlcGFyYXRpbmcgdGhlIHN0cmFuZHMgYW5kIGV4Y2lzaW5nIHRoZSBhZmZlY3RlZCBudWNsZW90aWRlcy48L2xpPlxuPGxpPkROQSBwb2x5bWVyYXNlIHVzZXMgdGhlIGludGFjdCBzdHJhbmQgYXMgYSB0ZW1wbGF0ZSB0byBzeW50aGVzaXplIHRoZSBjb3JyZWN0ZWQgRE5BIHN0cmFuZC48L2xpPlxuPGxpPkROQSBsaWdhc2UgY29tcGxldGVzIHRoZSByZXBhaXIgcHJvY2Vzcy48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuPC9saT5cbjxsaT48c3Ryb25nPkVuZC1Kb2luaW5nIFJlcGFpciBTeXN0ZW0gKE5IRUopPC9zdHJvbmc+OlxuPHVsPlxuPGxpPlRoaXMgc3lzdGVtIGF0dGVtcHRzIHRvIHJlcGFpciBkb3VibGUtc3RyYW5kIGJyZWFrcyBpbiBETkEsIHdoaWNoIGFyZSBtb3JlIHNldmVyZSBhbmQgY2FuIGxlYWQgdG8gc2lnbmlmaWNhbnQgZ2VuZXRpYyBjb25zZXF1ZW5jZXMuPC9saT5cbjxsaT5UaGUgTkhFSiBwcm9jZXNzIGludm9sdmVzIHNldmVyYWwgc3RlcHM6XG48dWw+XG48bGk+UHJvdGVpbiBjb21wbGV4ZXMgcmVjb2duaXplIHRoZSBicm9rZW4gZW5kcyBhbmQgYmluZCB0byB0aGVtLjwvbGk+XG48bGk+SGVsaWNhc2VzIG9wZW4gdGhlIEROQSwgYW5kIHRoZSByZXBhaXIgY29tcGxleGVzIHByb21vdGUgdGVtcG9yYXJ5IGFsaWdubWVudHMgdGhyb3VnaCBtaWNyb2hvbW9sb2d5IGRvbWFpbnMuPC9saT5cbjxsaT5OdWNsZWFzZXMgdHJpbSBhbmQgcG9saXNoIHRoZSBwcm90cnVkaW5nIGVuZHMgYmVmb3JlIGxpZ2F0aW9uLjwvbGk+XG48bGk+QWx0aG91Z2ggTkhFSiBjYW4gZWZmZWN0aXZlbHkgcmVwYWlyIGRvdWJsZS1zdHJhbmQgYnJlYWtzLCBpdCBvZnRlbiByZXN1bHRzIGluIG11dGF0aW9ucyB0aGF0IG1heSBhZmZlY3QgY2VsbHVsYXIgZnVuY3Rpb24uPC9saT5cbjwvdWw+XG48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuXG48aDM+My4gQ29uc2VxdWVuY2VzIG9mIFJlcGxpY2F0aW9uIEVycm9ycyBhbmQgRE5BIERhbWFnZTwvaDM+XG48dWw+XG48bGk+PHN0cm9uZz5Ub2xlcmFibGUgTGV2ZWxzIG9mIEVycm9yczwvc3Ryb25nPjpcbjx1bD5cbjxsaT5XaGlsZSBzbWFsbCBsZXZlbHMgb2YgZXJyb3JzIG9yIGRhbWFnZSBjYW4gc29tZXRpbWVzIGJlIHRvbGVyYXRlZCBhbmQgbWF5IGV2ZW4gY29uZmVyIGV2b2x1dGlvbmFyeSBhZHZhbnRhZ2VzIGJ5IHByb21vdGluZyBnZW5ldGljIGRpdmVyc2l0eSwgdW5jaGVja2VkIGVycm9ycyBjYW4gYmUgZGV0cmltZW50YWwuPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+Q2FuY2VyIGFuZCBNdXRhdGlvbnM8L3N0cm9uZz46XG48dWw+XG48bGk+VGhlIGFjY3VtdWxhdGlvbiBvZiBtdXRhdGlvbnMgaXMgZnJlcXVlbnRseSBhc3NvY2lhdGVkIHdpdGggY2FuY2VyIGRldmVsb3BtZW50IChjYXJjaW5vZ2VuZXNpcykuIEZvciBpbnN0YW5jZSwgZXJyb3JzIGluIGNyaXRpY2FsIGdlbmVzIHRoYXQgcmVndWxhdGUgY2VsbCBkaXZpc2lvbiBjYW4gbGVhZCB0byB1bmNvbnRyb2xsZWQgZ3Jvd3RoIGFuZCB0dW1vciBmb3JtYXRpb24uPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+Q2VsbCBEZWF0aCBhbmQgRGlzZWFzZXM8L3N0cm9uZz46XG48dWw+XG48bGk+RXhjZXNzaXZlIEROQSBkYW1hZ2UgY2FuIHRyaWdnZXIgY2VsbHVsYXIgbWVjaGFuaXNtcyBsZWFkaW5nIHRvIGNlbGwgZGVhdGggKGFwb3B0b3NpcyksIGNvbnRyaWJ1dGluZyB0byBkZWdlbmVyYXRpdmUgZGlzZWFzZXMsIHByZW1hdHVyZSBhZ2luZywgYW5kIG9yZ2FuIGZhaWx1cmUgaWYgc3lzdGVtaWMuPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+UmVwYWlyIFN5c3RlbXMgYW5kIEdlbm9taWMgSW50ZWdyaXR5PC9zdHJvbmc+OlxuPHVsPlxuPGxpPlRoZSBwcmVzZW5jZSBvZiBlZmZpY2llbnQgRE5BIHJlcGFpciBzeXN0ZW1zIGlzIGVzc2VudGlhbCBmb3IgbWluaW1pemluZyByZXBsaWNhdGlvbiBlcnJvcnMgYW5kIGRhbWFnZSwgdGhlcmVieSBwcmVzZXJ2aW5nIHRoZSBpbnRlZ3JpdHkgb2YgdGhlIGdlbmV0aWMgbWF0ZXJpYWwuPC9saT5cbjwvdWw+XG48L2xpPlxuPC91bD4iLCJxdWl6IjpbeyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IGlzIHRoZSBhcHByb3hpbWF0ZSBlcnJvciByYXRlIG9mIEROQSBwb2x5bWVyYXNlcyBiZWZvcmUgcHJvb2ZyZWFkaW5nPyIsIm9wdGlvbnMiOlsiMSBlcnJvciBpbiAxMDAgbnVjbGVvdGlkZXMiLCIxIGVycm9yIGluIDEsMDAwIG51Y2xlb3RpZGVzIiwiMSBlcnJvciBpbiAxMCwwMDAgbnVjbGVvdGlkZXMiLCIxIGVycm9yIGluIDEsMDAwLDAwMCBudWNsZW90aWRlcyJdLCJhbnN3ZXIiOiIxIGVycm9yIGluIDEwLDAwMCBudWNsZW90aWRlcyJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiVGhlIDMnIHRvIDUnIGV4b251Y2xlYXNlIGFjdGl2aXR5IG9mIEROQSBwb2x5bWVyYXNlcyBpcyByZXNwb25zaWJsZSBmb3I6Iiwib3B0aW9ucyI6WyJVbndpbmRpbmcgdGhlIEROQSBoZWxpeC4iLCJTeW50aGVzaXppbmcgUk5BIHByaW1lcnMuIiwiUHJvb2ZyZWFkaW5nIGFuZCByZW1vdmluZyBpbmNvcnJlY3QgbnVjbGVvdGlkZXMuIiwiSm9pbmluZyBPa2F6YWtpIGZyYWdtZW50cy4iXSwiYW5zd2VyIjoiUHJvb2ZyZWFkaW5nIGFuZCByZW1vdmluZyBpbmNvcnJlY3QgbnVjbGVvdGlkZXMuIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGF0IHR5cGUgb2Ygc3BvbnRhbmVvdXMgY2hlbWljYWwgY2hhbmdlIGNhbiBjb252ZXJ0IGN5dG9zaW5lIGludG8gdXJhY2lsIGluIEROQT8iLCJvcHRpb25zIjpbIkFsa3lsYXRpb24iLCJPeGlkYXRpb24iLCJEZWFtaW5hdGlvbiIsIkh5ZHJvbHlzaXMiXSwiYW5zd2VyIjoiRGVhbWluYXRpb24ifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IlRoeW1pbmUgZGltZXJzIGluIEROQSBhcmUgY29tbW9ubHkgY2F1c2VkIGJ5IGV4cG9zdXJlIHRvOiIsIm9wdGlvbnMiOlsiWC1yYXlzIiwiR2FtbWEgcmF5cyIsIlVWIGxpZ2h0IiwiSW5mcmFyZWQgcmFkaWF0aW9uIl0sImFuc3dlciI6IlVWIGxpZ2h0In0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJXaGljaCBETkEgcmVwYWlyIHN5c3RlbSBpcyBwcmltYXJpbHkgcmVzcG9uc2libGUgZm9yIHJlcGFpcmluZyBzaW5nbGUgYmFzZSBwYWlyIG1pc21hdGNoZXM/Iiwib3B0aW9ucyI6WyJFeGNpc2lvbiBSZXBhaXIgU3lzdGVtIiwiRW5kLUpvaW5pbmcgUmVwYWlyIFN5c3RlbSAoTkhFSikiLCJNaXNtYXRjaCBSZXBhaXIgU3lzdGVtIiwiSG9tb2xvZ291cyBSZWNvbWJpbmF0aW9uIl0sImFuc3dlciI6Ik1pc21hdGNoIFJlcGFpciBTeXN0ZW0ifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IlRoZSByZXBhaXIgb2YgdGh5bWluZSBkaW1lcnMgY2F1c2VkIGJ5IFVWIGxpZ2h0IGlzIGFuIGV4YW1wbGUgb2Ygd2hpY2ggRE5BIHJlcGFpciBtZWNoYW5pc20/Iiwib3B0aW9ucyI6WyJNaXNtYXRjaCBSZXBhaXIgU3lzdGVtIiwiRXhjaXNpb24gUmVwYWlyIFN5c3RlbSIsIkVuZC1Kb2luaW5nIFJlcGFpciBTeXN0ZW0gKE5IRUopIiwiSG9tb2xvZ291cyBSZWNvbWJpbmF0aW9uIl0sImFuc3dlciI6IkV4Y2lzaW9uIFJlcGFpciBTeXN0ZW0ifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IkRvdWJsZS1zdHJhbmQgYnJlYWtzIGluIEROQSBhcmUgb2Z0ZW4gcmVwYWlyZWQgYnkgd2hpY2ggc3lzdGVtPyIsIm9wdGlvbnMiOlsiTWlzbWF0Y2ggUmVwYWlyIFN5c3RlbSIsIkV4Y2lzaW9uIFJlcGFpciBTeXN0ZW0iLCJFbmQtSm9pbmluZyBSZXBhaXIgU3lzdGVtIChOSEVKKSIsIkJhc2UgRXhjaXNpb24gUmVwYWlyIl0sImFuc3dlciI6IkVuZC1Kb2luaW5nIFJlcGFpciBTeXN0ZW0gKE5IRUopIn1dfSx7ImlkIjoiQyIsInRpdGxlIjoiUmVjb21iaW5hdGlvbiIsImNvbnRlbnQiOiI8aDI+Qy4gUmVjb21iaW5hdGlvbjwvaDI+XG48aDM+MS4gRGVmaW5pdGlvbiBhbmQgTWVjaGFuaXNtczwvaDM+XG48cD5Ib21vbG9nb3VzIHJlY29tYmluYXRpb24gaXMgYSBmdW5kYW1lbnRhbCBwcm9jZXNzIHRoYXQgYWxsb3dzIGNlbGxzIHRvIGV4Y2hhbmdlIGJsb2NrcyBvZiBETkEgdGhhdCBzaGFyZSBzaW1pbGFyIHNlcXVlbmNlcy4gVGhpcyBtZWNoYW5pc20gaXMgZXNzZW50aWFsIGZvciB2YXJpb3VzIGJpb2xvZ2ljYWwgZnVuY3Rpb25zLCBpbmNsdWRpbmcgRE5BIHJlcGFpciwgZ2VuZXRpYyBkaXZlcnNpdHkgZHVyaW5nIHNleHVhbCByZXByb2R1Y3Rpb24sIGFuZCB0aGUgbWFpbnRlbmFuY2Ugb2YgZ2Vub21pYyBzdGFiaWxpdHkuPC9wPlxuPHVsPlxuPGxpPjxzdHJvbmc+RGVmaW5pdGlvbiBvZiBIb21vbG9nb3VzIFJlY29tYmluYXRpb248L3N0cm9uZz46XG48dWw+XG48bGk+SG9tb2xvZ291cyByZWNvbWJpbmF0aW9uIGlzIGRlZmluZWQgYXMgdGhlIGV4Y2hhbmdlIG9mIGdlbmV0aWMgbWF0ZXJpYWwgYmV0d2VlbiBob21vbG9nb3VzIEROQSBtb2xlY3VsZXPigJR0aG9zZSB0aGF0IGNvbnRhaW4gc2ltaWxhciBvciBpZGVudGljYWwgc2VxdWVuY2VzLiBCb3RoIHByb2thcnlvdGljIGFuZCBldWthcnlvdGljIGNlbGxzIGVtcGxveSB0aGlzIHN5c3RlbSB0byBmYWNpbGl0YXRlIGdlbmV0aWMgZXhjaGFuZ2UuPC9saT5cbjwvdWw+XG48L2xpPlxuPC91bD5cblxuPGgzPjIuIE1lY2hhbmlzbSAtIFRoZSBIb2xsaWRheSBNb2RlbDwvaDM+XG48cD5UaGUgSG9sbGlkYXkgbW9kZWwsIHByb3Bvc2VkIGJ5IERyLiBSb2JpbiBIb2xsaWRheSBpbiAxOTY0LCBkZXNjcmliZXMgdGhlIG11bHRpLXN0ZXAgcHJvY2VzcyBvZiBob21vbG9nb3VzIHJlY29tYmluYXRpb24uIFRoZSBrZXkgc3RlcHMgaW52b2x2ZWQgaW4gdGhpcyBtb2RlbCBhcmU6PC9wPlxuPHVsPlxuPGxpPjxzdHJvbmc+U2luZ2xlIFN0cmFuZCBCcmVhayAoTmljayk8L3N0cm9uZz46XG48dWw+XG48bGk+VGhlIHByb2Nlc3MgYmVnaW5zIHdpdGggdGhlIGludHJvZHVjdGlvbiBvZiBhIHNpbmdsZS1zdHJhbmQgYnJlYWsgaW4gb25lIG9mIHRoZSBob21vbG9nb3VzIEROQSBtb2xlY3VsZXMuIFRoaXMgbmljayBpcyBlc3NlbnRpYWwgZm9yIHRoZSBpbml0aWF0aW9uIG9mIHN0cmFuZCBpbnZhc2lvbi48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5TdHJhbmQgSW52YXNpb24gKENyb3NzaW5nKTwvc3Ryb25nPjpcbjx1bD5cbjxsaT5UaGUgYnJva2VuIHN0cmFuZCB0aGVuIGludmFkZXMgdGhlIGhvbW9sb2dvdXMgRE5BIG1vbGVjdWxlLCBkaXNwbGFjaW5nIG9uZSBvZiBpdHMgc3RyYW5kcy4gVGhpcyBmb3JtcyBhIHN0cnVjdHVyZSBrbm93biBhcyBhIEQtbG9vcCAoZGlzcGxhY2VtZW50IGxvb3ApLjwvbGk+XG48L3VsPlxuPC9saT5cbjxsaT48c3Ryb25nPlN0cmFuZCBNaWdyYXRpb248L3N0cm9uZz46XG48dWw+XG48bGk+VGhlIGludmFkaW5nIHN0cmFuZCB1bmRlcmdvZXMgc3RyYW5kIG1pZ3JhdGlvbiwgYWxsb3dpbmcgZm9yIHRoZSBleGNoYW5nZSBvZiBnZW5ldGljIGluZm9ybWF0aW9uIGJldHdlZW4gdGhlIHR3byBETkEgbW9sZWN1bGVzLiBUaGlzIG1pZ3JhdGlvbiBjYW4gcmVzdWx0IGluIHRoZSBmb3JtYXRpb24gb2YgbmV3IGdlbmV0aWMgY29tYmluYXRpb25zLjwvbGk+XG48L3VsPlxuPC9saT5cbjxsaT48c3Ryb25nPkludGVybWVkaWF0ZSAoSG9sbGlkYXkpIFN0cnVjdHVyZTwvc3Ryb25nPjpcbjx1bD5cbjxsaT5BcyB0aGUgc3RyYW5kcyBjb250aW51ZSB0byBleGNoYW5nZSwgYSBjb21wbGV4IHN0cnVjdHVyZSBrbm93biBhcyB0aGUgSG9sbGlkYXkganVuY3Rpb24gZm9ybXMuIFRoaXMgc3RydWN0dXJlIGlzIGNoYXJhY3Rlcml6ZWQgYnkgdGhlIGludGVydHdpbmluZyBvZiB0aGUgdHdvIEROQSBtb2xlY3VsZXMuPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+UmVzb2x1dGlvbiB0byBDb21wbGV0ZSB0aGUgRXhjaGFuZ2U8L3N0cm9uZz46XG48dWw+XG48bGk+VGhlIGZpbmFsIHN0ZXAgaW52b2x2ZXMgdGhlIHJlc29sdXRpb24gb2YgdGhlIEhvbGxpZGF5IGp1bmN0aW9uLiBUaGlzIGNhbiBvY2N1ciB0aHJvdWdoIHR3byBkaWZmZXJlbnQgcGF0aHdheXM6XG48dWw+XG48bGk+PHN0cm9uZz5DdXR0aW5nIGFuZCBDcm9zcy1TZWFsaW5nPC9zdHJvbmc+OiBUaGUganVuY3Rpb24gaXMgY3V0LCBhbmQgdGhlIHN0cmFuZHMgYXJlIHNlYWxlZCwgcmVzdWx0aW5nIGluIHRoZSBleGNoYW5nZSBvZiBnZW5ldGljIG1hdGVyaWFsLjwvbGk+XG48bGk+PHN0cm9uZz5Ob24tQ3Jvc3NvdmVyIFJlc29sdXRpb248L3N0cm9uZz46IFNvbWV0aW1lcywgdGhlIGp1bmN0aW9uIGNhbiBiZSByZXNvbHZlZCB3aXRob3V0IGNyb3Nzb3ZlciwgbGVhZGluZyB0byB0aGUgcmVzdG9yYXRpb24gb2YgdGhlIG9yaWdpbmFsIHNlcXVlbmNlcyB3aXRoIG5vIGV4Y2hhbmdlLjwvbGk+XG48L3VsPlxuPC9saT5cbjwvdWw+XG48L2xpPlxuPC91bD5cblxuPGgzPjMuIFByb3RlaW5zIEludm9sdmVkIGluIFJlY29tYmluYXRpb248L2gzPlxuPHA+TXVsdGlwbGUgcHJvdGVpbnMgbWVkaWF0ZSB0aGUgc3RlcHMgb2YgaG9tb2xvZ291cyByZWNvbWJpbmF0aW9uLCBlbnN1cmluZyB0aGUgcHJvY2VzcyBpcyBlZmZpY2llbnQgYW5kIGFjY3VyYXRlOjwvcD5cbjx1bD5cbjxsaT48c3Ryb25nPlJlY0EgUHJvdGVpbjwvc3Ryb25nPjpcbjx1bD5cbjxsaT5JbiBwcm9rYXJ5b3RlcywgUmVjQSBwbGF5cyBhIGNydWNpYWwgcm9sZSBpbiBzdHJhbmQgaW52YXNpb24gYW5kIGFsaWdubWVudCBkdXJpbmcgcmVjb21iaW5hdGlvbi4gSXQgZmFjaWxpdGF0ZXMgdGhlIHNlYXJjaCBmb3IgaG9tb2xvZ291cyBzZXF1ZW5jZXMgYW5kIHByb21vdGVzIHN0cmFuZCBleGNoYW5nZS48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5SYWQ1MSBQcm90ZWluPC9zdHJvbmc+OlxuPHVsPlxuPGxpPlRoZSBldWthcnlvdGljIGVxdWl2YWxlbnQgb2YgUmVjQSBpcyBSYWQ1MS4gVGhpcyBwcm90ZWluIGlzIGVzc2VudGlhbCBmb3IgdGhlIHJlcGFpciBvZiBkb3VibGUtc3RyYW5kIGJyZWFrcyBhbmQgaXMgaW52b2x2ZWQgaW4gdGhlIGZvcm1hdGlvbiBvZiB0aGUgRC1sb29wIGR1cmluZyBzdHJhbmQgaW52YXNpb24uPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+UnV2IFByb3RlaW5zPC9zdHJvbmc+OlxuPHVsPlxuPGxpPkluIHByb2thcnlvdGVzLCB0aGUgUnV2IHByb3RlaW5zIChSdXZBLCBSdXZCLCBSdXZDKSBhcmUgaW52b2x2ZWQgaW4gdGhlIHJlc29sdXRpb24gb2YgdGhlIEhvbGxpZGF5IGp1bmN0aW9uLiBSdXZBIHJlY29nbml6ZXMgdGhlIGp1bmN0aW9uLCBSdXZCIHByb21vdGVzIGJyYW5jaCBtaWdyYXRpb24sIGFuZCBSdXZDIGlzIHJlc3BvbnNpYmxlIGZvciBjbGVhdmluZyB0aGUganVuY3Rpb24gdG8gcmVzb2x2ZSBpdC48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuXG48aDM+NC4gRnVuY3Rpb25zIG9mIEhvbW9sb2dvdXMgUmVjb21iaW5hdGlvbjwvaDM+XG48cD5Ib21vbG9nb3VzIHJlY29tYmluYXRpb24gc2VydmVzIHNldmVyYWwgY3JpdGljYWwgZnVuY3Rpb25zIHdpdGhpbiB0aGUgY2VsbDo8L3A+XG48dWw+XG48bGk+PHN0cm9uZz5ETkEgUmVwYWlyIFN5c3RlbTwvc3Ryb25nPjpcbjx1bD5cbjxsaT5Ib21vbG9nb3VzIHJlY29tYmluYXRpb24gcHJvdmlkZXMgYW4gYWx0ZXJuYXRpdmUgcGF0aHdheSBmb3IgcmVwYWlyaW5nIGRvdWJsZS1zdHJhbmQgYnJlYWtzLCBwYXJ0aWN1bGFybHkgd2hlbiB0aGUgbm9uLWhvbW9sb2dvdXMgZW5kIGpvaW5pbmcgKE5IRUopIHN5c3RlbSBpcyBpbmFkZXF1YXRlIG9yIGxlYWRzIHRvIG11dGF0aW9ucy48L2xpPlxuPC91bD5cbjwvbGk+XG48bGk+PHN0cm9uZz5HZW5ldGljIERpdmVyc2l0eTwvc3Ryb25nPjpcbjx1bD5cbjxsaT5EdXJpbmcgbWVpb3RpYyBjZWxsIGRpdmlzaW9uLCBob21vbG9nb3VzIHJlY29tYmluYXRpb24gZW5oYW5jZXMgZ2VuZXRpYyBkaXZlcnNpdHkgYnkgZmFjaWxpdGF0aW5nIHRoZSBleGNoYW5nZSBvZiBnZW5ldGljIG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJuYWwgYW5kIHBhdGVybmFsIGNocm9tb3NvbWVzLiBUaGlzIHByb2Nlc3MsIGtub3duIGFzIGNyb3NzaW5nIG92ZXIsIGNvbnRyaWJ1dGVzIHRvIHRoZSBnZW5lcmF0aW9uIG9mIG5ldyBhbGxlbGUgY29tYmluYXRpb25zIGluIGdhbWV0ZXMuPC9saT5cbjwvdWw+XG48L2xpPlxuPGxpPjxzdHJvbmc+R2VuZSBUYXJnZXRpbmcgYW5kIENSSVNQUiBUZWNobm9sb2dpZXM8L3N0cm9uZz46XG48dWw+XG48bGk+VGhlIHByaW5jaXBsZXMgb2YgaG9tb2xvZ291cyByZWNvbWJpbmF0aW9uIGFyZSBpbnRlZ3JhbCB0byBnZW5lIHRhcmdldGluZyB0ZWNobmlxdWVzIGFuZCBDUklTUFItQ2FzIGdlbm9tZSBlZGl0aW5nIHRlY2hub2xvZ2llcy4gQnkgdXRpbGl6aW5nIGhvbW9sb2dvdXMgcmVwYWlyIG1lY2hhbmlzbXMsIHJlc2VhcmNoZXJzIGNhbiBpbnRyb2R1Y2Ugc3BlY2lmaWMgbW9kaWZpY2F0aW9ucyBpbnRvIHRoZSBnZW5vbWUgd2l0aCBoaWdoIHByZWNpc2lvbi48L2xpPlxuPC91bD5cbjwvbGk+XG48L3VsPlxuXG48aDM+NS4gQ29uY2x1c2lvbjwvaDM+XG48cD5JbiBzdW1tYXJ5LCBob21vbG9nb3VzIHJlY29tYmluYXRpb24gaXMgYSB2aXRhbCBtZWNoYW5pc20gdGhhdCBub3Qgb25seSBzdXBwb3J0cyBETkEgcmVwYWlyIGJ1dCBhbHNvIHBsYXlzIGEgZnVuZGFtZW50YWwgcm9sZSBpbiBwcm9tb3RpbmcgZ2VuZXRpYyBkaXZlcnNpdHkgZHVyaW5nIHJlcHJvZHVjdGlvbi4gVW5kZXJzdGFuZGluZyB0aGUgaW50cmljYWNpZXMgb2YgdGhpcyBwcm9jZXNzIHByb3ZpZGVzIHZhbHVhYmxlIGluc2lnaHRzIGludG8gY2VsbHVsYXIgZnVuY3Rpb24sIGV2b2x1dGlvbiwgYW5kIHRoZSBkZXZlbG9wbWVudCBvZiBpbm5vdmF0aXZlIGJpb3RlY2hub2xvZ2ljYWwgYXBwbGljYXRpb25zLjwvcD4iLCJxdWl6IjpbeyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJIb21vbG9nb3VzIHJlY29tYmluYXRpb24gaW52b2x2ZXMgdGhlIGV4Y2hhbmdlIG9mIGdlbmV0aWMgbWF0ZXJpYWwgYmV0d2VlbiBETkEgbW9sZWN1bGVzIHRoYXQgaGF2ZToiLCJvcHRpb25zIjpbIkRpZmZlcmVudCBzZXF1ZW5jZXMiLCJTaW1pbGFyIG9yIGlkZW50aWNhbCBzZXF1ZW5jZXMiLCJDb21wbGV0ZWx5IHJhbmRvbSBzZXF1ZW5jZXMiLCJPbmx5IHNpbmdsZS1zdHJhbmRlZCByZWdpb25zIl0sImFuc3dlciI6IlNpbWlsYXIgb3IgaWRlbnRpY2FsIHNlcXVlbmNlcyJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiV2hhdCBpcyB0aGUgc3RydWN0dXJlIGZvcm1lZCBkdXJpbmcgaG9tb2xvZ291cyByZWNvbWJpbmF0aW9uIHRoYXQgaXMgY2hhcmFjdGVyaXplZCBieSB0aGUgaW50ZXJ0d2luaW5nIG9mIHR3byBETkEgbW9sZWN1bGVzPyIsIm9wdGlvbnMiOlsiUmVwbGljYXRpb24gZm9yayIsIlJlcGxpY2F0aW9uIGJ1YmJsZSIsIkhvbGxpZGF5IGp1bmN0aW9uIiwiRC1sb29wIl0sImFuc3dlciI6IkhvbGxpZGF5IGp1bmN0aW9uIn0seyJ0eXBlIjoibXVsdGlwbGUtY2hvaWNlIiwicXVlc3Rpb24iOiJJbiBldWthcnlvdGVzLCB3aGljaCBwcm90ZWluIGlzIHRoZSBlcXVpdmFsZW50IG9mIHRoZSBwcm9rYXJ5b3RpYyBSZWNBIHByb3RlaW4gYW5kIHBsYXlzIGEgY3J1Y2lhbCByb2xlIGluIHN0cmFuZCBpbnZhc2lvbiBkdXJpbmcgcmVjb21iaW5hdGlvbj8iLCJvcHRpb25zIjpbIlJ1dkEiLCJSdXZCIiwiUmFkNTEiLCJCUkNBMSJdLCJhbnN3ZXIiOiJSYWQ1MSJ9LHsidHlwZSI6Im11bHRpcGxlLWNob2ljZSIsInF1ZXN0aW9uIjoiRHVyaW5nIG1laW90aWMgY2VsbCBkaXZpc2lvbiwgaG9tb2xvZ291cyByZWNvbWJpbmF0aW9uIGNvbnRyaWJ1dGVzIHRvOiIsIm9wdGlvbnMiOlsiRE5BIHJlcGFpciIsIkdlbmV0aWMgZGl2ZXJzaXR5IiwiRE5BIHJlcGxpY2F0aW9uIiwiVGVsb21lcmUgbWFpbnRlbmFuY2UiXSwiYW5zd2VyIjoiR2VuZXRpYyBkaXZlcnNpdHkifSx7InR5cGUiOiJtdWx0aXBsZS1jaG9pY2UiLCJxdWVzdGlvbiI6IlRoZSBwcmluY2lwbGVzIG9mIGhvbW9sb2dvdXMgcmVjb21iaW5hdGlvbiBhcmUgdXRpbGl6ZWQgaW4gd2hpY2ggYmlvdGVjaG5vbG9naWNhbCBhcHBsaWNhdGlvbnM/Iiwib3B0aW9ucyI6WyJQQ1IgYW1wbGlmaWNhdGlvbiIsIkdlbCBlbGVjdHJvcGhvcmVzaXMiLCJHZW5lIHRhcmdldGluZyBhbmQgQ1JJU1BSIHRlY2hub2xvZ2llcyIsIldlc3Rlcm4gYmxvdHRpbmciXSwiYW5zd2VyIjoiR2VuZSB0YXJnZXRpbmcgYW5kIENSSVNQUiB0ZWNobm9sb2dpZXMifV19XSwic3VwcGxlbWVudGFyeVJlc291cmNlcyI6eyJpbnRyb2R1Y3Rpb24iOiJIZXJlIGFyZSBzZXZlcmFsIHZpZGVvcyBmcm9tIFlvdVR1YmUgdGhhdCBtYXkgYmUgdXNlZnVsLiBQbGVhc2UgcmVhbGl6ZSB0aGF0IHRoZXkgbWF5IGhhdmUgc29tZSBvdmVyc2ltcGxpZmljYXRpb25zIG9yIGV2ZW4gZXJyb3JzOyB1c2UgdGhlIHRleHRib29rIHRvIGxlYXJuIG1vcmUgZGV0YWlscyBhYm91dCB0aGVzZSB0b3BpY3MuIiwidmlkZW9zIjpbeyJpZCI6MSwidGl0bGUiOiJNZXNlbHNvbi1TdGFobCBFeHBlcmltZW50IiwidXJsIjoiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1KY1VRX1RaQ0cwdyIsImRlc2NyaXB0aW9uIjoiVGhlIE1lc2Vsc29uLVN0YWhsIGV4cGVyaW1lbnQgd2FzIHVzZWQgdG8gcHJvdmUgdGhhdCBETkEgY29waWVzIGl0c2VsZiB0aHJvdWdoIGEgc2VtaS1jb25zZXJ2YXRpdmUgcHJvY2Vzcy4gVGhleSBncmV3IEUuIGNvbGkgaW4gYSBtZWRpdW0gY29udGFpbmluZyBoZWF2eSBuaXRyb2dlbiAoTi0xNSkuIFRoZXkgdGhlbiBzd2l0Y2hlZCB0aGUgRS4gY29saSB0byBhIG1lZGl1bSBjb250YWluaW5nIHJlZ3VsYXIgbml0cm9nZW4gKE4tMTQpIGFuZCBvYnNlcnZlZCB0aGUgRE5BIGluIHRoZSBiYWN0ZXJpYSBvdmVyIHNldmVyYWwgZ2VuZXJhdGlvbnMuICg0bTIwcykifSx7ImlkIjoyLCJ0aXRsZSI6IkROQSByZXBsaWNhdGlvbiAtIDNEIiwidXJsIjoiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1UTktXZ2NGUEhxdyZhYl9jaGFubmVsPXlvdXJnZW5vbWUiLCJkZXNjcmlwdGlvbiI6IlRoaXMgM0QgYW5pbWF0aW9uIHNob3dzIHlvdSBob3cgRE5BIGlzIGNvcGllZCBpbiBhIGNlbGwuIEl0IHNob3dzIGhvdyBib3RoIHN0cmFuZHMgb2YgdGhlIEROQSBoZWxpeCBhcmUgdW56aXBwZWQgYW5kIGNvcGllZCB0byBwcm9kdWNlIHR3byBpZGVudGljYWwgRE5BIG1vbGVjdWxlcy4gSXQgZG9lcyBzaG93IG5pY2VseSB0aGUgYmFzaWMgc3RlcHMgYW5kIHRoZSB0eXBlcyBvZiBlbnp5bWVzIGludm9sdmVkLiBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIGVuenltZXMgaXMgYSBiaXQgYmFzaWMuIEluIGV1a2FyeW90aWMgY2VsbHMsIHNvbWUgb2YgdGhlc2UgZW56eW1lcyB3b3JrIHRvZ2V0aGVyIGJ5IGZvcm1pbmcgYSBjb21wbGV4LiAoM20yN3MpIn0seyJpZCI6MywidGl0bGUiOiJETkEgUmVwbGljYXRpb24gKFVwZGF0ZWQpIiwidXJsIjoiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dGltZV9jb250aW51ZT0xODcmdj1RcWU0dGhVLW9zOCZmZWF0dXJlPWVtYl9sb2dvIiwiZGVzY3JpcHRpb24iOiJUaGlzIHZpZGVvIGFkZHJlc3NlcyB0aGUgZm9sbG93aW5nIHF1ZXN0aW9ucy90b3BpY3MgcmVsYXRlZCB0byBETkEgcmVwbGljYXRpb246IDEuV2h5IGRvIHlvdSBuZWVkIEROQSByZXBsaWNhdGlvbj87IDIuV2hlcmUgYW5kIHdoZW4/OyAzLiBJbnRyb2R1Y2luZyBrZXkgcGxheWVyIGVuenltZXM7IDQuIEluaXRpYWwgc3RlcHMgb2YgRE5BIFJlcGxpY2F0aW9uOyA1LkV4cGxhaW5pbmcgNScgdG8gMycgYW5kIDMnIHRvIDUnIGRpcmVjdGlvbmFsaXR5OyA2LiBMZWFkaW5nIGFuZCBsYWdnaW5nIHN0cmFuZHMgaW4gRE5BIHJlcGxpY2F0aW9uLiAoOG0xMXMpIn0seyJpZCI6NCwidGl0bGUiOiJETkEgcmVwbGljYXRpb24gZW56eW1lcyBhbmQgdGhlaXIgZnVuY3Rpb25zIiwidXJsIjoiaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj05MU8wSXJqb1hRUSIsImRlc2NyaXB0aW9uIjoiVGhpcyBsZWN0dXJlIGV4cGxhaW5zIGFib3V0IGltcG9ydGFudCBkbmEgcmVwbGljYXRpb24gZW56eW1lcyBhbmQgdGhlaXIgZnVuY3Rpb25zLCBjb21wYXJpbmcgdGhlIGRuYSByZXBsaWNhdGlvbiBlbnp5bWVzIGluIHByb2thcnlvdGljIGFuZCBldWthcnlvdGljIGNlbGxzLCBhbmQgdGhlaXIgaW52b2x2ZW1lbnQgaW4gdmFyaW91cyBzdGVwcyBvZiBETkEgcmVwbGljYXRpb24gLiBSZXBsaWNhdGlvbi1yZWxhdGVkIGVuenltZXMgZGVzY3JpYmVkIGluY2x1ZGUgdGhlIGRuYSBwb2x5bWVyYXNlcywgZG5hIGhlbGljYXNlLCBkbmEgbGlnYXNlLCBkbmEgdG9wb2lzb21lcmFzZSBlbnp5bWVzIG5lZWRlZCBmb3IgdGhlIGRuYSByZXBsaWNhdGlvbiBwcm9jZXNzIGluIGV1a2FyeW90ZXMgYW5kIGluIHByb2thcnlvdGVzLiBMZXQgbWUgYWRkIGEgY291cGxlIG9mIGNsYXJpZmljYXRpb25zIGFuZCBjb3JyZWN0aW9ucyBmb3IgYSBiZXR0ZXIgbWF0Y2ggd2l0aCBvdXIgY291cnNlIG1hdGVyaWFsczogRE5BIFBvbCBhbHBoYSBmb3JtcyBhIGNvbXBsZXggd2l0aCBQcmltYXNlLCBhbmQgUHJpbWFzZSwgbm90IHRoZSBETkEgcG9seW1lcmFzZSBwYXJ0IG9mIHRoZSBjb21wbGV4LCBpcyB0aGUgb25lIHRoYXQgc3ludGhlc2l6ZXMgdGhlIHByaW1lcnMgKGFzIGRlc2NyaWJlZCBsYXRlciBpbiB0aGUgdmlkZW8pOyBETkEgUG9sIGRlbHRhIHdhcyBjb25zaWRlcmVkIHRoZSBrZXkgZW56eW1lIGZvciBsZWFkaW5nIHN0cmFuZCBzeW50aGVzaXMgYSBmZXcgeWVhcnMgYWdvIChpZiB5b3UgaGF2ZSBhbiBvbGRlciB2ZXJzaW9uIG9mIHRoZSB0ZXh0Ym9vaywgeW91IHdpbGwgc2VlIHRoaXMgZW56eW1lIGluIHRoZSBmaWd1cmVzKTsgcmVjZW50IGV4cGVyaW1lbnRzIGFuZCBtb2RlbHMgcHV0IEROQSBQb2wgZXBzaWxvbiBhcyB0aGUga2V5IGVuenltZSBmb3IgbGVhZGluZyBzdHJhbmQgc3ludGhlc2lzIChhcyBzaG93biBpbiB0aGUgZmlndXJlcyBvZiBMb2Rpc2gtOGUpLiAoN20xMHMpIn0seyJpZCI6NSwidGl0bGUiOiJCaSBkaXJlY3Rpb25hbCByZXBsaWNhdGlvbiIsInVybCI6Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9bVliNUJPbXB4MzgiLCJkZXNjcmlwdGlvbiI6IlRoaXMgYnJpZWYgdmlkZW8gZXhwbGFpbnMgaG93IHJlcGxpY2F0aW9uIG9jY3VycyBiaS1kaXJlY3Rpb25hbGx5LiBETkEgcmVwbGljYXRpb24gYmVnaW5zIGF0IHRoZSByZXBsaWNhdGlvbiBvcmlnaW4sIG9uY2UgRE5BIGlzIG1lbHRlZCwgYSByZXBsaWNhdGlvbiBidWJibGUgaXMgZm9ybWVkLCBhbG9uZyB3aXRoIHR3byByZXBsaWNhdGlvbiBmb3JrcyB3aGljaCBtb3ZlIGluIG9wcG9zaXRlIGRpcmVjdGlvbnMuICgxbTE4cykifSx7ImlkIjo2LCJ0aXRsZSI6IkRpZmZlcmVuY2UgQmV0d2VlbiBQcm9rYXJ5b3RpYyBhbmQgRXVrYXJ5b3RpYyBETkEgcmVwbGljYXRpb24iLCJ1cmwiOiJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVJMaHdyRkV0REVzIiwiZGVzY3JpcHRpb24iOiJUaGlzIHZpZGVvIGV4cGxhaW5zIG11bHRpcGxlIGRpZmZlcmVuY2VzIGJldHdlZW4gcHJva2FyeW90aWMgYW5kIGV1a2FyeW90aWMgcmVwbGljYXRpb24uIEl0IGNvdmVycyB2YXJpb3VzIHRvcGljczogcmVwbGljYXRpb24gbG9jYXRpb24gaW4gYm90aCBjZWxsIHR5cGVzLCByZXBsaWNhdGlvbiB0aW1pbmcsIG51bWJlcnMgb2YgT1JJIHNpdGVzIGluIGVhY2ggY2VsbCB0eXBlLCByZXBsaWNhdGlvbiBmb3JrIG51bWJlcnMgYW5kIGFjdGl2aXR5LCBudW1iZXJzIG9mIHJlcGxpY29ucywgaW5pdGlhdGlvbiBtZWNoYW5pc21zLCBETkEgcG9seW1lcmFzZXMgaW52b2x2ZWQsIE9rYXpha2kgZnJhZ21lbnQgc2l6ZXMsIHJhdGVzIGFuZCB0aW1lcyBpbnZvbHZlZCwgZGlmZmVyZW5jZXMgaW4gdGVybWluYXRpb24uIEEgZmV3IHRlcm1zIGFuZCB0b3BpY3MgYXJlIGEgYml0IG91dGRhdGVkIG9yIGhhdmUgc29tZSBtaXN0YWtlcyAoZXNwZWNpYWxseSB0aGUgc2VjdGlvbiBhYm91dCBETkEgcG9seW1lcmFzZXMgaW52b2x2ZWQ7IHBsZWFzZSBzZWUgdGhlIGxlY3R1cmUgbm90ZXMpLCBidXQgbW9zdCBvZiB0aGUgZGlmZmVyZW5jZXMgYXJlIHdlbGwgZGVzY3JpYmVkLiAoNm00OXMpIn0seyJpZCI6NywidGl0bGUiOiJNZWNoYW5pc21zIG9mIEROQSBEYW1hZ2UgYW5kIFJlcGFpciIsInVybCI6Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9c1g2TG5jTmpURlUiLCJkZXNjcmlwdGlvbiI6IlRoaXMgdmlkZW8gc3VtbWFyaXplcyBzZXZlcmFsIEROQSBtdXRhdGlvbnMsIEROQSBkYW1hZ2UgYW5kIEROQSByZXBhaXIgbWVjaGFuaXNtcyBuaWNlbHkuIE1heWJlIGhlIHdhcyBhIGJpdCBzY2FyZWQgb2YgY292ZXJpbmcgdGhlIGRvdWJsZSBzdHJhbmQgYnJlYWsgZGFtYWdlIGFuZCByZXBhaXIgc3lzdGVtcyA7LSkuIEkgdW5kZXJzdGFuZCBoaW0gYXMgdGhvc2UgYXJlIHByZXR0eSBzY2FyeSBhbmQgdGhlaXIgcmVwYWlyIG1vc3Qgb2Z0ZW4gbGVhdmVzIGRhbWFnZSBiZWhpbmQhISAoMTFtMjlzKSJ9XX19XSwiZmluYWxFeGFtIjpudWxsfQ=="; // Base64 encoded course data
</script>
</head>
<body data-exported-mode="true" class="course-view-active">
    <div id="sidebar-nav" style="display: flex;">
        <div class="branding">RPBedu</div>
        <h2 class="text-center">Course Navigation</h2>
        <div id="progress-bar-container">
            <div id="progress-bar">
                <div id="progress-fill" style="width: 0%;"></div>
            </div>
            <div id="progress-text">Module Progress: 0% (0/3)</div>
        </div>
        <div id="nav-content"><ul class="space-y-1"><li><div class="module-title" onclick="navigateToModule(0)" tabindex="0" role="button" aria-label="Module 1: Chapter 4: The Cell Nucleus">Chapter 4: The Cell Nucleus</div><ul class="topic-list mt-1 space-y-0.5"><li class="topic-item">
                            <a href="#" onclick="event.preventDefault(); navigateToTopic(0, 0)" class="active" data-module-index="0" data-topic-index="0" tabindex="0" aria-label="Topic A: Replication" title="A: Replication">
                               A: Replication
                            </a>
                        </li><li class="topic-item">
                            <a href="#" onclick="event.preventDefault(); navigateToTopic(0, 1)" class="" data-module-index="0" data-topic-index="1" tabindex="0" aria-label="Topic B: DNA Repair" title="B: DNA Repair">
                               B: DNA Repair
                            </a>
                        </li><li class="topic-item">
                            <a href="#" onclick="event.preventDefault(); navigateToTopic(0, 2)" class="" data-module-index="0" data-topic-index="2" tabindex="0" aria-label="Topic C: Recombination" title="C: Recombination">
                               C: Recombination
                            </a>
                        </li></ul></li><li class="supplementary-link mt-1">
                        <a href="#" onclick="event.preventDefault(); navigateToSupplementary(0)" class="" data-module-index="0" tabindex="0" aria-label="Supplementary materials for module 1" title="Supplementary Materials for Chapter 4: The Cell Nucleus">
                           Supplementary Materials
                        </a>
                    </li></ul></div>
        <div id="sidebar-actions">
            <button id="theme-toggle-btn" class="w-full">Switch to Light Theme</button>
            <button id="generate-report-btn" onclick="triggerReportGenerationForCurrentModule()" style="display: block;" class="w-full">View Module Report</button>
            <button id="download-error-log-btn" onclick="downloadErrorLog()" style="display: none;" class="w-full bg-red-600 hover:bg-red-700 text-white">Download Error Log</button>
        </div>
    </div>

    <div id="main-content">
        <div class="app-container">
            <div id="login-section" class="section-box" style="display: none;">
                <h2 class="text-2xl font-bold mb-4 text-center">Student Login</h2>
                <label for="student-name" class="block mb-1 font-semibold">Enter Your Name:</label>
                <input type="text" id="student-name" placeholder="E.g., Jane Doe" class="mb-3">
                <button onclick="handleLogin()" class="bg-green-600 hover:bg-green-700 w-full">Login / Register</button>
                <div id="login-error" class="error-message mt-3" style="display: none;"></div>
            </div>

            <div id="upload-section" class="section-box" style="display: block;">
                <div class="collapsible-header" onclick="toggleUploadSection()" aria-expanded="true">
                    <h1 class="text-xl font-bold">LearnMaster Course Platform</h1>
                    <span class="toggle-icon"></span>
                </div>
                <div id="upload-content" class="collapsible-content">
                    <div id="student-info" style="display: flex;"> <span>Logged in as: <strong id="student-name-display">Raefal Peerz</strong></span>
                        <button id="logout-button" onclick="handleLogout()">Logout</button>
                    </div>
                    <h2 class="text-xl font-bold mb-4 text-center">Course Status / Upload</h2>
                    <div id="embedded-course-message" style="display: none;"></div>
                    <label for="course-file" class="block mb-1 font-semibold" id="course-file-label" style="display: block;">Select Course JSON File:</label>
                    <input type="file" id="course-file" accept=".json" onchange="handleFileUpload(event)" style="display: block;">
                    <div id="upload-status" class="success-message mt-3" style="display: block;">Successfully loaded: Cellular Physiology - Chapter 4</div>
                    <div id="upload-error" class="error-message mt-3" style="display: none;"></div>
                    <button id="export-module-btn" onclick="exportModuleAsHTML()" style="display: block;" class="mt-3">Export Module as HTML</button>
                </div>
            </div> <div id="course-display-section" class="section-box" style="display: block;">
                <h1 id="course-title" class="text-3xl font-bold mb-4 text-center border-b border-gray-700 pb-2">Cellular Physiology - Chapter 4</h1>
                <h2 id="module-title" class="text-2xl font-semibold mb-2 text-gray-400">Chapter 4: The Cell Nucleus</h2>
                <h3 id="topic-title" class="text-xl font-medium mb-5 text-gray-500">Topic A: Replication</h3>
                <div id="course-content" class="mb-4" style="display: block;"><h2>A. Replication</h2>
<h3>1. Characteristics of Chromosome Replication</h3>
<p>DNA replication is a fundamental process that ensures the accurate duplication of genetic material, allowing cells to pass on their genetic information during cell division. This process is characterized by several key features, each of which contributes to its efficiency and fidelity.</p>
<h4>Semiconservative Replication</h4>
<ul>
<li><strong>Definition</strong>: The semiconservative nature of DNA replication means that each newly synthesized DNA strand is formed by pairing with an original template strand. This ensures that each daughter DNA molecule consists of one old (parental) strand and one newly synthesized strand.</li>
<li><strong>Demonstration by Messelson-Stahl Experiment</strong>: The semiconservative model was famously validated by the Messelson-Stahl experiment conducted in 1958. In this experiment:
<ul>
<li><em>Escherichia coli</em> was grown in a medium containing the heavy isotope of nitrogen (15N) to label the DNA.</li>
<li>The bacteria were then transferred to a medium containing the lighter isotope (14N).</li>
<li>After one generation, the DNA was extracted and subjected to density gradient centrifugation, revealing that the DNA consisted of hybrids of intermediate density, confirming that each DNA molecule contained one heavy strand and one light strand after one round of replication.</li>
</ul>
</li>
</ul>
<h4>Bidirectional Replication</h4>
<ul>
<li><strong>Replication Bubbles</strong>: DNA replication is bidirectional, meaning that it occurs in two directions from the origin of replication, creating replication bubbles. Each bubble has two replication forks where the DNA strands are unwound and synthesized.</li>
<li><strong>Experimental Evidence</strong>: This bidirectional nature was demonstrated through various experiments, including electron microscopy observations of the SV40 virus replication. These studies revealed that as the replication fork progresses, new strands are synthesized simultaneously at both forks, effectively doubling the rate of replication.</li>
</ul>
<h4>Specific Origins of Replication</h4>
<ul>
<li><strong>Definition of Origins</strong>: DNA replication initiates at specific sequences known as origins of replication. These origins are crucial for defining where replication begins and ensuring that the entire genome is replicated.</li>
<li><strong>Autonomous Replicating Sequences (ARS)</strong>: In eukaryotic cells, origins are often referred to as Autonomous Replicating Sequences (ARS), which are recognized by a protein complex called the Origin Recognition Complex (ORC). The ORC is essential for loading additional factors required for unwinding the DNA and initiating replication.</li>
<li><strong>Study in Yeast</strong>: The mechanisms of origin recognition and activation have been extensively studied in yeast, where several ARS elements have been characterized, providing insights applicable to other eukaryotic systems.</li>
</ul>
<h4>Variation in Origins of Replication</h4>
<ul>
<li><strong>Prokaryotic vs. Eukaryotic Cells</strong>:
<ul>
<li>Most prokaryotic cells, such as <em>E. coli</em>, possess a single origin of replication due to their circular genome, allowing for rapid and efficient replication.</li>
<li>Prokaryotic replication can occur at a pace of approximately 1000 base pairs per second, enabling the entire genome (a few million nucleotides) to be replicated in under 30 minutes.</li>
</ul>
</li>
<li><strong>Eukaryotic Replication Complexity</strong>:
<ul>
<li>In contrast, eukaryotic cells exhibit a more complex replication process. Each eukaryotic chromosome has multiple origins of replication, allowing for the efficient duplication of larger linear genomes, such as the 3 billion base pairs found in human cells.</li>
<li>The rate of DNA synthesis at each fork in mammalian cells is approximately 100 base pairs per second, resulting in an entire genome replication time of roughly 8 hours. This slower rate is compensated by the presence of approximately 10,000 to 100,000 origins of replication, which are not evenly spaced and do not all initiate simultaneously.</li>
</ul>
</li>
<li><strong>Replicon Model</strong>: The presence of multiple origins results in the formation of many replicons—units of replication that are completed at different times during the replication process. This system allows for the coordinated and efficient synthesis of the entire genome while minimizing the time required for cell division.</li>
</ul>
<h4>Summary</h4>
<p>In summary, the characteristics of chromosome replication—semiconservative nature, bidirectionality, specific origins, and the complexity of eukaryotic replication—are essential for ensuring the fidelity and efficiency of genetic information transmission. Understanding these features is crucial for insights into cell biology, genetics, and the mechanisms underlying various diseases, including cancer, which can arise from errors in DNA replication.</p>

<h3>2. Replication Machinery and Mechanisms</h3>
<p>The process of DNA replication is a highly sophisticated and coordinated event that involves a series of enzymes and proteins working in concert to ensure the precise duplication of genetic material. The components of this machinery and the specific steps involved are remarkably similar across both prokaryotic and eukaryotic cells, reflecting the fundamental nature of this biological process.</p>
<h4>General Components and Steps Involved</h4>
<ul>
<li><strong>Origin Recognition Complex (ORC)</strong>: The initiation of DNA replication begins with the assembly of the Origin Recognition Complex at the origins of replication. This multi-protein complex is critical for recognizing specific DNA sequences known as the Autonomous Replicating Sequences (ARS). Once bound, the ORC facilitates the recruitment of additional proteins necessary for the unwinding of the DNA helix.</li>
<li><strong>Helicase</strong>: Following the assembly of the ORC, an enzyme called helicase is recruited to the origin. Helicase is responsible for unwinding the double-stranded DNA, creating two single-stranded templates for replication. This unwinding process is powered by the hydrolysis of ATP, which provides the necessary energy to separate the strands and overcome the inherent stability of the DNA double helix.</li>
<li><strong>Single-Stranded DNA Binding Proteins</strong>: As the DNA strands are unwound, they become susceptible to re-annealing or degradation. To prevent these issues, single-stranded DNA binding proteins (such as Replication Protein A, or RPA, in eukaryotes, and Single-Stranded Binding Proteins, or SSB, in prokaryotes) bind to the exposed single-stranded DNA (ssDNA) regions. These proteins stabilize the ssDNA and prevent secondary structures from forming, thus ensuring that the template remains accessible for replication.</li>
<li><strong>Primase</strong>: The next critical player in the replication machinery is primase, an RNA polymerase that synthesizes short RNA primers complementary to the ssDNA templates. These primers are essential because DNA polymerases cannot initiate synthesis de novo; they can only add nucleotides to an existing strand. The RNA primer provides the necessary 3' hydroxyl (OH) group for the DNA polymerase to begin elongation.</li>
<li><strong>DNA Polymerases</strong>: The primary enzymes responsible for synthesizing new DNA strands are DNA polymerases. In eukaryotic cells, five different DNA polymerases (alpha, beta, gamma, delta, and epsilon) have been identified, each with distinct roles:
<ul>
<li><strong>DNA Polymerase Alpha</strong>: This polymerase is involved in initiating DNA synthesis. It works in conjunction with primase to extend the RNA primer for a short distance.</li>
<li><strong>DNA Polymerase Delta</strong>: This polymerase is primarily responsible for synthesizing the lagging strand. It is highly processive and can extend the Okazaki fragments initiated by RNA primers.</li>
<li><strong>DNA Polymerase Epsilon</strong>: This enzyme is mainly involved in synthesizing the leading strand, providing rapid and continuous DNA synthesis.</li>
<li><strong>DNA Polymerase Beta</strong>: This polymerase plays a role in DNA repair rather than in replication.</li>
<li><strong>DNA Polymerase Gamma</strong>: This enzyme is involved in mitochondrial DNA replication.</li>
</ul>
Importantly, DNA polymerases synthesize DNA in a 5' to 3' direction, meaning they can only add nucleotides to the free 3' end of a growing strand. Thus, as the replication fork opens, the leading strand is synthesized continuously, while the lagging strand is synthesized in short, discontinuous segments known as Okazaki fragments.</li>
</ul>
<h4>Synthesis at the Replication Forks</h4>
<p>In each replication fork, the synthesis of both strands occurs simultaneously but via distinct mechanisms:</p>
<ul>
<li><strong>Leading Strand Synthesis</strong>: The leading strand is synthesized continuously in the direction of the replication fork. This process begins with a single RNA primer synthesized by primase. DNA polymerase alpha extends this primer for a short stretch before being replaced by the more processive PCNA-Pol-epsilon complex. PCNA (Proliferating Cell Nuclear Antigen) acts as a sliding clamp that encircles the DNA and holds the polymerase in place, allowing for rapid and efficient elongation of the leading strand.</li>
<li><strong>Lagging Strand Synthesis</strong>: The lagging strand, synthesized in the opposite direction of the replication fork, is more complex. Multiple RNA primers are required, as each Okazaki fragment must begin with a new primer. The process involves:
<ul>
<li>Primase synthesizing an RNA primer at various points along the lagging strand template.</li>
<li>DNA polymerase alpha extending the primer for a brief length before handing off to PCNA-Pol-delta.</li>
<li>PCNA-Pol-delta extends the fragment until it reaches the previous Okazaki fragment, which necessitates stopping the synthesis.</li>
<li>Once the RNA primers have served their purpose, they are removed and replaced with DNA. DNA polymerase I in prokaryotic cells (or FEN1 in eukaryotes) performs this task, while DNA ligase seals the nicks between adjacent Okazaki fragments, forming a continuous DNA strand.</li>
</ul>
</li>
</ul>
<h4>Additional Enzymatic Involvement</h4>
<ul>
<li><strong>Topoisomerases</strong>: As helicase unwinds the DNA, it creates torsional stress ahead of the replication fork, leading to positive supercoiling. Topoisomerases alleviate this tension by inducing transient breaks in the DNA strands. There are two main types:
<ul>
<li><strong>Type I Topoisomerases</strong>: These enzymes cut one strand of the DNA helix, allowing the other strand to unwind and relieve the supercoiling.</li>
<li><strong>Type II Topoisomerases</strong>: These enzymes can cut both strands simultaneously, allowing for more significant relief of tension and facilitating the passage of one DNA helix through another. Antibiotics targeting bacterial topoisomerases, such as Gyrase, serve as effective antibacterial agents by halting bacterial replication.</li>
</ul>
</li>
<li><strong>Telomerase</strong>: Eukaryotic cells face a unique challenge in replicating their linear chromosomes: the inability to fully replicate the ends of these chromosomes, known as telomeres. Telomerase is an enzyme that adds repetitive nucleotide sequences to the telomeres, compensating for the DNA lost during replication. Composed of an RNA template and a specialized reverse transcriptase activity, telomerase is crucial during early development and in germ cells, ensuring that the chromosomes do not shorten with each division.</li>
</ul>

<h3>3. Replication and the Cell Cycle</h3>
<p>DNA replication is intricately integrated into the eukaryotic cell cycle, a highly regulated series of events that leads to cell growth, DNA synthesis, and ultimately, cell division. The cell cycle is divided into distinct phases, each characterized by specific activities and checkpoints that ensure the fidelity of DNA replication and the proper functioning of the cell.</p>
<h4>Phases of the Cell Cycle</h4>
<p>The eukaryotic cell cycle is typically divided into four main phases:</p>
<ul>
<li><strong>G1 Phase (Gap 1)</strong>: This is the first phase after cell division, during which the cell undergoes growth and prepares for DNA synthesis. In this phase, the cell synthesizes various proteins and organelles, accumulates nutrients, and engages in metabolic activities. The G1 phase is crucial for ensuring that the cell has all the necessary components and energy reserves to support the upcoming replication process.</li>
<li><strong>S Phase (Synthesis)</strong>: During the S phase, DNA replication occurs. Each chromosome is duplicated, resulting in two sister chromatids for each chromosome. The duration of the S phase can vary, but in mammalian cells, it typically takes about 8 hours. This phase is characterized by the activation of replication origins and the coordination of the replication machinery to ensure that the entire genome is accurately copied.</li>
<li><strong>G2 Phase (Gap 2)</strong>: Following DNA synthesis, the cell enters the G2 phase, where it continues to grow and prepares for mitosis. During this phase, the cell undergoes additional growth, synthesizes proteins required for mitosis, and ensures that DNA replication has occurred correctly. The G2 phase serves as a critical checkpoint to verify that the cell is ready to divide.</li>
<li><strong>M Phase (Mitosis)</strong>: The M phase encompasses the processes of mitosis and cytokinesis, during which the replicated chromosomes are segregated into two daughter cells. Mitosis is further divided into several stages: prophase, metaphase, anaphase, and telophase. Cytokinesis follows, ensuring that the cytoplasm divides and two distinct cells are formed.</li>
</ul>
<h4>Regulation of the Cell Cycle</h4>
<p>The progression through the cell cycle is tightly regulated by a network of proteins known as cyclins and cyclin-dependent kinases (CDKs). These proteins work in tandem to control the transition between different phases of the cell cycle:</p>
<ul>
<li><strong>Cyclins</strong>: Cyclins are regulatory proteins whose levels fluctuate throughout the cell cycle. They bind to and activate CDKs, forming cyclin-CDK complexes that trigger specific events in the cell cycle. For example, Cyclin D is critical for the progression from G1 to S phase, while Cyclin A is involved in S phase progression.</li>
<li><strong>Cyclin-Dependent Kinases (CDKs)</strong>: CDKs are enzymes that, when activated by binding to cyclins, phosphorylate target proteins to drive the cell cycle forward. The activity of CDKs is tightly controlled by the availability of their cyclin partners and by various inhibitory proteins.</li>
</ul>
<h4>Cell Cycle Checkpoints</h4>
<p>Cell cycle checkpoints are crucial control mechanisms that monitor and regulate the progression of the cell cycle. These checkpoints ensure that any potential errors in DNA replication or damage are addressed before the cell proceeds to the next phase. The main checkpoints include:</p>
<ul>
<li><strong>G1 Checkpoint</strong>: This checkpoint assesses the cell's size, nutrient status, and DNA integrity before allowing the transition to the S phase. If conditions are not favorable (e.g., insufficient nutrients or DNA damage), the cell may enter a resting state (G0) or undergo repair mechanisms.</li>
<li><strong>G2 Checkpoint</strong>: At this stage, the cell verifies that DNA replication has been completed successfully and checks for any DNA damage. If errors are detected, the cell cycle can be halted to allow for repair processes. If the damage is irreparable, the cell may undergo apoptosis to prevent the propagation of damaged DNA.</li>
<li><strong>M Checkpoint (Spindle Assembly Checkpoint)</strong>: During mitosis, the M checkpoint ensures that all chromosomes are properly aligned along the metaphase plate and that the spindle apparatus is correctly attached to the kinetochores. This checkpoint prevents the separation of chromosomes until all are properly positioned, thereby ensuring accurate distribution of genetic material to the daughter cells.</li>
</ul>
<h4>Importance of Regulation and Checkpoints</h4>
<p>The regulation of the cell cycle is vital for maintaining genomic integrity and preventing uncontrolled cell division, which can lead to cancer. Mutations in cyclins, CDKs, or checkpoint proteins can result in dysregulation of the cell cycle, contributing to tumorigenesis. For instance, overexpression of Cyclin D has been linked to various cancers, as it drives cells to progress through the cell cycle uncontrollably.</p>
<p>In summary, the interplay between DNA replication and the cell cycle is a cornerstone of cellular physiology. The successful duplication of genetic material is not only essential for cell division but also for the preservation of genetic fidelity across generations. Understanding these processes is fundamental for insights into developmental biology, cancer research, and therapeutic interventions.</p>
                    <div id="quiz-prompt" class="mt-6 p-4 bg-gray-700 rounded text-center border border-gray-600">
                        <p class="mb-3">Ready for a quiz on <strong>Replication</strong>?</p>
                        <button onclick="startTopicQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Take Quiz</button>
                    </div></div>
                <div id="quiz-container" class="mb-4" style="display: none;"></div>
                <div id="feedback-container" style="display: none;"></div>
            </div> </div> </div> <script>
        // --- Constants ---
        const EMBEDDED_DATA_SCRIPT_ID = 'embedded-course-script';
        const PASSING_SCORE_PERCENT = 90; // Define passing threshold globally

        // --- DOM Elements (Checked for existence in functions) ---
        const sidebarNav = document.getElementById('sidebar-nav');
        const navContent = document.getElementById('nav-content');
        const sidebarActions = document.getElementById('sidebar-actions');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const downloadErrorLogBtn = document.getElementById('download-error-log-btn');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const mainContent = document.getElementById('main-content');
        const loginSection = document.getElementById('login-section');
        const uploadSection = document.getElementById('upload-section');
        const courseDisplaySection = document.getElementById('course-display-section');
        const studentNameInput = document.getElementById('student-name');
        const studentInfoDiv = document.getElementById('student-info'); // Container for name display and logout
        const studentNameDisplay = document.getElementById('student-name-display');
        const loginError = document.getElementById('login-error');
        const courseFileInput = document.getElementById('course-file');
        const courseFileLabel = document.getElementById('course-file-label');
        const uploadStatus = document.getElementById('upload-status');
        const uploadError = document.getElementById('upload-error');
        const exportModuleBtn = document.getElementById('export-module-btn');
        const embeddedCourseMessage = document.getElementById('embedded-course-message');
        const courseTitleElement = document.getElementById('course-title');
        const moduleTitleElement = document.getElementById('module-title');
        const topicTitleElement = document.getElementById('topic-title');
        const courseContentElement = document.getElementById('course-content');
        const quizContainerElement = document.getElementById('quiz-container');
        const feedbackElement = document.getElementById('feedback-container');
        const uploadContent = document.getElementById('upload-content'); // Collapsible part
        const toggleIcon = document.querySelector('.toggle-icon');

        // --- Global State ---
        let currentStudentName = null;
        let currentCourseData = null;
        let currentCourseId = null; // Unique ID derived from student + course file/title
        let currentModuleIndex = 0;
        let currentTopicIndex = 0;
        let currentView = 'login'; // Default view ('login', 'upload', 'topic', 'supplementary', 'moduleCompletion', 'report')
        let currentTopicView = 'content'; // Sub-view within 'topic' ('content', 'quiz', 'results')
        let currentTopicScore = 0; // Score from the *last* quiz attempt
        let studentProgress = {}; // Stores { moduleIndex, topicIndex, topicScores: { 'moduleId_topicId': score }, completedModules: ['moduleId'] }
        let errorLog = []; // Array to store error messages
        let quizTimerInterval = null; // Interval ID for the quiz timer
        let quizTimeRemaining = 600; // Default quiz time in seconds (10 minutes)
        let quizStartTime = null; // Timestamp when quiz started
        let isUploadCollapsed = false; // State of the collapsible upload section
        let pendingEmbeddedData = null; // Stores embedded data if found before login

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        /**
         * Initializes the application on page load.
         * Sets up the initial view based on login status, applies theme,
         * checks for embedded data, and sets up event listeners.
         */
        function initializeApp() {
            console.log("LearnMaster v6: Initializing App...");
            try {
                // 1. Check for existing student login in localStorage
                const storedStudent = localStorage.getItem('currentStudentName');
                if (storedStudent) {
                    console.log(`Found student: ${storedStudent}`);
                    currentStudentName = storedStudent;
                    currentView = 'upload'; // Start at upload screen if logged in
                } else {
                    console.log("No student found in localStorage. Setting view to login.");
                    currentView = 'login'; // Otherwise, start at login screen
                }

                // 2. Apply saved theme or default to dark
                const storedTheme = localStorage.getItem('theme') || 'dark';
                applyTheme(storedTheme);

                // 3. Render the initial UI (Login or Upload Screen)
                // CRITICAL: This must happen *before* processing embedded data to prevent blank screen.
                console.log(`Rendering initial UI for view: ${currentView}`);
                renderUI(); // Shows only the necessary section (login or upload)

                // 4. Check for embedded course data (present in exported files)
                console.log("Checking for embedded course data...");
                // Use the constant for the script ID if needed for removal/check, but window property is primary check
                if (window.embeddedCourseData) {
                    console.log("Embedded course data found.");
                    // If already logged in, process the data immediately.
                    if (currentStudentName) {
                        console.log("Student already logged in, processing embedded data now.");
                        processEmbeddedData(window.embeddedCourseData);
                    } else {
                        // If not logged in, store the data and prompt user on login screen.
                        console.log("Student not logged in. Storing embedded data for processing after login.");
                        pendingEmbeddedData = window.embeddedCourseData;
                        // Display an informational message on the login screen
                        if (loginError) {
                            loginError.textContent = "A course module is embedded in this file. Please log in to load it.";
                            loginError.className = 'info-message mt-3'; // Use info style
                            loginError.style.display = 'block';
                        }
                    }
                } else {
                     console.log("No embedded course data found. Standard operation mode.");
                     // Ensure upload section is configured for normal file uploads
                     configureUploadSectionForStandardMode();
                }

                // 5. Setup keyboard navigation and theme toggle listener
                setupKeyboardNavigation();
                themeToggleBtn?.addEventListener('click', () => {
                    const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                    applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
                });
                console.log("Initialization complete.");

            } catch (error) {
                logError('CRITICAL ERROR during app initialization', error);
                console.error("Initialization failed:", error);
                // Attempt to display a user-friendly error and fallback safely
                try {
                     document.body.innerHTML = `<div class="p-10"><h1 class="text-red-500 text-2xl">Application Error</h1><p class="text-gray-300 mt-2">A critical error occurred during startup: ${escapeHtml(error.message)}</p><p class="text-gray-400 mt-4">Please try clearing your browser's cache and refreshing the page. If the problem persists, contact support.</p><button onclick="localStorage.clear(); location.reload();" class="mt-4 p-2 bg-red-600 rounded text-white">Clear Data & Reload</button></div>`;
                     resetLocalStorageOnError(); // Attempt to clear bad state
                } catch (displayError) {
                    // Fallback if even error display fails
                    alert(`Critical Initialization Error: ${error.message}. Please clear browser data and reload.`);
                }
            }
        }

        // --- Theme Management ---
        /**
         * Applies the specified theme ('light' or 'dark') to the body
         * and updates the theme toggle button text.
         * @param {string} theme - The theme to apply ('light' or 'dark').
         */
        function applyTheme(theme) {
            if (!themeToggleBtn) return; // Guard against missing element early
            const isLight = theme === 'light';
            document.body.classList.toggle('light-theme', isLight);
            themeToggleBtn.textContent = isLight ? 'Switch to Dark Theme' : 'Switch to Light Theme';
            localStorage.setItem('theme', theme); // Save preference
        }

        // --- Error Handling & Logging ---
        /**
         * Logs an error message to the console and stores it in the errorLog array.
         * @param {string} message - A description of the error context.
         * @param {Error|null} [error=null] - The actual Error object, if available.
         */
        function logError(message, error = null) {
            const timestamp = new Date().toISOString();
            // Construct detailed log entry
            const logEntry = `[${timestamp}] ${message}${error ? `: ${error.message}${error.stack ? `\nStack: ${error.stack}` : ''}` : ''}`;
            console.error(logEntry); // Log to console for immediate debugging
            errorLog.push(logEntry); // Store for potential download
            // Show the download button if there are errors logged
            if (downloadErrorLogBtn) downloadErrorLogBtn.style.display = errorLog.length > 0 ? 'block' : 'none';
        }

        /**
         * Creates and triggers a download for the collected error log.
         */
        function downloadErrorLog() {
            if (errorLog.length === 0) {
                alert("No errors have been logged.");
                return;
            }
            try {
                // Join errors with double newline for readability
                const blob = new Blob([errorLog.join('\n\n')], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                // Generate a filename with date
                a.download = `LearnMaster_Error_Log_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a); // Append link to body
                a.click(); // Simulate click to trigger download
                document.body.removeChild(a); // Clean up link
                URL.revokeObjectURL(url); // Release object URL
            } catch(error) {
                logError("Failed to create error log download link", error);
                alert("Could not create the error log file for download.");
            }
        }

        /**
         * Attempts to clear potentially corrupted localStorage items on critical errors.
         */
        function resetLocalStorageOnError() {
            console.warn("Attempting to reset potentially corrupted localStorage...");
            try {
                 // Clear known keys that might cause issues
                 localStorage.removeItem('currentStudentName');
                 // Consider clearing progress keys if they might be corrupt, but be cautious
                 // Object.keys(localStorage).filter(key => key.startsWith('progress_')).forEach(key => localStorage.removeItem(key));
                 currentStudentName = null; // Reset global state variable
                 studentProgress = {}; // Reset progress object
                 console.log("localStorage reset attempted.");
            } catch (e) {
                logError("Failed to reset localStorage during error recovery", e);
            }
        }

        // --- Keyboard Navigation ---
        /**
         * Sets up basic keyboard navigation (Up/Down arrows, Enter) for sidebar links
         * and Ctrl+Enter for quiz submission.
         */
        function setupKeyboardNavigation() {
            // Sidebar navigation
            sidebarNav?.addEventListener('keydown', (e) => {
                const links = navContent?.querySelectorAll('a'); // Get all focusable links
                if (!links || links.length === 0) return;

                const activeElement = document.activeElement;
                // Check if the focused element is one of the sidebar links
                if (!activeElement || !Array.from(links).includes(activeElement)) {
                    // If focus is not on a link, maybe focus the first one on ArrowDown?
                    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                         // links[0]?.focus(); // Optionally focus first link
                    }
                    return;
                }

                const index = Array.from(links).indexOf(activeElement);

                if (e.key === 'ArrowDown' && index < links.length - 1) {
                    e.preventDefault(); // Prevent page scrolling
                    links[index + 1].focus(); // Move focus down
                } else if (e.key === 'ArrowUp' && index > 0) {
                    e.preventDefault(); // Prevent page scrolling
                    links[index - 1].focus(); // Move focus up
                } else if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent default link behavior (if any)
                    activeElement.click(); // Simulate click on the focused link
                }
            });

            // Global listener for Ctrl+Enter quiz submission
            document.addEventListener('keydown', (e) => {
                // Check if Ctrl key is pressed and the key is Enter
                if (e.ctrlKey && e.key === 'Enter') {
                    // Check if we are currently in the quiz view
                    const quizForm = document.getElementById('topic-quiz-form');
                    if (quizForm && currentView === 'topic' && currentTopicView === 'quiz') {
                        console.log("Ctrl+Enter detected in quiz view. Submitting.");
                        e.preventDefault(); // Prevent default form submission or newline in text areas
                        // Find the submit button and click it, or call submit function directly
                         const submitButton = quizForm.querySelector('button[type="button"]');
                         submitButton?.click(); // Simulate click on the submit button
                        // Alternatively: submitTopicQuiz(quizForm);
                    }
                }
            });
        }

        // --- Collapsible Upload Section ---
        /**
         * Toggles the visibility of the upload section's content area.
         */
        function toggleUploadSection() {
            isUploadCollapsed = !isUploadCollapsed;
            if (uploadContent && toggleIcon) {
                uploadContent.classList.toggle('collapsed', isUploadCollapsed);
                toggleIcon.classList.toggle('collapsed', isUploadCollapsed);
                // Optional: Set aria-expanded attribute for accessibility
                 uploadContent.parentElement?.querySelector('.collapsible-header')?.setAttribute('aria-expanded', !isUploadCollapsed);
            }
        }

        // --- Central UI Rendering Logic ---
        /**
         * Updates the visibility of main UI sections based on the current `currentView` state.
         * Ensures only the relevant sections are displayed.
         */
        function renderUI() {
            console.log(`Rendering UI for view: ${currentView}`);
            // --- Validate essential elements exist ---
            if (!loginSection || !uploadSection || !courseDisplaySection || !sidebarNav || !mainContent || !studentInfoDiv) {
                logError("Core UI sections missing from DOM", new Error("Cannot render UI"));
                document.body.innerHTML = "<p class='error-message p-5'>Critical Error: UI components missing. App cannot load.</p>";
                return;
            }

            // --- Hide all main sections initially ---
            loginSection.style.display = 'none';
            uploadSection.style.display = 'none';
            courseDisplaySection.style.display = 'none';
            sidebarNav.style.display = 'none';
            studentInfoDiv.style.display = 'none'; // Hide student info by default

            // --- Control body class for padding and view state ---
             const isCourseView = ['topic', 'supplementary', 'moduleCompletion', 'report'].includes(currentView);
             document.body.classList.toggle('course-view-active', isCourseView);


            // --- Set collapse state of upload section ---
            // Keep open if 'upload' is the main view, otherwise collapse it.
            isUploadCollapsed = currentView !== 'upload';
             if (uploadContent && toggleIcon) {
                 uploadContent.classList.toggle('collapsed', isUploadCollapsed);
                 toggleIcon.classList.toggle('collapsed', isUploadCollapsed);
                 uploadContent.parentElement?.querySelector('.collapsible-header')?.setAttribute('aria-expanded', !isUploadCollapsed);
             }

            // --- Show the relevant section based on currentView ---
            switch (currentView) {
                case 'login':
                    loginSection.style.display = 'block';
                    // Clear previous login errors unless it's the pending embedded data message
                    if (loginError && loginError.className.includes('error-message')) {
                        loginError.style.display = 'none';
                        loginError.textContent = '';
                    }
                    break;

                case 'upload':
                    uploadSection.style.display = 'block';
                    // Show student info and name if logged in
                    if (currentStudentName && studentNameDisplay && studentInfoDiv) {
                         studentNameDisplay.textContent = currentStudentName;
                         studentInfoDiv.style.display = 'flex'; // Show the info div
                    }
                    // Reset upload status/error messages from previous attempts
                    if(uploadStatus) uploadStatus.style.display = 'none';
                    if(uploadError) uploadError.style.display = 'none';
                    // Configure the upload section based on whether data is embedded or not
                    if (embeddedCourseMessage && embeddedCourseMessage.style.display === 'block') {
                        // If the message is already visible (set during init/processing), ensure correct config
                        configureUploadSectionForEmbeddedMode(embeddedCourseMessage.textContent);
                    } else {
                         // Otherwise, ensure standard mode config
                         configureUploadSectionForStandardMode();
                         // Hide export button by default, show later if course loaded
                         if (exportModuleBtn) exportModuleBtn.style.display = 'none';
                    }
                    break;

                case 'topic':
                case 'supplementary':
                case 'moduleCompletion':
                case 'report':
                    if (currentCourseData) {
                        sidebarNav.style.display = 'flex'; // Show sidebar
                        uploadSection.style.display = 'block'; // Keep upload section visible (usually collapsed)
                        courseDisplaySection.style.display = 'block'; // Show course content area
                        // Show student info and name
                        if (studentNameDisplay && studentInfoDiv) {
                            studentNameDisplay.textContent = currentStudentName || 'N/A';
                            studentInfoDiv.style.display = 'flex';
                        }
                        // Show export button only if a course is loaded AND it's not an embedded file
                        if (exportModuleBtn && !window.embeddedCourseData) {
                             exportModuleBtn.style.display = 'block';
                        } else if (exportModuleBtn) {
                             exportModuleBtn.style.display = 'none'; // Ensure hidden in embedded mode
                        }
                        // Render the specific course content (topic, quiz, report, etc.)
                        renderCourseArea();
                        updateProgressBar(); // Update progress bar based on current state
                        // Ensure upload section is collapsed when viewing course content
                         if (!isUploadCollapsed) {
                             toggleUploadSection(); // Collapse it if it was open
                         }
                    } else {
                        // If trying to access course view without data, fallback to upload
                        logError("Attempted to render course view with no course data", new Error(`Current View: ${currentView}`));
                        currentView = 'upload'; // Go back to upload screen
                        renderUI(); // Re-render
                    }
                    break;

                default:
                    // Handle unknown view state - fallback to login
                    logError('Unknown view state encountered in renderUI', new Error(`Invalid view: ${currentView}`));
                    currentView = 'login'; // Fallback to login screen
                    resetLocalStorageOnError(); // Reset state as it might be corrupted
                    renderUI(); // Re-render the login screen
            }
             console.log(`UI Rendering complete for view: ${currentView}`);
        }

        // --- Progress Bar Update ---
        /**
         * Updates the width and text of the progress bar based on completed topics in the current module.
         */
        function updateProgressBar() {
            // Ensure elements and data are available
            if (!currentCourseData || !progressFill || !progressText) return;

            const module = getCurrentModule();
            let progressPercent = 0;
            let progressString = "Module Progress: 0%";

            if (module && Array.isArray(module.topics) && module.topics.length > 0) {
                const topics = module.topics;
                let completedCount = 0;
                topics.forEach((topic, index) => {
                    // Use the consistent completion check function
                    if (hasCompletedTopic(currentModuleIndex, index)) {
                        completedCount++;
                    }
                });
                progressPercent = (completedCount / topics.length) * 100;
                progressString = `Module Progress: ${progressPercent.toFixed(0)}% (${completedCount}/${topics.length})`;
            } else if (module) {
                 // Module exists but has no topics - consider it 100% complete
                 progressPercent = 100;
                 progressString = "Module Progress: 100% (0/0)";
            } // else: No module data, defaults to 0%

            // Update UI elements
            progressFill.style.width = `${progressPercent}%`;
            progressText.textContent = progressString;
        }

        // --- Login/Logout Handlers ---
        /**
         * Handles the student login process.
         * Validates input, saves name to localStorage, updates state,
         * and processes any pending embedded data.
         */
        function handleLogin() {
             // Validate elements exist
             if (!studentNameInput || !loginError || !studentInfoDiv) {
                 logError("Login elements missing from DOM", new Error("Cannot handle login"));
                 alert("Login components are missing. Cannot log in.");
                 return;
             }
            const name = studentNameInput.value.trim();
            if (!name) {
                loginError.textContent = "Please enter your name.";
                loginError.className = 'error-message mt-3'; // Ensure error style
                loginError.style.display = 'block';
                studentNameInput.focus(); // Focus input for correction
                return;
            }

            // --- Login Success ---
            console.log(`Logging in student: ${name}`);
            currentStudentName = name;
            localStorage.setItem('currentStudentName', name); // Save to localStorage
            loginError.style.display = 'none'; // Hide error/info message
            currentView = 'upload'; // Set view to upload screen
            resetCourseState(); // Clear any previous course data (important!)

            // --- Process Pending Embedded Data ---
            // CRITICAL: This happens *after* login and state update
            if (pendingEmbeddedData) {
                console.log("Processing stored embedded data after successful login.");
                try {
                    processEmbeddedData(pendingEmbeddedData);
                } finally {
                     pendingEmbeddedData = null; // Clear pending data regardless of success/failure
                }
            } else {
                // If no pending data, just render the standard upload screen
                renderUI();
            }
        }

        /**
         * Handles the student logout process.
         * Clears student name, resets course state, and returns to the login screen.
         */
        function handleLogout() {
            console.log(`Logging out student: ${currentStudentName}`);
            currentStudentName = null;
            localStorage.removeItem('currentStudentName'); // Remove from localStorage
            // Optional: Clear progress for the logged-out user? Depends on requirements.
            // Consider clearing progress associated with the specific student/course ID here if needed.
            resetCourseState(); // Reset course data and UI elements
            currentView = 'login'; // Set view back to login
            renderUI(); // Render the login screen
        }

        // --- File Upload & Processing ---
        /**
         * Handles the file selection event from the input element.
         * Validates the file type and initiates the reading process.
         * @param {Event} event - The file input change event.
         */
        function handleFileUpload(event) {
            // Validate required elements
            if (!uploadError || !uploadStatus || !event.target?.files) {
                 logError("File upload elements missing", new Error("Cannot handle file upload"));
                 return;
            }
            // Reset UI messages
            uploadError.style.display = 'none';
            uploadStatus.style.display = 'none';
            if(exportModuleBtn) exportModuleBtn.style.display = 'none'; // Hide export button during upload attempt

            const file = event.target.files[0];
            if (!file) {
                console.log("No file selected.");
                return; // No file chosen
            }

            // Validate file type (must be JSON)
            if (file.type !== 'application/json') {
                const errorMsg = "Invalid file type. Please upload a JSON file (.json).";
                uploadError.textContent = errorMsg;
                uploadError.style.display = 'block';
                logError(errorMsg, new Error(`File type: ${file.type}`));
                event.target.value = ''; // Clear the input field
                return;
            }

            // --- Read File Content ---
            uploadStatus.textContent = `Reading file: ${file.name}...`;
            uploadStatus.style.display = 'block';
            const reader = new FileReader();

            reader.onload = (e) => {
                // File successfully read
                try {
                    console.log("File read successfully. Parsing JSON...");
                    const jsonData = JSON.parse(e.target.result);
                    // Use the central processing function
                    processCourseData(jsonData, file.name); // Pass filename as identifier
                } catch (error) {
                    // Error parsing JSON content
                    const errorMsg = `Error parsing JSON file: ${error.message}. Please ensure the file is valid JSON.`;
                    uploadError.textContent = errorMsg;
                    uploadError.style.display = 'block';
                    uploadStatus.style.display = 'none';
                    logError(`Error parsing JSON from file: ${file.name}`, error);
                    resetCourseState(); // Reset state on parsing error
                    event.target.value = ''; // Clear the input field
                }
            };

            reader.onerror = (e) => {
                // Error reading the file itself
                const errorMsg = "Error reading the selected file. It might be corrupted or permissions are denied.";
                uploadError.textContent = errorMsg;
                uploadError.style.display = 'block';
                uploadStatus.style.display = 'none';
                logError(`Error reading file: ${file.name}`, e);
                resetCourseState();
                event.target.value = ''; // Clear the input field
            };

            reader.readAsText(file); // Start reading the file as text
        }

        /**
         * Central function to process validated course data (from file or embedded).
         * Updates global state, loads progress, renders sidebar and course area.
         * @param {object} data - The validated course data object.
         * @param {string} [courseIdentifier="embedded_course"] - An identifier (like filename) for the course source.
         * @throws {Error} If the provided data is invalid.
         */
        function processCourseData(data, courseIdentifier = "embedded_course") {
             console.log(`Processing course data for: ${courseIdentifier}`);
             // --- Reset UI elements related to upload before processing ---
             if(uploadStatus) uploadStatus.style.display = 'none';
             if(uploadError) uploadError.style.display = 'none';
             if(exportModuleBtn) exportModuleBtn.style.display = 'none'; // Hide initially

             // --- Validate Course Data Structure ---
             if (!data || typeof data !== 'object') {
                 throw new Error("Invalid course data: Not an object.");
             }
             if (!data.courseTitle || typeof data.courseTitle !== 'string' || !Array.isArray(data.modules)) {
                throw new Error("Invalid course JSON format. Missing 'courseTitle' (string) or 'modules' (array).");
             }
             // Optional: Add deeper validation (check module/topic structure, IDs, etc.) here if needed.

             // --- Update Global State ---
             currentCourseData = data;
             // Create a unique ID combining identifier and title for progress storage
             const safeIdentifier = courseIdentifier.replace(/\.json$/i, '').replace(/[^a-zA-Z0-9_-]/g, '');
             const safeTitle = data.courseTitle.replace(/[^a-zA-Z0-9_-]/g, '');
             currentCourseId = `${safeIdentifier}_${safeTitle}`; // Used for localStorage key
             console.log(`Course ID set to: ${currentCourseId}`);

             // --- Update UI (Course Title) ---
             if (courseTitleElement) courseTitleElement.textContent = currentCourseData.courseTitle;

             // --- Load Student Progress ---
             // This must happen *after* setting currentCourseId and currentStudentName
             loadProgress(); // Loads or initializes progress based on the new course ID and student

             // --- Render Sidebar & Update Progress Bar ---
             renderSidebar(); // Populate sidebar based on course structure
             updateProgressBar(); // Update progress bar based on loaded data & progress

             // --- Determine Initial Topic/View based on loaded progress ---
             const module = getCurrentModule(); // Uses currentModuleIndex from loaded progress
             const topicsExist = module && Array.isArray(module.topics);
             const numTopics = topicsExist ? module.topics.length : 0;

             // If loaded progress points beyond the last topic, show module completion summary
             if (module && topicsExist && currentTopicIndex >= numTopics) {
                 currentView = 'moduleCompletion';
                 currentTopicView = 'content'; // Default subview for completion
             } else if (module) {
                 // Otherwise, start at the topic defined by loaded progress
                 currentView = 'topic';
                 currentTopicView = 'content'; // Default subview for topic
             } else {
                 // If the loaded module index is invalid (e.g., course structure changed), default to upload
                 logError("Loaded module index invalid after loading progress. Resetting view.", new Error(`Module Index: ${currentModuleIndex}`));
                 currentView = 'upload';
                 // Optionally show an error message?
             }
             console.log(`Course processed. Initial view set to '${currentView}' (Module: ${currentModuleIndex}, Topic: ${currentTopicIndex})`);

             // --- Final UI Render ---
             renderUI(); // Render the main content area (topic, completion, etc.) based on the new view

              // --- Success message and Export Button (only if NOT embedded) ---
             if (!window.embeddedCourseData) {
                 if (uploadStatus) {
                     uploadStatus.textContent = `Successfully loaded: ${data.courseTitle}`;
                     uploadStatus.className = 'success-message mt-3'; // Use success style
                     uploadStatus.style.display = 'block';
                 }
                 if (exportModuleBtn) {
                     exportModuleBtn.style.display = 'block'; // Show export button after successful load
                     console.log("Export button enabled.");
                 }
             } else {
                 console.log("Running in embedded mode, export button remains hidden.");
                 // Ensure the embedded message is shown correctly (handled by processEmbeddedData caller)
             }
         }

        /**
         * Processes embedded course data (typically found in exported files).
         * Decodes, parses, and then calls the central `processCourseData`.
         * Updates the upload section UI to reflect the preloaded state.
         * @param {string} base64Data - The Base64 encoded JSON string of the course data.
         */
        function processEmbeddedData(base64Data) {
            console.log("Attempting to process embedded data...");
            if (!currentStudentName) {
                // This case should be prevented by the check in initializeApp, but log defensively.
                logError("Cannot process embedded data: Student not logged in.", new Error("Login Required"));
                // Store in pending data if somehow missed? Should already be handled.
                pendingEmbeddedData = base64Data;
                return;
            }
            try {
                console.log("Decoding base64 data...");
                const jsonString = atob(base64Data); // Decode base64 string
                console.log("Parsing JSON data...");
                const jsonData = JSON.parse(jsonString); // Parse the JSON string into an object
                console.log("JSON parsed successfully. Calling processCourseData.");

                // Use the central processing function
                processCourseData(jsonData, "embedded_course"); // Identify as embedded

                // Configure upload section for embedded mode *after* data is processed
                const message = `Course module '${escapeHtml(jsonData.courseTitle) || 'Unknown'}' is preloaded.`;
                console.log("Configuring upload section for embedded mode.");
                configureUploadSectionForEmbeddedMode(message);

            } catch (error) {
                logError('Error processing embedded course data', error);
                if (uploadError) {
                    uploadError.textContent = `Error loading embedded course: ${error.message}. The file might be corrupted. Please try uploading a valid JSON file manually.`;
                    uploadError.style.display = 'block';
                }
                 // Reset state if embedded data is corrupt to allow manual upload
                resetCourseState();
                 // Re-render to show the standard upload screen with error
                renderUI();
            }
        }

        // --- Upload Section UI Configuration ---
        /**
         * Configures the upload section UI for standard file upload mode.
         * Shows file input/label, hides embedded message. Export button shown if course loaded.
         */
         function configureUploadSectionForStandardMode() {
             if (embeddedCourseMessage) embeddedCourseMessage.style.display = 'none';
             if (courseFileLabel) courseFileLabel.style.display = 'block';
             if (courseFileInput) courseFileInput.style.display = 'block';
             if (courseFileInput) courseFileInput.value = ''; // Clear any selected file
             // Show export button only if a course is currently loaded
             if (exportModuleBtn) exportModuleBtn.style.display = currentCourseData ? 'block' : 'none';
             console.log("Upload section configured for standard mode.");
         }

         /**
          * Configures the upload section UI for embedded data mode.
          * Hides file input/label/export button, shows the embedded message.
          * @param {string} message - The message to display (e.g., "Course preloaded").
          */
         function configureUploadSectionForEmbeddedMode(message) {
             if (embeddedCourseMessage) {
                 embeddedCourseMessage.textContent = message;
                 embeddedCourseMessage.style.display = 'block';
             }
             if (courseFileLabel) courseFileLabel.style.display = 'none';
             if (courseFileInput) courseFileInput.style.display = 'none';
             if (exportModuleBtn) exportModuleBtn.style.display = 'none'; // Never show export in embedded mode
             if (uploadStatus) uploadStatus.style.display = 'none'; // Hide normal status messages
             if (uploadError) uploadError.style.display = 'none'; // Hide normal error messages
             console.log("Upload section configured for embedded mode.");
         }

        // --- Reset Application State ---
        /**
         * Resets the course-related state variables and clears relevant UI elements.
         * Does NOT log the user out or change the primary view state directly.
         */
        function resetCourseState() {
            console.log("Resetting course state...");
            currentCourseData = null;
            currentCourseId = null; // Clear course ID
            currentModuleIndex = 0;
            currentTopicIndex = 0;
            currentTopicView = 'content'; // Reset topic sub-view
            currentTopicScore = 0;
            // Keep studentProgress associated with student unless explicitly cleared (e.g., on logout)
            // studentProgress = {}; // DO NOT reset progress here generally
            quizTimeRemaining = 600; // Reset timer default
            clearQuizTimer(); // Clear any active timer

            // --- Clear UI Elements ---
            if (courseTitleElement) courseTitleElement.textContent = "";
            if (moduleTitleElement) moduleTitleElement.textContent = "";
            if (topicTitleElement) topicTitleElement.textContent = "";
            if (courseContentElement) courseContentElement.innerHTML = "";
            if (quizContainerElement) quizContainerElement.innerHTML = "";
            if (feedbackElement) feedbackElement.innerHTML = "";
            if (navContent) navContent.innerHTML = ""; // Clear sidebar navigation
            if (generateReportBtn) generateReportBtn.style.display = 'none'; // Hide report button
            if (exportModuleBtn) exportModuleBtn.style.display = 'none'; // Hide export button
            if (embeddedCourseMessage) embeddedCourseMessage.style.display = 'none'; // Hide embedded message
            if (uploadStatus) uploadStatus.style.display = 'none';
            if (uploadError) uploadError.style.display = 'none';

            // Ensure upload section is back to normal file input mode
            configureUploadSectionForStandardMode();
            updateProgressBar(); // Reset progress bar display
            console.log("Course state reset complete.");
        }

        // --- Progress Management (LocalStorage) ---
        /**
         * Generates the localStorage key for storing progress based on student name and course ID.
         * @returns {string|null} The progress key or null if data is missing.
         */
        function getProgressKey() {
            if (!currentStudentName || !currentCourseId) {
                 // console.warn("Cannot get progress key: Missing student name or course ID.");
                 return null;
            }
            // Sanitize names to create a safe key (allow letters, numbers, underscore, hyphen)
            const safeStudent = currentStudentName.replace(/[^a-zA-Z0-9_-]/g, '');
            const safeCourse = currentCourseId.replace(/[^a-zA-Z0-9_-]/g, '');
            // Use a prefix to avoid collisions with other localStorage items
            return `learnmaster_progress_${safeStudent}_${safeCourse}`;
        }

        /**
         * Saves the current student progress (module/topic index, scores, completed modules)
         * to localStorage using the generated progress key.
         */
        function saveProgress() {
            const progressKey = getProgressKey();
            if (!progressKey) return; // Cannot save without a key

            // Ensure the progress object structure is valid before saving
            if (!studentProgress || typeof studentProgress !== 'object') {
                 logError("Attempted to save invalid studentProgress object", new Error(JSON.stringify(studentProgress)));
                // Reset to a default structure if invalid to prevent saving bad data
                studentProgress = { moduleIndex: 0, topicIndex: 0, topicScores: {}, completedModules: [] };
            }
            // Ensure sub-properties exist and have correct types
            studentProgress.moduleIndex = typeof currentModuleIndex === 'number' ? currentModuleIndex : 0;
            studentProgress.topicIndex = typeof currentTopicIndex === 'number' ? currentTopicIndex : 0;
            studentProgress.topicScores = (typeof studentProgress.topicScores === 'object' && studentProgress.topicScores !== null) ? studentProgress.topicScores : {};
            studentProgress.completedModules = Array.isArray(studentProgress.completedModules) ? studentProgress.completedModules : [];

            try {
                const progressString = JSON.stringify(studentProgress);
                localStorage.setItem(progressKey, progressString);
                // console.log(`Progress saved for key ${progressKey}`); // Verbose logging if needed
            } catch (e) {
                logError("Error saving progress to localStorage", e);
                 // Handle potential storage quota errors specifically
                 if (e.name === 'QuotaExceededError') {
                     alert("Could not save progress: Your browser's storage quota for this website has been exceeded. You may need to clear some website data.");
                 }
            }
        }

        /**
         * Loads student progress from localStorage based on the current student and course ID.
         * Initializes or updates `studentProgress`, `currentModuleIndex`, and `currentTopicIndex`.
         * Validates loaded data against the current course structure.
         */
        function loadProgress() {
            const progressKey = getProgressKey();
            // Reset progress state variables before loading
            studentProgress = { moduleIndex: 0, topicIndex: 0, topicScores: {}, completedModules: [] };
            currentModuleIndex = 0;
            currentTopicIndex = 0;

            if (!progressKey) {
                console.log("No progress key available (student/course not set). Using default progress.");
                return; // Use default initial state
            }

            const savedData = localStorage.getItem(progressKey);
             console.log(`Loading progress for key: ${progressKey}`);
            if (savedData) {
                try {
                    const loadedProg = JSON.parse(savedData);
                    // Validate the structure of the loaded data
                    if (loadedProg && typeof loadedProg === 'object') {
                        // Assign values safely, providing defaults if missing or invalid type
                        studentProgress.moduleIndex = Number.isInteger(loadedProg.moduleIndex) ? loadedProg.moduleIndex : 0;
                        studentProgress.topicIndex = Number.isInteger(loadedProg.topicIndex) ? loadedProg.topicIndex : 0;
                        studentProgress.topicScores = (typeof loadedProg.topicScores === 'object' && loadedProg.topicScores !== null) ? loadedProg.topicScores : {};
                        studentProgress.completedModules = Array.isArray(loadedProg.completedModules) ? loadedProg.completedModules : [];
                        console.log("Loaded progress from localStorage:", JSON.stringify(studentProgress));
                    } else {
                         // Loaded data is not a valid object
                         throw new Error("Loaded progress data is not a valid object.");
                    }
                } catch (e) {
                    // Handle JSON parsing errors or validation errors
                    logError(`Error parsing or validating saved progress for key "${progressKey}"`, e);
                    localStorage.removeItem(progressKey); // Remove the corrupted data
                    // Reset to default state after removing bad data
                    studentProgress = { moduleIndex: 0, topicIndex: 0, topicScores: {}, completedModules: [] };
                }
            } else {
                 console.log("No saved progress found for this key. Starting fresh.");
            }

            // --- Validate loaded indices against the *currently loaded* course data ---
             currentModuleIndex = studentProgress.moduleIndex;
             currentTopicIndex = studentProgress.topicIndex;

            if (currentCourseData && Array.isArray(currentCourseData.modules)) {
                const numModules = currentCourseData.modules.length;
                if (numModules === 0) { // Handle courses with no modules
                     currentModuleIndex = 0;
                     currentTopicIndex = 0;
                } else if (currentModuleIndex >= numModules || currentModuleIndex < 0) {
                     // If saved module index is out of bounds for the current course
                     console.warn(`Loaded module index (${currentModuleIndex}) out of bounds (0-${numModules-1}). Resetting to module 0.`);
                    currentModuleIndex = 0;
                    currentTopicIndex = 0; // Also reset topic index
                } else {
                    // Module index is valid, now check topic index within that module
                    const currentModule = currentCourseData.modules[currentModuleIndex];
                    const topicsExist = currentModule && Array.isArray(currentModule.topics);
                    const numTopics = topicsExist ? currentModule.topics.length : 0;

                    // Allow topic index to be == numTopics (signifies module completion view)
                    if (!topicsExist || currentTopicIndex > numTopics || currentTopicIndex < 0) {
                         console.warn(`Loaded topic index (${currentTopicIndex}) out of bounds (0-${numTopics}) for module ${currentModuleIndex}. Resetting topic index to 0.`);
                        currentTopicIndex = 0; // Reset topic index if invalid
                    }
                }
            } else if (currentCourseData) {
                 // Course data exists but modules array is missing/invalid - critical issue
                 logError("Course data loaded but 'modules' array is invalid during progress load.", new Error(JSON.stringify(currentCourseData)));
                 currentModuleIndex = 0; // Reset indices safely
                 currentTopicIndex = 0;
            } // else: No course data loaded yet, indices remain 0

            // --- Update state variables with validated indices ---
            studentProgress.moduleIndex = currentModuleIndex;
            studentProgress.topicIndex = currentTopicIndex;
             console.log(`Final progress state after loading/validation: Module=${currentModuleIndex}, Topic=${currentTopicIndex}`);
        }


        // --- Sidebar Rendering & Updates ---
        /**
         * Renders the sidebar navigation based on the `currentCourseData`.
         * Populates module titles and topic links.
         */
        function renderSidebar() {
            if (!navContent) {
                 logError("Sidebar navContent element missing", new Error("Cannot render sidebar"));
                 return;
            }
             // Clear existing sidebar content
             navContent.innerHTML = "";
             // Hide report button initially
             if (generateReportBtn) generateReportBtn.style.display = 'none';

             // Check if course data is valid for rendering
             if (!currentCourseData || !Array.isArray(currentCourseData.modules)) {
                 navContent.innerHTML = "<li class='p-2 text-gray-500 text-sm'>No course loaded.</li>"; // Placeholder message
                 return;
             }

            let navHTML = '<ul class="space-y-1">'; // Add spacing between modules
            currentCourseData.modules.forEach((module, modIndex) => {
                 // Validate module structure before adding
                 if (!module || typeof module.title === 'undefined' || typeof module.id === 'undefined') {
                     logError(`Skipping invalid module at index ${modIndex} in sidebar rendering`, new Error(JSON.stringify(module)));
                     navHTML += `<li class="module-title error-message p-2">Invalid Module Data</li>`;
                     return; // Skip this module
                 }
                 // Module Title (Clickable)
                navHTML += `<li><div class="module-title" onclick="navigateToModule(${modIndex})" tabindex="0" role="button" aria-label="Module ${modIndex + 1}: ${escapeHtml(module.title)}">${escapeHtml(module.title)}</div>`;

                 // Topic List (if topics exist)
                if (module.topics && Array.isArray(module.topics) && module.topics.length > 0) {
                    navHTML += '<ul class="topic-list mt-1 space-y-0.5">'; // Nested list for topics
                    module.topics.forEach((topic, topIndex) => {
                         // Validate topic structure
                         if (!topic || typeof topic.id === 'undefined' || typeof topic.title === 'undefined') {
                              logError(`Skipping invalid topic at index ${topIndex} in module ${modIndex} sidebar rendering`, new Error(JSON.stringify(topic)));
                              navHTML += `<li class="topic-item pl-2"><span class="error-message text-xs">Invalid Topic Data</span></li>`;
                             return; // Skip this topic
                         }
                         // Determine topic status (completed, active)
                        const isCompleted = hasCompletedTopic(modIndex, topIndex);
                        const isActive = (currentView === 'topic' && modIndex === currentModuleIndex && topIndex === currentTopicIndex);
                        const topicTitle = escapeHtml(topic.title);
                        const topicId = escapeHtml(topic.id);
                         // Topic Link
                        navHTML += `<li class="topic-item">
                            <a href="#" onclick="event.preventDefault(); navigateToTopic(${modIndex}, ${topIndex})"
                                class="${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}"
                                data-module-index="${modIndex}" data-topic-index="${topIndex}" tabindex="0"
                                aria-label="Topic ${topicId}: ${topicTitle}${isCompleted ? ' (Completed)' : ''}"
                                title="${topicId}: ${topicTitle}">
                               ${topicId}: ${topicTitle}
                            </a>
                        </li>`;
                    });
                    navHTML += '</ul>'; // Close topic-list
                }

                // Supplementary Resources Link (if available)
                if (module.supplementaryResources && module.supplementaryResources.videos && Array.isArray(module.supplementaryResources.videos) && module.supplementaryResources.videos.length > 0) {
                    const isSuppActive = (currentView === 'supplementary' && modIndex === currentModuleIndex);
                    navHTML += `<li class="supplementary-link mt-1">
                        <a href="#" onclick="event.preventDefault(); navigateToSupplementary(${modIndex})"
                           class="${isSuppActive ? 'active' : ''}"
                           data-module-index="${modIndex}" tabindex="0"
                           aria-label="Supplementary materials for module ${modIndex + 1}"
                           title="Supplementary Materials for ${escapeHtml(module.title)}">
                           Supplementary Materials
                        </a>
                    </li>`;
                }
                navHTML += '</li>'; // Close module li
            });
            navHTML += '</ul>'; // Close main ul
            navContent.innerHTML = navHTML;

            // Show report button now that course is loaded
            if (generateReportBtn) generateReportBtn.style.display = 'block';
        }

        /**
         * Updates the visual highlighting (active class) of the current item in the sidebar.
         */
        function updateSidebarHighlight() {
             if (!navContent) return;
             // Remove 'active' class from all links first
             const links = navContent.querySelectorAll('a');
             links.forEach(link => link.classList.remove('active'));

             let activeLink = null;
             // Find the link corresponding to the current view and indices
             if (currentView === 'supplementary') {
                 activeLink = navContent.querySelector(`.supplementary-link a[data-module-index="${currentModuleIndex}"]`);
             } else if (currentView === 'topic') {
                 // Ensure topic exists before selecting its link
                 const module = getCurrentModule();
                 if (module && Array.isArray(module.topics) && currentTopicIndex < module.topics.length) {
                     activeLink = navContent.querySelector(`.topic-item a[data-module-index="${currentModuleIndex}"][data-topic-index="${currentTopicIndex}"]`);
                 }
             } // No specific highlighting for moduleCompletion or report views needed in sidebar links

             // Add 'active' class if a valid link was found
             if (activeLink) {
                  activeLink.classList.add('active');
                  // Optional: Scroll the active link into view if needed
                  // activeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
             }
         }

        /**
         * Adds the 'completed' class to a specific topic link in the sidebar.
         * @param {number} moduleIndex - The index of the module.
         * @param {number} topicIndex - The index of the topic within the module.
         */
        function updateSidebarCompletion(moduleIndex, topicIndex) {
             if (!navContent) return;
             // Find the specific topic link using data attributes
             const completedLink = navContent.querySelector(`a[data-module-index="${moduleIndex}"][data-topic-index="${topicIndex}"]`);
             // Add the class only if the link exists and doesn't already have it
             if (completedLink && !completedLink.classList.contains('completed')) {
                 completedLink.classList.add('completed');
             }
         }

        // --- Navigation Functions ---
        /**
         * Navigates to the specified module, setting the topic index to 0.
         * @param {number} moduleIndex - The index of the module to navigate to.
         */
        function navigateToModule(moduleIndex) {
            console.log(`Navigating to Module: ${moduleIndex}`);
            // Validate navigation target
            if (!currentCourseData || !Array.isArray(currentCourseData.modules) || moduleIndex >= currentCourseData.modules.length || moduleIndex < 0) {
                logError("Invalid module navigation attempt", new Error(`Requested moduleIndex: ${moduleIndex}`));
                alert("Cannot navigate to this module: Invalid index.");
                return;
            }
            // Update state
            currentModuleIndex = moduleIndex;
            currentTopicIndex = 0; // Start at the first topic of the new module
            currentView = 'topic'; // Assume starting with topic content
            currentTopicView = 'content';
            // Render UI and save progress
            renderUI();
            saveProgress();
        }

        /**
         * Navigates to a specific topic within a specific module.
         * @param {number} moduleIndex - The index of the module.
         * @param {number} topicIndex - The index of the topic within the module.
         */
        function navigateToTopic(moduleIndex, topicIndex) {
             console.log(`Navigating to Topic: Module ${moduleIndex}, Topic ${topicIndex}`);
             // Validate navigation target
            if (!currentCourseData || !Array.isArray(currentCourseData.modules) || moduleIndex >= currentCourseData.modules.length || moduleIndex < 0) {
                logError("Invalid topic navigation (module index)", new Error(`Requested moduleIndex: ${moduleIndex}`));
                alert("Cannot navigate: Invalid module index.");
                return;
            }
            const module = currentCourseData.modules[moduleIndex];
            if (!module || !Array.isArray(module.topics) || topicIndex >= module.topics.length || topicIndex < 0) {
                logError("Invalid topic navigation (topic index)", new Error(`Requested topicIndex: ${topicIndex} for module ${moduleIndex}`));
                 alert("Cannot navigate: Invalid topic index for this module.");
                return;
            }
            // Update state
            currentModuleIndex = moduleIndex;
            currentTopicIndex = topicIndex;
            currentView = 'topic';
            currentTopicView = 'content'; // Always start topic view with content
            // Render UI and save progress
            renderUI();
            saveProgress();
        }

        /**
         * Navigates to the supplementary materials view for a specific module.
         * @param {number} moduleIndex - The index of the module whose supplementary materials to view.
         */
        function navigateToSupplementary(moduleIndex) {
             console.log(`Navigating to Supplementary: Module ${moduleIndex}`);
             // Validate navigation target
            if (!currentCourseData || !Array.isArray(currentCourseData.modules) || moduleIndex >= currentCourseData.modules.length || moduleIndex < 0) {
                logError("Invalid supplementary navigation attempt", new Error(`Requested moduleIndex: ${moduleIndex}`));
                alert("Cannot navigate: Invalid module index for supplementary materials.");
                return;
            }
            // Update state (keep currentTopicIndex to return correctly)
            currentModuleIndex = moduleIndex;
            currentView = 'supplementary';
            // Render UI (no need to save progress as topic index hasn't changed)
            renderUI();
        }


        // --- Course Content Area Rendering ---
        /**
         * Gets the data object for the currently selected module.
         * @returns {object|null} The module object or null if invalid index/data.
         */
        function getCurrentModule() {
            if (!currentCourseData || !Array.isArray(currentCourseData.modules) || currentModuleIndex >= currentCourseData.modules.length || currentModuleIndex < 0) {
                return null;
            }
            return currentCourseData.modules[currentModuleIndex];
        }

        /**
         * Gets the data object for the currently selected topic within the current module.
         * @returns {object|null} The topic object or null if invalid index/data.
         */
        function getCurrentTopic() {
            const module = getCurrentModule();
            if (!module || !Array.isArray(module.topics) || currentTopicIndex >= module.topics.length || currentTopicIndex < 0) {
                return null;
            }
            return module.topics[currentTopicIndex];
        }

        /**
         * Renders the main course content area (#course-display-section)
         * based on the `currentView` (topic, supplementary, report, etc.).
         * Delegates to sub-render functions.
         */
        function renderCourseArea() {
             console.log(`Rendering Course Area: View=${currentView}, Module=${currentModuleIndex}, Topic=${currentTopicIndex}, SubView=${currentTopicView}`);
            // --- Element Validation ---
             if (!moduleTitleElement || !topicTitleElement || !courseContentElement || !quizContainerElement || !feedbackElement) {
                 logError("Essential course display elements missing from DOM", new Error("Cannot render course area"));
                 if(mainContent) mainContent.innerHTML = "<p class='error-message p-5'>Critical Error: Course display components missing. App cannot display content.</p>";
                 return;
             }

            // --- Get Current Module (Required for all course views) ---
            const module = getCurrentModule();
            if (!module) {
                // Handle case where module data is missing (e.g., invalid index after load)
                logError("Current module data is missing or invalid in renderCourseArea", new Error(`Index: ${currentModuleIndex}`));
                moduleTitleElement.textContent = "Error";
                topicTitleElement.textContent = "Module Not Found";
                courseContentElement.innerHTML = "<p class='error-message'>Error: Could not load data for the selected module. Please try reloading the course or selecting a different module from the sidebar.</p>";
                courseContentElement.style.display = 'block';
                // Clear other areas
                quizContainerElement.innerHTML = ''; quizContainerElement.style.display = 'none';
                feedbackElement.innerHTML = ''; feedbackElement.style.display = 'none';
                updateSidebarHighlight(); // Ensure sidebar shows no active topic
                return;
            }

             // --- Set Module Title (Common to most views) ---
             moduleTitleElement.textContent = module.title || "[Module Title Missing]";

            // --- Clear Previous Content & Hide Areas ---
             courseContentElement.innerHTML = ''; courseContentElement.style.display = 'none';
             quizContainerElement.innerHTML = ''; quizContainerElement.style.display = 'none';
             feedbackElement.innerHTML = ''; feedbackElement.style.display = 'none';

             // --- Determine Dynamic Title & Render Specific Content ---
             const topic = getCurrentTopic(); // May be null if index is out of bounds (module completion)
             let dynamicTitle = ""; // Title displayed below module title (e.g., Topic Title)

             try {
                 switch (currentView) {
                     case 'topic':
                         // If topic index is invalid for the current module, treat as module completion
                         if (!topic) {
                              console.warn(`Topic index ${currentTopicIndex} invalid for module ${currentModuleIndex}. Switching to module completion view.`);
                              currentView = 'moduleCompletion';
                              // Re-call renderCourseArea to handle the corrected view state
                              renderCourseArea();
                              return; // Stop this execution path
                         }
                         dynamicTitle = `Topic ${topic.id || '?'}: ${escapeHtml(topic.title) || '[Topic Title Missing]'}`;
                         renderTopicSubView(); // Handles content/quiz/results display internally
                         break;

                     case 'supplementary':
                         dynamicTitle = "Supplementary Materials";
                         courseContentElement.style.display = 'block'; // Show content area
                         renderSupplementaryContent();
                         break;

                     case 'moduleCompletion':
                         dynamicTitle = "Module Summary"; // Changed title
                         moduleTitleElement.textContent = (module.title || "[Module]") + " - Summary"; // Adjust module title
                         courseContentElement.style.display = 'block'; // Show content area for message
                         feedbackElement.style.display = 'block'; // Show feedback area for buttons
                         renderModuleCompletion();
                         break;

                     case 'report':
                         dynamicTitle = "Module Report";
                         courseContentElement.style.display = 'block'; // Show content area for report
                         renderModuleReport();
                         break;

                     default:
                         // Should be caught by renderUI, but safeguard here
                         logError("Unknown main view state in renderCourseArea", new Error(`Invalid view: ${currentView}`));
                         dynamicTitle = "Error";
                         courseContentElement.innerHTML = "<p class='error-message'>Internal error: Invalid display state. Please reload.</p>";
                         courseContentElement.style.display = 'block';
                 }
             } catch (error) {
                 // Catch errors from sub-render functions
                 logError(`Error rendering view "${currentView}" (SubView: ${currentTopicView})`, error);
                 dynamicTitle = "Render Error";
                 courseContentElement.innerHTML = `<p class='error-message'>An error occurred while rendering this section (${currentView}). Check the browser console for details.</p>`;
                 courseContentElement.style.display = 'block'; // Ensure error message is visible
             }

             // --- Set Topic/Dynamic Title ---
             topicTitleElement.textContent = dynamicTitle;

            // --- Update UI State (Sidebar Highlight, Save Progress) ---
            updateSidebarHighlight(); // Highlight the correct item in the sidebar
            saveProgress(); // Save progress after any potential state change during rendering
            console.log(`Course Area rendering complete.`);
        }

        /**
         * Renders the appropriate sub-view (content, quiz, results) within the
         * course content area when `currentView` is 'topic'.
         */
        function renderTopicSubView() {
             console.log(`Rendering Topic SubView: ${currentTopicView}`);
             const topic = getCurrentTopic();
             // Defensive check (should be valid if called from renderCourseArea)
             if (!topic) {
                 logError("renderTopicSubView called with invalid topic data.", new Error(`Module: ${currentModuleIndex}, Topic: ${currentTopicIndex}`));
                 currentView = 'moduleCompletion'; // Fallback safely
                 renderUI();
                 return;
             }

             // Render based on the sub-view state
             switch (currentTopicView) {
                 case 'content':
                     courseContentElement.style.display = 'block'; // Show content area
                     renderTopicContent();
                     break;
                 case 'quiz':
                     quizContainerElement.style.display = 'block'; // Show quiz area
                     renderTopicQuiz();
                     break;
                 case 'results':
                     feedbackElement.style.display = 'block'; // Show feedback area
                     renderQuizResults();
                     break;
                 default:
                     // Handle unknown sub-view state
                     logError("Unknown topic sub-view", new Error(`Invalid sub-view: ${currentTopicView}`));
                     courseContentElement.innerHTML = "<p class='error-message'>Internal error: Invalid topic display state.</p>";
                     courseContentElement.style.display = 'block';
                     currentTopicView = 'content'; // Attempt to recover by showing content
             }
         }

        /**
         * Renders the main content of a topic, including supplementary resources link
         * and either a "Take Quiz" button or a "Next Topic" button.
         */
        function renderTopicContent() {
            const topic = getCurrentTopic();
            if (!topic) {
                logError("Cannot render topic content: Current topic data invalid", new Error(`Index: ${currentTopicIndex}`));
                courseContentElement.innerHTML = "<p class='error-message'>Error: Could not load topic content.</p>";
                return;
            }

            // --- Render Main Topic Content ---
            // Basic sanitization might be needed if content source is untrusted.
            // For now, assuming content is safe or using escapeHtml where appropriate.
            courseContentElement.innerHTML = topic.content || "<p><i>No content provided for this topic.</i></p>";

            // --- Render Supplementary Resources Box (if any exist for this topic) ---
            if (topic.supplementaryResources && topic.supplementaryResources.videos && Array.isArray(topic.supplementaryResources.videos) && topic.supplementaryResources.videos.length > 0) {
                courseContentElement.innerHTML += renderSupplementaryVideosHTML(topic.supplementaryResources, `Supplementary Videos for ${escapeHtml(topic.title) || 'this topic'}`);
            }

            // --- Render Action Prompt (Quiz or Next) ---
            const hasQuiz = topic.quiz && Array.isArray(topic.quiz) && topic.quiz.length > 0;
            const module = getCurrentModule(); // Needed for progress check/update
            let promptHTML = '';

            if (hasQuiz) {
                 // If there's a quiz, show the "Take Quiz" button
                 promptHTML = `
                    <div id="quiz-prompt" class="mt-6 p-4 bg-gray-700 rounded text-center border border-gray-600">
                        <p class="mb-3">Ready for a quiz on <strong>${escapeHtml(topic.title) || 'this topic'}</strong>?</p>
                        <button onclick="startTopicQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Take Quiz</button>
                    </div>`;
            } else {
                 // If no quiz, automatically mark topic as complete if not already done
                 if (module && topic && topic.id) {
                     const topicProgressKey = `${module.id}_${topic.id}`;
                     if (!studentProgress.topicScores) studentProgress.topicScores = {};
                     // Only mark complete (score 100) if it hasn't been marked before
                     if (studentProgress.topicScores[topicProgressKey] === undefined) {
                         console.log(`Marking topic ${topic.id} (no quiz) as complete.`);
                         // Use 100 or a specific marker like -1? Using 100 for consistency with 'passing'.
                         studentProgress.topicScores[topicProgressKey] = 100;
                         updateSidebarCompletion(currentModuleIndex, currentTopicIndex); // Update sidebar checkmark
                         saveProgress(); // Save the auto-completion
                         updateProgressBar(); // Update progress bar display immediately
                     }
                 } else {
                      // Log if module/topic ID is missing, preventing auto-completion
                      logError("Could not auto-complete topic (no quiz): Missing module/topic ID", new Error(JSON.stringify({module, topic})));
                 }
                 // Show the "Next Topic" button
                 promptHTML = `
                    <div id="next-topic-prompt" class="mt-6 p-4 bg-gray-700 rounded text-center border border-gray-600">
                        <p class="mb-3">No quiz for this topic. Marked as complete.</p>
                        <button onclick="nextTopic()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Next Topic / Finish Module</button>
                    </div>`;
            }
            // Append the generated prompt/button section to the content
            courseContentElement.innerHTML += promptHTML;
        }

        /**
         * Renders the supplementary materials section for the current module.
         */
        function renderSupplementaryContent() {
            const module = getCurrentModule();
            // Check if supplementary resources exist for the module
            if (!module || !module.supplementaryResources || !module.supplementaryResources.videos || !Array.isArray(module.supplementaryResources.videos) || module.supplementaryResources.videos.length === 0) {
                courseContentElement.innerHTML = "<p>No supplementary materials available for this module.</p>";
            } else {
                 // Render the list of videos using the helper function
                 courseContentElement.innerHTML = renderSupplementaryVideosHTML(module.supplementaryResources, "Module Supplementary Videos");
            }
             // Always add a button to return to the topic content
             courseContentElement.innerHTML += `<div class="mt-4 text-center"><button onclick="navigateToTopic(${currentModuleIndex}, ${currentTopicIndex})" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Return to Topic Content</button></div>`;
        }

        /**
         * Generates the HTML string for a list of supplementary video resources.
         * @param {object} resources - The supplementaryResources object containing videos array and optional introduction.
         * @param {string} title - The title for the resources section.
         * @returns {string} The generated HTML string.
         */
        function renderSupplementaryVideosHTML(resources, title) {
            // Basic validation of input
            if (!resources || !resources.videos || !Array.isArray(resources.videos) || resources.videos.length === 0) return "";

            let resourcesHTML = `<div class="supplementary-resources"><h4>${escapeHtml(title) || 'Supplementary Resources'}</h4>`;
             // Add introduction text if present
             if (resources.introduction) {
                 resourcesHTML += `<p class="text-sm text-gray-400 mb-3">${escapeHtml(resources.introduction)}</p>`;
             }
            resourcesHTML += `<ol class="list-decimal list-inside space-y-3">`; // Increased spacing

            resources.videos.forEach((video, index) => {
                 // Validate individual video object structure
                 if (!video || typeof video !== 'object' || !video.title) {
                     logError(`Invalid video object at index ${index} in supplementary resources`, new Error(JSON.stringify(video)));
                     resourcesHTML += `<li><span class="error-message text-xs">Invalid video data</span></li>`;
                     return; // Skip rendering this invalid video entry
                 }
                 // Extract data safely
                 const desc = String(video.description || '');
                 // Simple duration extraction (adjust regex if format varies)
                 const durationMatch = desc.match(/\((\d+m\d*s?|\d+s)\)$/); // Matches (10m30s), (15m), (45s) etc.
                 const duration = durationMatch ? ` ${escapeHtml(durationMatch[0])}` : ''; // Include parentheses if found
                 const descriptionText = durationMatch ? desc.replace(durationMatch[0], '').trim() : desc;
                 const url = video.url || '#'; // Default to '#' if URL is missing
                 const target = video.url && video.url !== '#' ? '_blank' : '_self'; // Open valid external links in new tab
                 // Escape all potentially user-provided strings
                 const safeTitle = escapeHtml(video.title);
                 const safeDescription = escapeHtml(descriptionText);
                 const safeUrl = escapeHtml(video.url || '');

                 // Construct list item HTML
                 resourcesHTML += `<li>
                     <strong>${safeTitle}</strong>${duration}
                     <br>
                     <a href='${url}' target='${target}' ${target === '_blank' ? 'rel="noopener noreferrer"' : ''} class='text-blue-400 hover:text-blue-300 text-sm break-all' title="Link to ${safeTitle}">
                       ${safeUrl || 'No URL Provided'}
                     </a>
                     ${safeDescription ? `<p class="text-xs text-gray-400 pl-4 mt-1">${safeDescription}</p>` : ''}
                 </li>`;
            });
            resourcesHTML += `</ol></div>`; // Close list and container div
            return resourcesHTML;
        }

         /**
          * Basic HTML escaping function to prevent XSS vulnerabilities.
          * @param {string | number | boolean | undefined | null} unsafe - The input string to escape.
          * @returns {string} The escaped HTML string.
          */
         function escapeHtml(unsafe) {
             if (unsafe === null || unsafe === undefined) return '';
             const str = String(unsafe); // Ensure it's a string
             return str
                  .replace(/&/g, "&amp;")
                  .replace(/</g, "&lt;")
                  .replace(/>/g, "&gt;")
                  .replace(/"/g, "&quot;")
                  .replace(/'/g, "&#039;");
         }


        // --- Quiz Timer Logic ---
        /**
         * Starts the quiz timer. Reads duration from topic settings or uses default.
         * Updates the timer display every second. Handles timeout.
         */
        function startQuizTimer() {
            clearQuizTimer(); // Ensure no previous timers are running
            const topic = getCurrentTopic();

            // Determine quiz duration: Use topic setting or default
             let durationSeconds = 600; // Default 10 minutes
             if (topic && topic.quizSettings && typeof topic.quizSettings.timeLimit === 'number' && topic.quizSettings.timeLimit > 0) {
                 durationSeconds = Math.max(10, topic.quizSettings.timeLimit); // Use provided limit (minimum 10s)
                 console.log(`Using custom quiz time limit: ${durationSeconds}s`);
             } else {
                  console.log(`Using default quiz time limit: ${durationSeconds}s`);
             }
             quizTimeRemaining = durationSeconds;
            quizStartTime = Date.now(); // Record the start time

            // Update timer display immediately
            updateTimerDisplay();

            // Start the interval timer
            console.log(`Starting quiz timer interval.`);
            quizTimerInterval = setInterval(() => {
                quizTimeRemaining--;
                updateTimerDisplay(); // Update the UI

                // Check for timeout
                if (quizTimeRemaining <= 0) {
                     console.log("Quiz time expired.");
                    clearQuizTimer(); // Stop the interval
                    alert("Time's up! Your quiz will be submitted automatically.");
                    const quizForm = document.getElementById('topic-quiz-form');
                    if (quizForm) {
                         try {
                             // Disable form elements to prevent further interaction? Optional.
                             // Array.from(quizForm.elements).forEach(el => el.disabled = true);
                             submitTopicQuiz(quizForm); // Submit the form
                         } catch (error) {
                             logError("Error during automatic quiz submission on timeout", error);
                             displayQuizError("An error occurred submitting the quiz after time expired.");
                         }
                     } else {
                          logError("Could not find quiz form for automatic submission on timeout", new Error("Quiz form not found"));
                     }
                }
            }, 1000); // Run every second
        }

        /**
         * Updates the text content of the quiz timer element in the DOM.
         */
        function updateTimerDisplay() {
             const timerElement = document.getElementById('quiz-timer');
             if (timerElement) {
                 const minutes = Math.floor(quizTimeRemaining / 60);
                 const seconds = quizTimeRemaining % 60;
                 timerElement.textContent = `Time Remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
             }
        }

        /**
         * Clears the quiz timer interval and resets the start time.
         */
        function clearQuizTimer() {
            if (quizTimerInterval) {
                 console.log("Clearing quiz timer interval.");
                clearInterval(quizTimerInterval);
                quizTimerInterval = null;
            }
             quizStartTime = null; // Reset start time marker
        }

        /**
         * Calculates the time elapsed since the quiz started.
         * @returns {string} Formatted time taken (e.g., "1m 30s") or "N/A".
         */
        function getTimeTaken() {
            if (!quizStartTime) return "N/A"; // Timer never started or already cleared prematurely
            const endTime = Date.now();
            let secondsTaken = Math.round((endTime - quizStartTime) / 1000);
            // Prevent negative time if clock changes or submission is faster than interval
            secondsTaken = Math.max(0, secondsTaken);
            const minutes = Math.floor(secondsTaken / 60);
            const seconds = secondsTaken % 60;
            return `${minutes}m ${seconds}s`;
        }


        // --- Quiz Handling ---
        /**
         * Initiates the quiz view for the current topic.
         */
        function startTopicQuiz() {
             console.log("Attempting to start topic quiz...");
            const topic = getCurrentTopic();
            // Check if a valid quiz exists for the current topic
            if (topic && topic.quiz && Array.isArray(topic.quiz) && topic.quiz.length > 0) {
                currentTopicView = 'quiz'; // Set the sub-view state
                renderCourseArea(); // Render the quiz UI (this will call renderTopicQuiz)
                // Timer is started *after* the quiz UI is rendered by renderTopicQuiz -> startQuizTimer
            } else {
                 logError("startTopicQuiz called but no valid quiz found for the current topic", new Error(JSON.stringify(topic?.quiz)));
                 alert("No quiz is available for this topic.");
                 // Optionally, navigate or show a message instead of just alerting
                 // currentTopicView = 'content'; // Stay on content view
                 // renderCourseArea();
            }
        }

        /**
         * Renders the HTML form for the current topic's quiz.
         * Includes questions, options (shuffled for multiple-choice), timer display, and submit button.
         */
        function renderTopicQuiz() {
            const topic = getCurrentTopic();
            // Validate that quiz data is available
            if (!topic || !topic.quiz || !Array.isArray(topic.quiz) || topic.quiz.length === 0) {
                logError("renderTopicQuiz called but no valid quiz found", new Error(JSON.stringify(topic?.quiz)));
                quizContainerElement.innerHTML = "<p>No quiz available for this topic.</p>";
                 // Provide a way forward if no quiz is rendered
                 feedbackElement.innerHTML = `<div class="mt-6 text-center"><button onclick="nextTopic()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Next Topic / Finish Module</button></div>`;
                 feedbackElement.style.display = 'block';
                 quizContainerElement.style.display = 'none'; // Hide the empty quiz container
                 clearQuizTimer(); // Ensure timer is stopped if somehow started
                return;
            }

            // --- Build Quiz Form HTML ---
            // Start form and add timer placeholder
            let quizHTML = `<form id="topic-quiz-form" aria-labelledby="quiz-title">
                                <div id="quiz-timer" class="mb-4 text-center font-semibold" aria-live="polite">Time Remaining: calculating...</div>
                                <h4 id="quiz-title" class="text-lg font-semibold mb-3">${escapeHtml(topic.title) || 'Topic'} Quiz</h4>`;

            // Loop through each question in the quiz data
            topic.quiz.forEach((q, index) => {
                 // Validate individual question structure
                 if (!q || typeof q.question === 'undefined' || typeof q.type === 'undefined') {
                     logError(`Invalid question data at index ${index} in renderTopicQuiz`, new Error(JSON.stringify(q)));
                     quizHTML += `<div class="quiz-question error-message">Error: Invalid question data at position ${index + 1}.</div>`;
                     return; // Skip rendering this invalid question
                 }
                 const questionId = `q${index}`; // ID prefix for inputs related to this question
                 // Question container
                 quizHTML += `<fieldset class="quiz-question" aria-labelledby="${questionId}-legend">
                                 <legend id="${questionId}-legend" class="font-semibold mb-2">${index + 1}. ${escapeHtml(q.question)}</legend>`; // Use fieldset/legend for accessibility

                 // Render input based on question type
                 switch (q.type) {
                     case 'multiple-choice':
                         if (!Array.isArray(q.options) || q.options.length === 0) {
                              logError(`Invalid options for multiple-choice question ${index}`, new Error(JSON.stringify(q.options)));
                              quizHTML += "<p class='text-red-400 text-sm'>Error: Invalid options provided.</p>";
                              break;
                         }
                         // Shuffle options for variety using Fisher-Yates algorithm
                         let shuffledOptions = [...q.options];
                         for (let i = shuffledOptions.length - 1; i > 0; i--) {
                             const j = Math.floor(Math.random() * (i + 1));
                             [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
                         }
                         // Render shuffled radio buttons
                         shuffledOptions.forEach((option, optIndex) => {
                             const optionValue = String(option); // Ensure string type
                             const escapedOption = escapeHtml(optionValue);
                             const inputId = `${questionId}-opt${optIndex}`;
                             quizHTML += `<div class="hover:bg-gray-600 px-2 py-1 rounded">
                                             <input type="radio" name="${questionId}" id="${inputId}" value="${escapedOption}" required class="mr-2" data-question-index="${index}" data-option-index="${optIndex}">
                                             <label for="${inputId}" class="cursor-pointer">${escapedOption}</label>
                                         </div>`;
                         });
                         break;

                     case 'true-false':
                         const trueId = `${questionId}-true`;
                         const falseId = `${questionId}-false`;
                         quizHTML += `<div class="hover:bg-gray-600 px-2 py-1 rounded">
                                          <input type="radio" name="${questionId}" id="${trueId}" value="True" required class="mr-2" data-question-index="${index}">
                                          <label for="${trueId}" class="cursor-pointer">True</label>
                                      </div>
                                      <div class="hover:bg-gray-600 px-2 py-1 rounded">
                                          <input type="radio" name="${questionId}" id="${falseId}" value="False" required class="mr-2" data-question-index="${index}">
                                          <label for="${falseId}" class="cursor-pointer">False</label>
                                      </div>`;
                         break;

                     case 'short-answer':
                         const inputId = `${questionId}_input`;
                         quizHTML += `<div>
                                          <label for="${inputId}" class="block mb-1 text-sm font-medium">Your Answer:</label>
                                          <input type="text" id="${inputId}" name="${questionId}" required class="quiz-short-answer w-full bg-gray-600 border-gray-500 rounded p-2 text-sm" data-question-index="${index}" aria-describedby="${questionId}-legend">
                                      </div>`;
                         break;

                     default:
                          logError(`Unknown question type "${q.type}" for question ${index}`, new Error(JSON.stringify(q)));
                          quizHTML += `<p class='text-red-400 text-sm'>Error: Unknown question type "${escapeHtml(q.type)}".</p>`;
                 }
                 quizHTML += `</fieldset>`; // Close fieldset
            });

            // Add error message placeholder and submit button
            quizHTML += `
                 <div id="quiz-error" class="error-message" style="display: none;" aria-live="assertive"></div>
                 <button type="button" onclick="submitTopicQuiz(this.form)" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded w-full">Submit Quiz (Ctrl+Enter)</button>
             </form>`; // Close form

            // Set the generated HTML and start the timer
            quizContainerElement.innerHTML = quizHTML;
            startQuizTimer(); // Start timer now that UI is ready
        }

        /**
         * Handles the submission of the quiz form.
         * Validates answers, calculates score, saves progress, and transitions to results view.
         * @param {HTMLFormElement} form - The quiz form element.
         */
        function submitTopicQuiz(form) {
            console.log("Submitting quiz...");
            // --- Preliminary Checks ---
            if (!form) {
                logError("Quiz submission attempt with invalid form element", new Error("Form is null or undefined"));
                displayQuizError("Internal Error: Could not find quiz form.");
                return;
            }
            const topic = getCurrentTopic();
            const module = getCurrentModule();
            // Ensure topic, module, and quiz data are valid
            if (!topic || !topic.quiz || !Array.isArray(topic.quiz) || !module || !module.id || !topic.id) {
                logError("Quiz submission error: Invalid topic/module/quiz data", new Error(JSON.stringify({topicId: topic?.id, moduleId: module?.id})));
                clearQuizTimer(); // Stop timer if running
                displayQuizError("Error: Cannot submit quiz due to invalid course data. Please reload.");
                return;
            }
            // Get and clear any previous error messages
            const quizErrorElement = document.getElementById('quiz-error');
            if (quizErrorElement) {
                quizErrorElement.style.display = 'none';
                quizErrorElement.textContent = '';
            }

            // --- Process Answers using FormData ---
            let score = 0;
            const answers = []; // For potential detailed feedback later
            const formData = new FormData(form); // Efficiently get all form data

            try {
                 // Loop through each question defined in the topic data
                 for (let index = 0; index < topic.quiz.length; index++) {
                     const q = topic.quiz[index];
                     // Skip processing if question data itself was invalid (logged during render)
                     if (!q || typeof q.question === 'undefined' || typeof q.type === 'undefined') {
                         continue;
                     }

                     const questionName = `q${index}`;
                     let userAnswer = formData.get(questionName); // Get value using FormData (returns null if not answered)

                     // --- Validation: Check if answered ---
                     if (userAnswer === null || (typeof userAnswer === 'string' && userAnswer.trim() === '')) {
                         logError(`No answer provided for question ${index + 1}`, new Error(`Question Name: ${questionName}`));
                         displayQuizError(`Please answer question ${index + 1}.`);
                         // Focus the first input element of the unanswered question for accessibility
                         const firstUnansweredInput = form.querySelector(`[name="${questionName}"]`);
                         firstUnansweredInput?.focus();
                         return; // Stop submission process
                     }
                     userAnswer = userAnswer.trim(); // Trim whitespace from answer

                     // --- Get Correct Answer from topic data ---
                     let correctAnswer = q.answer !== undefined && q.answer !== null ? String(q.answer) : ''; // Ensure string comparison, handle null/undefined answers

                     // --- Normalize Answers for Comparison ---
                     if (q.type === 'true-false') {
                         // Correct answer in JSON is likely boolean true/false
                         correctAnswer = q.answer ? "True" : "False";
                     } else if (q.type === 'short-answer') {
                         // Case-insensitive comparison for short answers
                         userAnswer = userAnswer.toLowerCase();
                         correctAnswer = correctAnswer.toLowerCase();
                     }
                     // For multiple-choice, the value is already the string option, no normalization needed here.

                     // --- Store answer details (optional) and Score ---
                      answers.push({ question: q.question, userAnswer, correctAnswer, isCorrect: userAnswer === correctAnswer });
                     if (userAnswer === correctAnswer) {
                         score++;
                     }
                 } // End loop through questions

                 // --- Finalize Submission ---
                 console.log("Quiz answers processed. Clearing timer.");
                 const timeTaken = getTimeTaken(); // Get time *before* clearing timer state
                 clearQuizTimer(); // Stop the timer now that answers are processed

                 const totalQuestions = topic.quiz.length;
                 // Calculate score, handle division by zero if no questions
                 currentTopicScore = totalQuestions > 0 ? (score / totalQuestions) * 100 : 100;
                 console.log(`Quiz score: ${score}/${totalQuestions} (${currentTopicScore.toFixed(1)}%)`);

                 // --- Save Progress (Store Highest Score) ---
                 const topicProgressKey = `${module.id}_${topic.id}`;
                 if (!studentProgress.topicScores) studentProgress.topicScores = {};
                 const existingScore = studentProgress.topicScores[topicProgressKey];
                 // Store the current score only if it's higher than any previously stored score
                 if (existingScore === undefined || currentTopicScore > existingScore) {
                      console.log(`Updating score for ${topicProgressKey} from ${existingScore === undefined ? 'N/A' : existingScore.toFixed(1)}% to ${currentTopicScore.toFixed(1)}%`);
                     studentProgress.topicScores[topicProgressKey] = currentTopicScore;
                 } else {
                      console.log(`Keeping existing score for ${topicProgressKey} (${existingScore.toFixed(1)}%) as it's higher than or equal to current attempt (${currentTopicScore.toFixed(1)}%)`);
                 }

                  // Update sidebar completion status based on the *highest* score achieved
                 if (studentProgress.topicScores[topicProgressKey] >= PASSING_SCORE_PERCENT) {
                     updateSidebarCompletion(currentModuleIndex, currentTopicIndex);
                 }
                 saveProgress(); // Save the potentially updated progress

                 // --- Transition to Results View ---
                 currentTopicView = 'results';
                 renderCourseArea(); // Render the results page

            } catch (error) {
                // Catch unexpected errors during processing
                logError("Unexpected error during quiz submission processing", error);
                clearQuizTimer(); // Ensure timer is stopped on error
                displayQuizError("An unexpected error occurred while submitting the quiz. Please check the console and try again.");
            }
        }

        /**
         * Displays an error message within the quiz form area.
         * @param {string} message - The error message to display.
         */
        function displayQuizError(message) {
            const quizErrorElement = document.getElementById('quiz-error');
            if (quizErrorElement) {
                quizErrorElement.textContent = message;
                quizErrorElement.style.display = 'block';
                // Scroll the error message into view so the user sees it
                quizErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                 // Fallback if the error element is somehow missing
                 logError("Cannot display quiz error: #quiz-error element not found", new Error(message));
                 alert("Quiz Error: " + message); // Use alert as a last resort
            }
        }

        /**
         * Renders the quiz results feedback, including score, pass/fail status,
         * time taken, and appropriate action buttons (Review, Try Again, Next).
         */
        function renderQuizResults() {
            console.log("Rendering quiz results...");
            const topic = getCurrentTopic();
            const module = getCurrentModule();
            // Validate necessary data
            if (!topic || !module || !module.id || !topic.id) {
                 logError("Could not render quiz results: Invalid topic/module data", new Error(JSON.stringify({topicId: topic?.id, moduleId: module?.id})));
                 feedbackElement.innerHTML = "<p class='error-message'>Could not load quiz results data. Please navigate back and try again.</p>";
                 feedbackElement.style.display = 'block'; // Ensure error is visible
                return;
            }

             // --- Determine Score and Pass Status ---
             // Use the score stored in progress (highest achieved) for display and logic
             const topicProgressKey = `${module.id}_${topic.id}`;
             // Fallback to currentTopicScore only if somehow not saved (shouldn't happen)
             const displayScore = studentProgress.topicScores?.[topicProgressKey] ?? currentTopicScore;
             const passed = displayScore >= PASSING_SCORE_PERCENT;

            // --- Build Feedback HTML ---
            let feedbackHTML = `<div class="text-center">`;
            feedbackHTML += `<h4 class="text-lg font-semibold mb-2">Quiz Results for ${escapeHtml(topic.title) || 'Topic'}</h4>`;
            // Display score with pass/fail color
            feedbackHTML += `<p class="my-3 text-2xl font-bold ${passed ? 'score-pass' : 'score-fail'}">Your Score: ${displayScore.toFixed(0)}%</p>`;
            // Display time taken (captured during submission)
            feedbackHTML += `<p class="my-2 text-sm text-gray-400">Time Taken: ${getTimeTaken()}</p>`; // Use getTimeTaken result from submission

            // --- Add Buttons and Messages based on Pass/Fail ---
            if (!passed) {
                // Failed the quiz
                feedbackHTML += `<p class="mb-4 text-yellow-400">A score of ${PASSING_SCORE_PERCENT}% or higher is needed to mark this topic as fully completed.</p>`;
                 // Buttons: Review Content, Try Again, Continue Anyway (if attempted)
                 feedbackHTML += `<div class="space-y-2 sm:space-y-0 sm:space-x-3">`; // Button container
                 feedbackHTML += `<button onclick="reviewTopic()" class="bg-yellow-600 hover:bg-yellow-700 text-black font-bold py-2 px-4 rounded mb-2 sm:mb-0">Review Topic Content</button>`;
                 feedbackHTML += `<button onclick="startTopicQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-2 sm:mb-0">Try Quiz Again</button>`;
                 // Allow continuing only if *some* score exists (meaning they attempted it)
                 if (studentProgress.topicScores?.[topicProgressKey] !== undefined) {
                     feedbackHTML += `<button onclick="nextTopic()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Continue Anyway (Incomplete)</button>`;
                 }
                 feedbackHTML += `</div>`;
            } else {
                 // Passed the quiz
                 feedbackHTML += `<p class="mb-4 text-green-400 font-semibold">Great job! Topic marked as completed.</p>`;
                 // Button: Next Topic / Finish Module
                 feedbackHTML += `<button onclick="nextTopic()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Next Topic / Finish Module</button>`;
            }
            feedbackHTML += `</div>`; // Close text-center div

            // Set the generated HTML and ensure the container is visible
            feedbackElement.innerHTML = feedbackHTML;
            feedbackElement.style.display = 'block';
        }

        /**
         * Switches the topic sub-view back to 'content' for review.
         */
        function reviewTopic() {
             console.log("Switching back to topic content view for review.");
            currentTopicView = 'content'; // Change sub-view state
            renderCourseArea(); // Re-render the course area to show content
        }

        /**
         * Advances the user to the next topic or to the module completion view.
         * Updates state, renders UI, and saves progress.
         */
        function nextTopic() {
            console.log("Attempting to navigate to next topic...");
            const module = getCurrentModule();
            // Validate module and topics array exist
            if (!module || !Array.isArray(module.topics)) {
                 logError("Cannot navigate next: Invalid module or topics array.", new Error(JSON.stringify(module)));
                 alert("Cannot proceed: Module data is missing or invalid.");
                 // Fallback: Go to upload screen as a safe measure
                 currentView = 'upload';
                 renderUI();
                return;
            }

            currentTopicIndex++; // Increment topic index optimistically
            const numTopics = module.topics.length;

            if (currentTopicIndex < numTopics) {
                 // --- Navigate to the next topic within the current module ---
                 console.log(`Moving to next topic: Index ${currentTopicIndex}`);
                 currentView = 'topic';
                 currentTopicView = 'content'; // Always start next topic with content view
                 renderUI(); // Render the new topic
                 saveProgress(); // Save the new position
            } else {
                 // --- Reached the end of the module ---
                 console.log("Reached end of module topics. Attempting to mark module complete and showing completion view.");
                 // Attempt to mark module as fully completed based on all topic statuses
                 markModuleCompleted(currentModuleIndex);
                 // Transition to the module completion view
                 currentView = 'moduleCompletion';
                 currentTopicView = 'content'; // Reset subview state for completion screen
                 renderUI(); // Render the module completion screen
                 // Save progress (topic index is now >= numTopics, signifying completion attempt)
                 saveProgress();
            }
        }

        // --- Completion Logic ---
        /**
         * Checks if a specific topic is considered completed based on progress data.
         * A topic is complete if it has no quiz and has been visited, or if it has a quiz
         * and the stored score meets the passing threshold.
         * @param {number} moduleIndex - The index of the module.
         * @param {number} topicIndex - The index of the topic within the module.
         * @returns {boolean} True if the topic is completed, false otherwise.
         */
         function hasCompletedTopic(moduleIndex, topicIndex) {
             const module = currentCourseData?.modules?.[moduleIndex];
             const topic = module?.topics?.[topicIndex];
             // Basic validation: If module/topic data or progress structure is missing, cannot be complete.
             if (!studentProgress || !studentProgress.topicScores || !module || !topic || !module.id || !topic.id) {
                 return false;
             }

             const topicProgressKey = `${module.id}_${topic.id}`;
             const score = studentProgress.topicScores[topicProgressKey]; // Get the stored score (highest achieved)
             const hasQuiz = topic.quiz && Array.isArray(topic.quiz) && topic.quiz.length > 0;

             // Determine completion status:
             // 1. No Quiz: Complete if a score exists (meaning it was visited/auto-completed). Score value might be 100 or specific marker.
             const noQuizCompleted = !hasQuiz && score !== undefined;
             // 2. Has Quiz: Complete if a score exists and meets the passing threshold.
             const quizCompleted = hasQuiz && score !== undefined && score >= PASSING_SCORE_PERCENT;

             const completed = noQuizCompleted || quizCompleted;

             // console.log(`Check Complete M${moduleIndex} T${topicIndex} (${topic.id}): Key=${topicProgressKey}, Score=${score}, HasQuiz=${hasQuiz}, Completed=${completed}`); // Verbose
             return completed;
         }

        /**
         * Marks a module as completed in the `studentProgress.completedModules` array
         * *only if* all its topics are currently marked as completed according to `hasCompletedTopic`.
         * @param {number} moduleIndex - The index of the module to check and potentially mark.
         */
        function markModuleCompleted(moduleIndex) {
            const module = currentCourseData?.modules?.[moduleIndex];
            // Validate module data and ID
            if (!module || !module.id) {
                 logError("Cannot mark module complete: Invalid module data or missing ID.", new Error(`Index: ${moduleIndex}`));
                 return;
            }
            // Ensure the completedModules array exists
            if (!studentProgress.completedModules) studentProgress.completedModules = [];
            // Check if already marked to avoid redundant checks/saves
            if (studentProgress.completedModules.includes(module.id)) {
                 console.log(`Module ${module.id} already marked as completed.`);
                 return;
            }

            let allTopicsDone = true;
            // Check completion status of all topics within the module
            if (module.topics && Array.isArray(module.topics) && module.topics.length > 0) {
                for (let i = 0; i < module.topics.length; i++) {
                    if (!hasCompletedTopic(moduleIndex, i)) {
                        allTopicsDone = false;
                         console.log(`Module ${module.id} not fully complete: Topic ${i} (${module.topics[i]?.id || 'N/A'}) is pending.`);
                        break; // Exit loop early if any topic is incomplete
                    }
                }
            } else {
                 console.log(`Module ${module.id} has no topics, considered complete by default.`);
                 // A module with no topics is considered complete
            }

            // If all topics are done, add the module ID to the completed list
            if (allTopicsDone) {
                 console.log(`All topics in module ${module.id} completed. Adding to completedModules list.`);
                studentProgress.completedModules.push(module.id);
                saveProgress(); // Save the updated list immediately
            } else {
                 console.log(`Module ${module.id} cannot be marked as completed yet (pending topics).`);
            }
        }

        /**
         * Renders the module completion summary view.
         * Displays a congratulatory or pending status message and navigation buttons.
         */
        function renderModuleCompletion() {
            const module = getCurrentModule();
            // Validate module data
            if (!module || !module.id) {
                 logError("Cannot render module completion: Invalid module data", new Error(`Index: ${currentModuleIndex}`));
                 courseContentElement.innerHTML = "<p class='error-message'>Error displaying module completion status.</p>";
                 feedbackElement.innerHTML = "";
                 return;
            }

            // Check if the module is *actually* marked as complete in the progress data
            // This check happens *after* potentially calling markModuleCompleted in nextTopic
            const isTrulyComplete = studentProgress.completedModules?.includes(module.id);
            let completionMessageHTML = '';

            // Display different messages based on completion status
            if (isTrulyComplete) {
                completionMessageHTML = `<div class="p-4 bg-green-800 border border-green-600 rounded text-center text-green-300 font-semibold">
                                      <h4 class="text-xl mb-2">🎉 Module Complete! 🎉</h4>
                                      Congratulations! You have successfully completed all requirements for '${escapeHtml(module.title)}'!
                                   </div>`;
            } else {
                completionMessageHTML = `<div class="p-4 bg-yellow-800 border border-yellow-600 rounded text-center text-yellow-300 font-semibold">
                                      <h4 class="text-xl mb-2">Module End Reached</h4>
                                      You have navigated through all topics. However, some topics may require a higher quiz score (>= ${PASSING_SCORE_PERCENT}%) to be marked as fully completed.
                                      <br>Check the navigation bar (look for ✓ icons) or view the report for details.
                                   </div>`;
            }
            courseContentElement.innerHTML = completionMessageHTML;
            quizContainerElement.innerHTML = ""; // Clear quiz area

            // --- Render Action Buttons ---
            let completionButtonsHTML = `<div class="mt-6 text-center space-y-3 sm:space-y-0 sm:space-x-4">`;
            // Always show the "View Report" button
            completionButtonsHTML += `<button onclick="triggerReportGenerationForCurrentModule()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full sm:w-auto">View Module Report</button>`;

             // Check if this is the last module in the course
             const isLastModule = currentModuleIndex >= currentCourseData.modules.length - 1;

             if (!isLastModule) {
                 // If not the last module, show "Start Next Module" button
                 completionButtonsHTML += `<button onclick="nextModule()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded w-full sm:w-auto">Start Next Module</button>`;
             } else {
                 // --- Last Module Specific Messages ---
                 if (isTrulyComplete) {
                      // Check if ALL modules in the entire course are complete
                      const allModulesInCourse = currentCourseData.modules.map(m => m.id).filter(id => id); // Get all valid module IDs
                      const completedModulesSet = new Set(studentProgress.completedModules || []);
                      const allCourseModulesComplete = allModulesInCourse.every(id => completedModulesSet.has(id));

                      if(allCourseModulesComplete) {
                         // All modules in the course are finished
                         completionButtonsHTML += `<p class="mt-4 text-2xl font-semibold text-yellow-400">🏆 Course Completed! 🏆<br>You have finished all modules in this course.</p>`;
                      } else {
                          // This module is done, but others might be pending
                          completionButtonsHTML += `<p class="mt-4 text-lg font-semibold text-green-400">This module is complete! Check the sidebar for any remaining modules.</p>`;
                      }
                 } else {
                     // Last module reached, but not fully completed
                     completionButtonsHTML += `<p class="mt-4 text-lg font-semibold text-orange-400">This is the last module. Review any pending topics (check report or sidebar) to fully complete the course.</p>`;
                 }
             }
             completionButtonsHTML += `</div>`; // Close button container
            feedbackElement.innerHTML = completionButtonsHTML;
        }

        /**
         * Navigates to the next module in the course sequence.
         */
        function nextModule() {
            console.log("Attempting to navigate to next module...");
            // Check if there is a next module available
            if (currentCourseData && currentModuleIndex < currentCourseData.modules.length - 1) {
                currentModuleIndex++; // Increment module index
                currentTopicIndex = 0; // Reset topic index for the new module
                currentView = 'topic'; // Set view to start the new module's content
                currentTopicView = 'content';
                 console.log(`Moving to next module: Index ${currentModuleIndex}`);
                renderUI(); // Render the UI for the new module/topic
                saveProgress(); // Save the new position
            } else {
                 // Already on the last module or no course data
                 logError("nextModule called but already on the last module or no course data", new Error(`Current Index: ${currentModuleIndex}`));
                 alert("You are already on the last module of this course.");
            }
        }

        // --- Reporting Functionality ---
        /**
         * Generates a detailed completion report string for a specific module.
         * @param {number} moduleIndex - The index of the module to report on.
         * @returns {object|null} An object containing { content: string, module: object, timestamp: Date } or null on error.
         */
         function generateCompletionReport(moduleIndex) {
             // --- Validate Input Data ---
             const module = currentCourseData?.modules?.[moduleIndex];
             if (!module || !module.id || !module.title || !currentStudentName || !currentCourseData || !currentCourseData.courseTitle) {
                 logError("Cannot generate report: Missing critical data (student, course, or module info)", new Error(JSON.stringify({moduleExists: !!module, student: currentStudentName, course: currentCourseData?.courseTitle, moduleIndex})));
                 return null; // Return null to indicate failure
             }

             // --- Report Header ---
             const now = new Date();
             const timestampOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
             const timestamp = now.toLocaleString(undefined, timestampOptions);
             // Simple verification code (can be made more complex if needed)
             const verificationCode = `${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}-${Math.floor(Math.random() * 9000) + 1000}`;

             let reportContent = `RPBedu LearnMaster - Module Completion Report\n`;
             reportContent += `==================================================\n`;
             reportContent += ` Student:         ${currentStudentName}\n`;
             reportContent += ` Course:          ${currentCourseData.courseTitle}\n`;
             reportContent += ` Module:          ${module.title} (ID: ${module.id})\n`;
             reportContent += ` Report Generated: ${timestamp}\n`;
             reportContent += ` Verification Code: ${verificationCode}\n`;
             reportContent += `==================================================\n\n`;
             reportContent += ` Topic Status Breakdown:\n`;
             reportContent += `--------------------------------------------------\n`;

             // --- Topic Details ---
             let moduleTotalPossibleScore = 0; // Sum of 100 for each quiz
             let moduleTotalAchievedScore = 0; // Sum of achieved scores for quizzes attempted
             let moduleTopicsWithQuiz = 0;     // Count of topics that have a quiz
             let moduleTopicsAttemptedQuiz = 0;// Count of topics where quiz was attempted (score exists)
             let moduleTopicsCompleted = 0;    // Count of topics meeting completion criteria
             let moduleOverallStatus = "Pending"; // Overall status: Pending, In Progress, Completed

             if (module.topics && Array.isArray(module.topics) && module.topics.length > 0) {
                 module.topics.forEach((topic, index) => {
                     // Validate topic data
                     if (!topic || !topic.id || !topic.title) {
                         reportContent += ` - [${index + 1}] (Error: Invalid topic data)\n`;
                         return; // Skip invalid topic
                     }
                     const topicProgressKey = `${module.id}_${topic.id}`;
                     const score = studentProgress.topicScores?.[topicProgressKey]; // Highest score achieved
                     const hasQuiz = topic.quiz && Array.isArray(topic.quiz) && topic.quiz.length > 0;
                     let status = "Pending"; // Status for this topic
                     let scoreDisplay = "-"; // Score display string

                     if (hasQuiz) {
                         moduleTopicsWithQuiz++;
                         moduleTotalPossibleScore += 100; // Each quiz is out of 100%
                         if (score !== undefined && score !== null) {
                              // Quiz has been attempted
                              moduleTopicsAttemptedQuiz++;
                              scoreDisplay = `${score.toFixed(0)}%`;
                              moduleTotalAchievedScore += score; // Add to total achieved score
                              if (score >= PASSING_SCORE_PERCENT) {
                                  status = "Completed (Passed)";
                                  moduleTopicsCompleted++;
                              } else {
                                  status = "Attempted (Score < ${PASSING_SCORE_PERCENT}%)";
                              }
                         } else {
                             // Quiz exists but not attempted
                             status = "Not Attempted";
                         }
                     } else {
                          // No quiz for this topic
                          if (score !== undefined) {
                              // Topic visited/auto-completed
                              status = "Completed (No Quiz)";
                              moduleTopicsCompleted++;
                              scoreDisplay = "N/A";
                          } else {
                               // Should not happen if linearly progressed, but handle defensively
                               status = "Not Visited";
                          }
                     }
                     // Add topic line to report
                     reportContent += ` - [${topic.id.padEnd(5)}] ${topic.title.padEnd(40)}: ${status.padEnd(25)} (${scoreDisplay})\n`;
                 });

                 // Determine overall module status based on topic completion
                 if (moduleTopicsCompleted === module.topics.length) {
                     moduleOverallStatus = "Completed";
                 } else if (moduleTopicsCompleted > 0 || moduleTopicsAttemptedQuiz > 0 || Object.keys(studentProgress.topicScores || {}).some(k => k.startsWith(module.id))) {
                     // If any topic is complete OR any quiz attempted OR any score exists for this module
                     moduleOverallStatus = "In Progress";
                 } // Otherwise remains "Pending"

             } else {
                 // Module has no topics
                 reportContent += " (No topics defined in this module)\n";
                 moduleOverallStatus = "Completed"; // No topics = complete
             }
             reportContent += `--------------------------------------------------\n\n`;

             // --- Module Summary Section ---
             reportContent += ` Module Summary:\n`;
             reportContent += `--------------------------------------------------\n`;
             // Calculate average score only on quizzes that were actually attempted
             const averageScore = moduleTopicsAttemptedQuiz > 0
                                ? (moduleTotalAchievedScore / moduleTopicsAttemptedQuiz).toFixed(0)
                                : "N/A";
             reportContent += ` Topics Completed:         ${moduleTopicsCompleted} / ${module.topics?.length || 0}\n`;
             reportContent += ` Quizzes Attempted:        ${moduleTopicsAttemptedQuiz} / ${moduleTopicsWithQuiz}\n`;
             reportContent += ` Average Score (Attempted): ${averageScore}%\n`;
             reportContent += ` Overall Module Status:    ${moduleOverallStatus}\n`;
              // Verify against the official completedModules list (set by markModuleCompleted)
              const verifiedComplete = studentProgress.completedModules?.includes(module.id);
              reportContent += ` Verified Completion:      ${verifiedComplete ? "Yes" : "No"}\n`;
              if (!verifiedComplete && moduleOverallStatus === "Completed") {
                   reportContent += `   (Note: All topics individually complete, but final verification pending)\n`;
              } else if (!verifiedComplete && moduleOverallStatus !== "Completed") {
                   reportContent += `   (Requires all topics completed${moduleTopicsWithQuiz > 0 ? ` with quiz score >= ${PASSING_SCORE_PERCENT}%` : ''})\n`;
              }

             reportContent += `==================================================\n`;
             reportContent += ` End of Report\n`;

             // Return report data object
             return { content: reportContent, module: module, timestamp: now };
         }

        /**
         * Triggers the download of the generated report content as a text file.
         * @param {string} reportContent - The full text content of the report.
         * @param {object} module - The module object (needed for filename).
         * @param {Date} timestamp - The timestamp the report was generated (for filename).
         */
        function downloadReport(reportContent, module, timestamp) {
             // Validate inputs
             if (!reportContent || !module || !module.title || !timestamp) {
                 logError("Download report called with missing data", new Error("Report content, module title, or timestamp missing"));
                 alert("Could not download report: Required data is missing.");
                 return;
             }
             try {
                 // Create a Blob (Binary Large Object) from the report text
                 const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                 // Create a temporary URL for the Blob
                 const url = URL.createObjectURL(blob);
                 // Create a temporary anchor element for download
                 const a = document.createElement('a');
                 a.href = url;
                 // Sanitize names and create a descriptive filename
                 const safeStudentName = (currentStudentName || 'student').replace(/[^a-z0-9]/gi, '_').toLowerCase();
                 const safeModuleTitle = (module.title || 'module').replace(/[^a-z0-9]/gi, '_').toLowerCase();
                 const dateStamp = timestamp.toISOString().split('T')[0].replace(/-/g,''); // YYYYMMDD format
                 a.download = `LearnMaster_Report_${safeStudentName}_${safeModuleTitle}_${dateStamp}.txt`;
                 // Append the anchor to the body, click it, and then remove it
                 document.body.appendChild(a);
                 a.click();
                 document.body.removeChild(a);
                 // Release the object URL to free up memory
                 URL.revokeObjectURL(url);
                  console.log(`Report downloaded: ${a.download}`);
             } catch (error) {
                 logError("Error creating report download link", error);
                 alert("An error occurred while trying to prepare the report for download.");
             }
         }

        /**
         * Renders the generated module report in the course content area.
         * Includes a button to download the report as a text file.
         */
        function renderModuleReport() {
             console.log("Rendering module report view...");
             // Generate the report data first
             const reportData = generateCompletionReport(currentModuleIndex);
             // Handle case where report generation failed
             if (!reportData) {
                 courseContentElement.innerHTML = `<p class='error-message'>Unable to generate report. Required data might be missing or an error occurred during generation. Check console for details.</p>
                     <div class="mt-4 text-center">
                        <button onclick="navigateToTopic(${currentModuleIndex}, ${currentTopicIndex})" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Back to Course</button>
                     </div>`;
                 return;
             }
             // Escape the report content for safe HTML display, preserving line breaks
             const escapedReportContent = escapeHtml(reportData.content).replace(/\n/g, '<br>');

             // Construct the HTML for the report display and download button
             // Use template literals carefully with backticks in the report content itself
             const reportHtml = `
                 <div id="report-content" class="text-sm bg-gray-800 p-4 rounded border border-gray-600" aria-live="polite" tabindex="0">
                     ${escapedReportContent}
                 </div>
                 <div class="mt-4 text-center space-x-4">
                      <button onclick="downloadReport(\`${reportData.content.replace(/`/g, '\\`')}\`, currentCourseData.modules[${currentModuleIndex}], new Date('${reportData.timestamp.toISOString()}'))"
                             class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                         Save Report as Text File
                     </button>
                     <button onclick="navigateToTopic(${currentModuleIndex}, ${currentTopicIndex})"
                             class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                         Back to Course Content
                     </button>
                 </div>`;

             courseContentElement.innerHTML = reportHtml;
             // Focus the report content for screen readers
             document.getElementById('report-content')?.focus();
         }

        /**
         * Sets the current view to 'report' and triggers a UI render
         * to display the report for the current module.
         */
        function triggerReportGenerationForCurrentModule() {
             console.log("Triggering report generation view...");
             // Check if a valid course and module are selected
             if (currentCourseData && currentModuleIndex >= 0 && currentModuleIndex < currentCourseData.modules.length) {
                 currentView = 'report'; // Set the view state
                 renderUI(); // Render the report view (which calls renderModuleReport)
             } else {
                  // Handle invalid state for report generation
                  logError("Invalid state for report generation", new Error(`Course Loaded: ${!!currentCourseData}, Module Index: ${currentModuleIndex}`));
                  alert("Please load a course and ensure a valid module is selected before generating a report.");
                  // Optionally, redirect to a safer view like 'upload'
                  // currentView = 'upload';
                  // renderUI();
             }
         }


        // --- Export Functionality ---
        /**
         * Exports the current course module as a standalone HTML file
         * with the course data embedded.
         */
        function exportModuleAsHTML() {
            console.log("Initiating module export...");
            // --- Validation ---
            if (!currentCourseData) {
                logError("Export failed: No course data loaded.", new Error("currentCourseData is null"));
                alert("Cannot export: Please load a course module first.");
                return;
            }
            if (!currentCourseData.courseTitle || !currentCourseData.modules) {
                 logError("Export failed: Loaded course data is invalid or incomplete.", new Error(JSON.stringify(currentCourseData)));
                 alert("Cannot export: The loaded course data appears to be invalid.");
                 return;
            }

            try {
                 // --- 1. Prompt for Filename ---
                 // Suggest a filename based on course title, sanitized for filesystem safety
                 const safeCourseTitle = currentCourseData.courseTitle.replace(/[^a-z0-9]/gi, '_').substring(0, 50); // Limit length
                 const defaultFileName = `${safeCourseTitle || 'LearnMaster_Module'}.html`;
                 const fileName = prompt("Enter a filename for the exported HTML file:", defaultFileName);
                 // If user cancels prompt, fileName will be null
                 if (!fileName) {
                     console.log("Export cancelled by user.");
                     return;
                 }
                 // Ensure filename ends with .html
                 const finalFileName = fileName.endsWith('.html') ? fileName : `${fileName}.html`;
                 console.log(`Exporting module as: ${finalFileName}`);

                 // --- 2. Get Current Page HTML ---
                 // Using outerHTML provides the complete structure including <!DOCTYPE> and <html> tags
                 const currentHtml = document.documentElement.outerHTML;

                 // --- 3. Prepare Embedded Data ---
                 // Stringify the current course data
                 const courseJsonString = JSON.stringify(currentCourseData);
                 // Encode the JSON string using Base64 to handle special characters safely within the script tag
                 const base64Data = btoa(unescape(encodeURIComponent(courseJsonString))); // Handles UTF-8 correctly
                 // Create the JavaScript code to embed the data
                 // Note: We'll decode using: JSON.parse(decodeURIComponent(escape(atob(window.embeddedCourseData))))
                 const embeddedScriptContent = `\n\twindow.embeddedCourseData = "${base64Data}"; // Base64 encoded course data\n`;
                 // Create the full script tag with an ID for potential reference
                 const embeddedScriptTag = `<script id="${EMBEDDED_DATA_SCRIPT_ID}">${embeddedScriptContent}<\/script>`; // Escape forward slash for HTML parsing

                 // --- 4. Modify HTML String for Export ---
                 let modifiedHtml = currentHtml;

                 // --- Inject Embedded Data Script ---
                 // Place the script tag reliably within the <head> section, before the closing </head> tag.
                 // This ensures it's available early during page load.
                 if (modifiedHtml.includes('</head>')) {
                    modifiedHtml = modifiedHtml.replace('</head>', `\t${embeddedScriptTag}\n</head>`);
                 } else {
                     // Fallback if </head> is missing (unlikely for valid HTML) - append before </body>
                     logError("</head> tag not found during export. Appending embedded script before </body>.", new Error("HTML structure issue?"));
                     modifiedHtml = modifiedHtml.replace('</body>', `\t${embeddedScriptTag}\n</body>`);
                 }


                 // --- Modify the #upload-section in the HTML String ---
                 // This approach modifies the static HTML source of the exported file.
                 // It uses regex, which can be brittle if the HTML structure changes significantly.
                 // A DOMParser approach would be more robust but adds complexity.

                 // Regex to find the upload section div. Be mindful of nested divs.
                 // Using a non-greedy match for content: [\s\S]*?
                 const uploadSectionRegex = /(<div id="upload-section"[^>]*>)([\s\S]*?)(<\/div>\s*)/;
                 // Let's try a simpler regex targeting the inner content holder if the above is too complex
                 const uploadContentRegex = /(<div id="upload-content"[^>]*>)([\s\S]*?)(<\/div>)/;


                 const uploadContentMatch = modifiedHtml.match(uploadContentRegex);

                 if (uploadContentMatch && uploadContentMatch[2]) {
                     let uploadInnerHtml = uploadContentMatch[2]; // The content inside #upload-content
                     const originalInnerHtml = uploadInnerHtml; // For debugging

                     // Hide file input label, file input, and export button using inline style
                     // Target elements by ID within the captured innerHTML string
                     uploadInnerHtml = uploadInnerHtml.replace(
                         /(<label[^>]*?id="course-file-label"[^>]*?>)/,
                         '$1 style="display: none;"' // Add style to existing tag
                     );
                     uploadInnerHtml = uploadInnerHtml.replace(
                         /(<input[^>]*?id="course-file"[^>]*?>)/,
                         '$1 style="display: none;"' // Add style to existing tag
                     );
                     uploadInnerHtml = uploadInnerHtml.replace(
                         /(<button[^>]*?id="export-module-btn"[^>]*?>)/,
                         '$1 style="display: none;"' // Add style to existing tag
                     );

                     // Find the embedded message div, make it visible, and set its content
                     const embeddedMessage = `Course module '${escapeHtml(currentCourseData.courseTitle)}' is preloaded.`;
                     uploadInnerHtml = uploadInnerHtml.replace(
                         /(<div id="embedded-course-message"[^>]*?>)([\s\S]*?)(<\/div>)/,
                         (match, openingTag, content, closingTag) => {
                             // Replace existing style or add new one
                             let newOpeningTag = openingTag.includes('style=')
                               ? openingTag.replace(/style="[^"]*"/, 'style="display: block;"')
                               : openingTag.replace('>', ' style="display: block;">');
                             return `${newOpeningTag}${embeddedMessage}${closingTag}`;
                         }
                     );

                     // Replace the original inner HTML with the modified version
                     modifiedHtml = modifiedHtml.replace(originalInnerHtml, uploadInnerHtml);
                     console.log("Successfully modified upload section content in exported HTML string.");

                 } else {
                      logError("Could not find #upload-content inner HTML in HTML string for modification during export.", new Error("Regex match failed"));
                      // Proceeding, but the exported file's upload section might not be correctly pre-configured.
                      console.warn("Could not modify upload section in exported file. It might show upload elements incorrectly.");
                 }

                 // --- Optional: Add a marker attribute to the body tag ---
                 // This can help JavaScript in the exported file identify itself.
                 modifiedHtml = modifiedHtml.replace('<body', '<body data-exported-mode="true"');


                 // --- 5. Create Blob and Trigger Download ---
                 const blob = new Blob([modifiedHtml], { type: 'text/html;charset=utf-8' });
                 const url = URL.createObjectURL(blob);
                 const a = document.createElement('a');
                 a.href = url;
                 a.download = finalFileName; // Use the finalized filename
                 document.body.appendChild(a); // Add link to DOM
                 a.click(); // Simulate click to start download
                 document.body.removeChild(a); // Remove link from DOM
                 URL.revokeObjectURL(url); // Release the object URL

                 console.log(`Export successful: ${finalFileName}`);
                 alert(`Course module exported successfully as ${finalFileName}!`);

            } catch (error) {
                 logError("Error during module export process", error);
                 alert(`An error occurred during export: ${error.message}. Please check the console for details.`);
            }
        }

        // --- UTF-8 handling for btoa/atob ---
        // Needed if course data might contain non-ASCII characters
        // function utf8_to_b64(str) {
        //     return btoa(unescape(encodeURIComponent(str)));
        // }
        // function b64_to_utf8(str) {
        //     return decodeURIComponent(escape(atob(str)));
        // }
        // Use these functions when encoding/decoding if needed:
        // const base64Data = utf8_to_b64(courseJsonString);
        // const jsonString = b64_to_utf8(base64Data);


    </script>


</body></html>